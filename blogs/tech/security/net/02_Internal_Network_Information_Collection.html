<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-rc.19">
    <script>
      (function() {
        const userMode = localStorage.getItem('vuepress-reco-color-scheme') || 'auto';
        const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

        if (userMode === 'dark' || (userMode === 'auto' && systemDarkMode)) {
          document.documentElement.classList.toggle('dark', true);
        }
      })();
    </script>
    <link rel="icon" href="/favicon.ico"><title>内网信息收集 | P-Lab</title><meta name="description" content="boom!">
    <link rel="preload" href="/blog/assets/style-DRXNKcOj.css" as="style"><link rel="stylesheet" href="/blog/assets/style-DRXNKcOj.css">
    <link rel="modulepreload" href="/blog/assets/app-CUDFWA7u.js"><link rel="modulepreload" href="/blog/assets/02_Internal_Network_Information_Collection.html-Dteg0jbb.js">
    <link rel="prefetch" href="/blog/assets/timeline.html-DtDfdNkR.js" as="script"><link rel="prefetch" href="/blog/assets/posts.html-N3F93wHk.js" as="script"><link rel="prefetch" href="/blog/assets/friendship-link.html-DKFW6_6j.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DTn5PEhn.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-BxEYiKOs.js" as="script"><link rel="prefetch" href="/blog/assets/3.html-CJvx6yCY.js" as="script"><link rel="prefetch" href="/blog/assets/4.html-mrb76gp5.js" as="script"><link rel="prefetch" href="/blog/assets/5.html-Gna9oF6i.js" as="script"><link rel="prefetch" href="/blog/assets/6.html-UFH2E1S7.js" as="script"><link rel="prefetch" href="/blog/assets/7.html-D4qIQ4kt.js" as="script"><link rel="prefetch" href="/blog/assets/8.html-Bvc-s0-9.js" as="script"><link rel="prefetch" href="/blog/assets/9.html-Dz7sImFo.js" as="script"><link rel="prefetch" href="/blog/assets/10.html-dQLmZRR5.js" as="script"><link rel="prefetch" href="/blog/assets/11.html-D73nvg42.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-d1LHVl3E.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-C-z5uzWd.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-CQkyEnWJ.js" as="script"><link rel="prefetch" href="/blog/assets/3.html-D-xNmJIk.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-QZ_VQv86.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-C7vCPCkb.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BhUMNG_K.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-3-L0o6jW.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DQD5-srN.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BDsG0tVP.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-tkMfqMeD.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-iK9PRW_s.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-1z326L8R.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CXop4Y5N.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-7TOdJLCg.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-C4ttn_BN.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CJvRLrxO.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-D12oBj8Q.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DMsYUT7Z.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CbCC638q.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CzSuUaT7.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-Cop3Toin.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DyS_ukXB.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CxZV77kX.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-DCEMF68h.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-5NTxYb9I.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BPmQsWet.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-ZH4CFOBp.js" as="script"><link rel="prefetch" href="/blog/assets/3.html-DJ9i0XE8.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-C-z5uzWd.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-BW6T4hrk.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-B2Xq2dRt.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-D_FqYVDF.js" as="script"><link rel="prefetch" href="/blog/assets/3.html-CfPUGepi.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CxYd0SMZ.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-D7eWI4S8.js" as="script"><link rel="prefetch" href="/blog/assets/3.html-JRJfj7E7.js" as="script"><link rel="prefetch" href="/blog/assets/4.html-B_UXJvrj.js" as="script"><link rel="prefetch" href="/blog/assets/5.html-DMBqKlZg.js" as="script"><link rel="prefetch" href="/blog/assets/6.html-Dvvra5oR.js" as="script"><link rel="prefetch" href="/blog/assets/7.html-BMX5ivt9.js" as="script"><link rel="prefetch" href="/blog/assets/8.html-6G44YPDl.js" as="script"><link rel="prefetch" href="/blog/assets/9.html-CyCT8NW6.js" as="script"><link rel="prefetch" href="/blog/assets/10.html-DgDHxGxe.js" as="script"><link rel="prefetch" href="/blog/assets/11.html-CST3RQ_R.js" as="script"><link rel="prefetch" href="/blog/assets/12.html-Dg9eD0gk.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-nwU05bqO.js" as="script"><link rel="prefetch" href="/blog/assets/api.html-BJyYDv1r.js" as="script"><link rel="prefetch" href="/blog/assets/home.html-DVr-rfxM.js" as="script"><link rel="prefetch" href="/blog/assets/plugin.html-nWuSuO6J.js" as="script"><link rel="prefetch" href="/blog/assets/theme.html-BmEBpSul.js" as="script"><link rel="prefetch" href="/blog/assets/02.html-CPibkNbR.js" as="script"><link rel="prefetch" href="/blog/assets/01.html-DnLt1arR.js" as="script"><link rel="prefetch" href="/blog/assets/2022.html-BIa_t6jd.js" as="script"><link rel="prefetch" href="/blog/assets/2023.html-Drt87foF.js" as="script"><link rel="prefetch" href="/blog/assets/01.html-IfvzXdp8.js" as="script"><link rel="prefetch" href="/blog/assets/02.1.html-kF9MDVNx.js" as="script"><link rel="prefetch" href="/blog/assets/02.2.html-Bfcrr5dr.js" as="script"><link rel="prefetch" href="/blog/assets/02.html-JxkqvKgU.js" as="script"><link rel="prefetch" href="/blog/assets/02_Google.html-CHFd00Ja.js" as="script"><link rel="prefetch" href="/blog/assets/03_Amazon.html-DNb9Laoq.js" as="script"><link rel="prefetch" href="/blog/assets/04_Azure.html-CLvbr4fB.js" as="script"><link rel="prefetch" href="/blog/assets/05_Hadoop.html-B_xkTFOA.js" as="script"><link rel="prefetch" href="/blog/assets/09_Cloud_Center.html-Bz7P8kvQ.js" as="script"><link rel="prefetch" href="/blog/assets/Lab1_Hadoop.html-DmTjk_fT.js" as="script"><link rel="prefetch" href="/blog/assets/Lab2_Virtual.html-kPENVxoA.js" as="script"><link rel="prefetch" href="/blog/assets/Lab3_OpenStack.html-DzzrwvrO.js" as="script"><link rel="prefetch" href="/blog/assets/Lab2_BoomLab.html-C01Nrrlf.js" as="script"><link rel="prefetch" href="/blog/assets/04_Linux_SMB.html-BdLF1uo_.js" as="script"><link rel="prefetch" href="/blog/assets/06_Linux_crontab.html-D1zOpoj5.js" as="script"><link rel="prefetch" href="/blog/assets/08_Linux_crontab_venv.html-Cb_DPDHV.js" as="script"><link rel="prefetch" href="/blog/assets/101_iptables.html-_pEY5xwd.js" as="script"><link rel="prefetch" href="/blog/assets/01_re.html-D4IslnWO.js" as="script"><link rel="prefetch" href="/blog/assets/01.html-Bg8w5lva.js" as="script"><link rel="prefetch" href="/blog/assets/02.html-CuQqAtrx.js" as="script"><link rel="prefetch" href="/blog/assets/03.html-C8MQ2plx.js" as="script"><link rel="prefetch" href="/blog/assets/05.html-DPAAOdPU.js" as="script"><link rel="prefetch" href="/blog/assets/06.html-CjiyzQs-.js" as="script"><link rel="prefetch" href="/blog/assets/01_Ubuntu_add_net_card.html-BO6uBvci.js" as="script"><link rel="prefetch" href="/blog/assets/Lab1.html-DrSXtbhU.js" as="script"><link rel="prefetch" href="/blog/assets/Lab2.html-Buf92Z3H.js" as="script"><link rel="prefetch" href="/blog/assets/Lab3.html-Dbkzsrlb.js" as="script"><link rel="prefetch" href="/blog/assets/Lab4.html-D9sh4LP5.js" as="script"><link rel="prefetch" href="/blog/assets/Lab5.html-C0xRrctu.js" as="script"><link rel="prefetch" href="/blog/assets/Lab6_NAT.html-DCJQMYGp.js" as="script"><link rel="prefetch" href="/blog/assets/14.html-BLsZeU9z.js" as="script"><link rel="prefetch" href="/blog/assets/15.html-AGq_oQLO.js" as="script"><link rel="prefetch" href="/blog/assets/16.html-CS_YwY4J.js" as="script"><link rel="prefetch" href="/blog/assets/01.01_networking2.html-C9Q596d7.js" as="script"><link rel="prefetch" href="/blog/assets/01.1_STP.html-B4WPNBkO.js" as="script"><link rel="prefetch" href="/blog/assets/01.2_VTP.html-DNjutH2d.js" as="script"><link rel="prefetch" href="/blog/assets/01_IPv6.html-D5TsBk7K.js" as="script"><link rel="prefetch" href="/blog/assets/01_networking.html-Cp9Mcyvv.js" as="script"><link rel="prefetch" href="/blog/assets/01_Xiaomi_4A_GE_v2_ipv6.html-BmSXS8_9.js" as="script"><link rel="prefetch" href="/blog/assets/jp_vn_dns_check.html-Dv2g9vnS.js" as="script"><link rel="prefetch" href="/blog/assets/01.html-DxuGRYMd.js" as="script"><link rel="prefetch" href="/blog/assets/02.html-DkhQCrdO.js" as="script"><link rel="prefetch" href="/blog/assets/03.1.html-D1cEYlod.js" as="script"><link rel="prefetch" href="/blog/assets/03.html-CORtrYRS.js" as="script"><link rel="prefetch" href="/blog/assets/04.html-g8Ypz4rH.js" as="script"><link rel="prefetch" href="/blog/assets/06.html-CsoRMAPW.js" as="script"><link rel="prefetch" href="/blog/assets/07.html-yh_B4Yxk.js" as="script"><link rel="prefetch" href="/blog/assets/08.html-DOdHkm2k.js" as="script"><link rel="prefetch" href="/blog/assets/10.html-CSEgfWw4.js" as="script"><link rel="prefetch" href="/blog/assets/01_Git_Basics.html-CdLHKijD.js" as="script"><link rel="prefetch" href="/blog/assets/02_Git_Common_Commands.html-DdzuLLcv.js" as="script"><link rel="prefetch" href="/blog/assets/03_Git_Connect_GitHub.html-ynVZyYXK.js" as="script"><link rel="prefetch" href="/blog/assets/04_Git_Push_Issues.html-CvvQBdkE.js" as="script"><link rel="prefetch" href="/blog/assets/05_Windows_Terminal_Add_GitBash.html-BCS4uz1o.js" as="script"><link rel="prefetch" href="/blog/assets/06_VSCode_Configure_GitBash_Terminal.html-CR-dCKfA.js" as="script"><link rel="prefetch" href="/blog/assets/01_reset_css.html-CiCB30YF.js" as="script"><link rel="prefetch" href="/blog/assets/02_Vue_quick_setup.html-EhtBcalh.js" as="script"><link rel="prefetch" href="/blog/assets/01_Internal_Penetration_Testing_Basics.html-DSd2n_k5.js" as="script"><link rel="prefetch" href="/blog/assets/999_Trace_Cleanup.html-HZPjGYiA.js" as="script"><link rel="prefetch" href="/blog/assets/99_Common_Attack_Defense.html-BoGOZy5w.js" as="script"><link rel="prefetch" href="/blog/assets/99_End.html-BW5vcKzf.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-Bnjm7IJv.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-2ZZeio5l.js" as="script"><link rel="prefetch" href="/blog/assets/bfd.html-CWbylTLO.js" as="script"><link rel="prefetch" href="/blog/assets/MSTP_VRRP_VLAN_OSPF_NAT.html-6t5HiRqZ.js" as="script"><link rel="prefetch" href="/blog/assets/01.html-Bt-0w_uc.js" as="script"><link rel="prefetch" href="/blog/assets/02.html-C114PjNs.js" as="script"><link rel="prefetch" href="/blog/assets/01.html-7fRlJ2rl.js" as="script"><link rel="prefetch" href="/blog/assets/01.html-DRXViJO9.js" as="script"><link rel="prefetch" href="/blog/assets/101.html-Dq1QZ0r9.js" as="script"><link rel="prefetch" href="/blog/assets/1101.html-CmqxYduO.js" as="script"><link rel="prefetch" href="/blog/assets/1102.html-DMtXrRX4.js" as="script"><link rel="prefetch" href="/blog/assets/1103.html-B7WSHIqr.js" as="script"><link rel="prefetch" href="/blog/assets/1104.html-Qn1uVFD3.js" as="script"><link rel="prefetch" href="/blog/assets/1105.html-C-KGByek.js" as="script"><link rel="prefetch" href="/blog/assets/1106.html-CegCfEo0.js" as="script"><link rel="prefetch" href="/blog/assets/1107.html-Dr3ul0SH.js" as="script"><link rel="prefetch" href="/blog/assets/Lab01_ATT_CK_Red_Team_Practice_1.html-8MTSHsID.js" as="script"><link rel="prefetch" href="/blog/assets/Lab02_ATT_CK_Red_Team_Practice_2.html-D2Z-9uS1.js" as="script"><link rel="prefetch" href="/blog/assets/00.1_Installation.html-BYVosclL.js" as="script"><link rel="prefetch" href="/blog/assets/01_Brute_Force.html-CGEHx0DQ.js" as="script"><link rel="prefetch" href="/blog/assets/02_XSS.html-C45WnO3u.js" as="script"><link rel="prefetch" href="/blog/assets/03_CSRF.html-CUG44hvL.js" as="script"><link rel="prefetch" href="/blog/assets/04_Sql_Inject.html-BsQ4jlSF.js" as="script"><link rel="prefetch" href="/blog/assets/Lab10_CSP Bypass.html-wWu4_UqL.js" as="script"><link rel="prefetch" href="/blog/assets/Lab11 JavaScript.html-Dw_fNbVz.js" as="script"><link rel="prefetch" href="/blog/assets/Lab1_Brute Force.html-ni-8gdZL.js" as="script"><link rel="prefetch" href="/blog/assets/Lab2_Command Injection.html-ByqAKGcG.js" as="script"><link rel="prefetch" href="/blog/assets/Lab3_CSRF.html-DRdTFj3l.js" as="script"><link rel="prefetch" href="/blog/assets/Lab4_File Inclusion.html-wPML6fD0.js" as="script"><link rel="prefetch" href="/blog/assets/Lab5_FileUpload.html-BbBKagNF.js" as="script"><link rel="prefetch" href="/blog/assets/Lab6_Insecure CAPTCHA.html-CBxfbcjs.js" as="script"><link rel="prefetch" href="/blog/assets/Lab7_SQL Injection.html-DoA3nKCS.js" as="script"><link rel="prefetch" href="/blog/assets/Lab8_Weak Session IDs.html-D30vDaAq.js" as="script"><link rel="prefetch" href="/blog/assets/Lab9_XSS.html-DKeSRW9_.js" as="script"><link rel="prefetch" href="/blog/assets/1.html-CAEzx4Jg.js" as="script"><link rel="prefetch" href="/blog/assets/10.html-ZD9hKPe8.js" as="script"><link rel="prefetch" href="/blog/assets/11.html-CYfb_MSx.js" as="script"><link rel="prefetch" href="/blog/assets/12.html-BuaHQ8Vf.js" as="script"><link rel="prefetch" href="/blog/assets/13.html-BWk6xVX1.js" as="script"><link rel="prefetch" href="/blog/assets/14.html-C7-UrOfM.js" as="script"><link rel="prefetch" href="/blog/assets/2.html-CrX46c0_.js" as="script"><link rel="prefetch" href="/blog/assets/3.html-DDXfqpWZ.js" as="script"><link rel="prefetch" href="/blog/assets/4.html-Cxwj7dGX.js" as="script"><link rel="prefetch" href="/blog/assets/5.html-Gc9X55MD.js" as="script"><link rel="prefetch" href="/blog/assets/6.html-BuwbIx6K.js" as="script"><link rel="prefetch" href="/blog/assets/7.html-Ct2EhuIl.js" as="script"><link rel="prefetch" href="/blog/assets/8.html-CtlWLmST.js" as="script"><link rel="prefetch" href="/blog/assets/9.html-BWbEbpII.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-DM2Eep2D.js" as="script"><link rel="prefetch" href="/blog/assets/Valine.min-_LyT3bfY.js" as="script"><link rel="prefetch" href="/blog/assets/giscus-aTimukGI-DWEKOTfS.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container series--no show-catalog"><header class="navbar-container not-open"><div class="navbar-inner"><div class="site-brand nav-item"><img class="logo" src="/blog/logo.jpg" alt="P-Lab"><a href="/blog/" class="site-name can-hide">P-Lab</a></div><div class="nav-item navbar-links-wrapper" style=""><div><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div><nav class="navbar-links"><!--[--><div class="navbar-links__item"><a href="/blog/" class="link" aria-label="主页"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->主页<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/blog/categories/tech/1.html" class="link" aria-label="分类"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->分类<!--]--></span></span><!--[--><!--]--></a></div><div class="navbar-links__item"><a href="/blog/tags/AI/1.html" class="link" aria-label="标签"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->标签<!--]--></span></span><!--[--><!--]--></a></div><!--]--><!----><span class="xicon-container btn-toggle-dark-mode btn--dark-mode navbar-links__item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><path d="M15 2h2v3h-2z" fill="currentColor"></path><path d="M27 15h3v2h-3z" fill="currentColor"></path><path d="M15 27h2v3h-2z" fill="currentColor"></path><path d="M2 15h3v2H2z" fill="currentColor"></path><path d="M5.45 6.884l1.414-1.415l2.121 2.122l-1.414 1.414z" fill="currentColor"></path><path d="M23 7.58l2.121-2.12l1.414 1.414l-2.121 2.121z" fill="currentColor"></path><path d="M23.002 24.416l1.415-1.414l2.12 2.122l-1.413 1.414z" fill="currentColor"></path><path d="M5.47 25.13L7.59 23L9 24.42l-2.12 2.12l-1.41-1.41z" fill="currentColor"></path><path d="M16 8a8 8 0 1 0 8 8a8 8 0 0 0-8-8zm0 14a6 6 0 0 1 0-12z" fill="currentColor"></path></svg></span><ul class="social-links navbar-links__item"><!--[--><li class="social-item"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:25px;height:25px;"><path d="M16 2a14 14 0 0 0-4.43 27.28c.7.13 1-.3 1-.67v-2.38c-3.89.84-4.71-1.88-4.71-1.88a3.71 3.71 0 0 0-1.62-2.05c-1.27-.86.1-.85.1-.85a2.94 2.94 0 0 1 2.14 1.45a3 3 0 0 0 4.08 1.16a2.93 2.93 0 0 1 .88-1.87c-3.1-.36-6.37-1.56-6.37-6.92a5.4 5.4 0 0 1 1.44-3.76a5 5 0 0 1 .14-3.7s1.17-.38 3.85 1.43a13.3 13.3 0 0 1 7 0c2.67-1.81 3.84-1.43 3.84-1.43a5 5 0 0 1 .14 3.7a5.4 5.4 0 0 1 1.44 3.76c0 5.38-3.27 6.56-6.39 6.91a3.33 3.33 0 0 1 .95 2.59v3.84c0 .46.25.81 1 .67A14 14 0 0 0 16 2z" fill-rule="evenodd" fill="currentColor"></path></svg></li><!--]--></ul></nav><span class="xicon-container btn-toggle-menus"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" style="width:20px;height:20px;font-size:20px;color:;"><circle cx="16" cy="8" r="2" fill="currentColor"></circle><circle cx="16" cy="16" r="2" fill="currentColor"></circle><circle cx="16" cy="24" r="2" fill="currentColor"></circle></svg></span></div></div></header><!----><!----><!----><div class="theme-main" style=""><!----><!--[--><main class="page-container"><div class="page-content"><h1 class="page-title">内网信息收集</h1><div class="page-info"><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M16 4a5 5 0 1 1-5 5a5 5 0 0 1 5-5m0-2a7 7 0 1 0 7 7a7 7 0 0 0-7-7z" fill="currentColor"></path><path d="M26 30h-2v-5a5 5 0 0 0-5-5h-6a5 5 0 0 0-5 5v5H6v-5a7 7 0 0 1 7-7h6a7 7 0 0 1 7 7z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->PPPerryPan<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2023-10-09<!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M11.17 6l3.42 3.41l.58.59H28v16H4V6h7.17m0-2H4a2 2 0 0 0-2 2v20a2 2 0 0 0 2 2h24a2 2 0 0 0 2-2V10a2 2 0 0 0-2-2H16l-3.41-3.41A2 2 0 0 0 11.17 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/blog/categories/tech/1.html" class="">tech</a><!--]--><!--]--></span></span><span class="xicon-container left"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:18px;height:18px;font-size:18px;color:;"><path d="M10 14a4 4 0 1 1 4-4a4.005 4.005 0 0 1-4 4zm0-6a2 2 0 1 0 1.998 2.004A2.002 2.002 0 0 0 10 8z" fill="currentColor"></path><path d="M16.644 29.415L2.586 15.354A2 2 0 0 1 2 13.941V4a2 2 0 0 1 2-2h9.941a2 2 0 0 1 1.414.586l14.06 14.058a2 2 0 0 1 0 2.828l-9.943 9.943a2 2 0 0 1-2.829 0zM4 4v9.942L18.058 28L28 18.058L13.942 4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[--><!--[--><a href="/blog/tags/security/1.html" class="">security</a><a href="/blog/tags/networking/1.html" class="">networking</a><!--]--><!--]--></span></span><!----></div><div class="theme-reco-md-content"><div><h1 id="内网信息收集" tabindex="-1"><a class="header-anchor" href="#内网信息收集"><span>内网信息收集</span></a></h1><h2 id="收集本机信息" tabindex="-1"><a class="header-anchor" href="#收集本机信息"><span>收集本机信息</span></a></h2><p><strong>查询网络配置信息</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">ipconfig /all</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="手动收集信息" tabindex="-1"><a class="header-anchor" href="#手动收集信息"><span>手动收集信息</span></a></h3><p><strong>查询操作系统及软件信息</strong></p><p>查看系统详细信息：<code>systeminfo</code></p><p>CMD 查询操作系统和版本信息：<code>systeminfo | findstr /B /C:&quot;OS Name&quot; /C:&quot;OS Version&quot;</code> 或 <code>systeminfo | findstr /B /C:&quot;OS 名称&quot; /C:&quot;OS 版本&quot;</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Microsoft Windows [版本 10.0.19044.1706]</span>
<span class="line">(c) Microsoft Corporation。保留所有权利。</span>
<span class="line"></span>
<span class="line">C:\Users\perry&gt;systeminfo | findstr /B /C:&quot;OS 名称&quot; /C:&quot;OS 版本&quot;</span>
<span class="line">OS 名称:          Microsoft Windows 10 专业版</span>
<span class="line">OS 版本:          10.0.19044 暂缺 Build 19044</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查看安装的软件及版本、路径</strong>等：<code>wmic product get name,version</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Microsoft Windows [版本 6.1.7601]</span>
<span class="line">版权所有 (c) 2009 Microsoft Corporation。保留所有权利。</span>
<span class="line"></span>
<span class="line">C:\Users\testuser&gt;wmic product get name,version</span>
<span class="line">Name                                                            Version</span>
<span class="line"></span>
<span class="line">Microsoft Visual C++ 2019 X86 Minimum Runtime - 14.20.27508     14.20.27508</span>
<span class="line"></span>
<span class="line">Microsoft Visual C++ 2019 X64 Minimum Runtime - 14.20.27508     14.20.27508</span>
<span class="line"></span>
<span class="line">Microsoft Visual C++ 2019 X86 Additional Runtime - 14.20.27508  14.20.27508</span>
<span class="line"></span>
<span class="line">Microsoft Visual C++ 2019 X64 Additional Runtime - 14.20.27508  14.20.27508</span>
<span class="line"></span>
<span class="line">VMware Tools                                                    11.0.6.15940789</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>利用 PowerShell 命令，收集软件的版本信息：<code>powershell &quot;Get-WmiObject -class Win32_Product |Select-Object -Property name,version&quot;</code></p><div class="language-powershell line-numbers-mode" data-highlighter="prismjs" data-ext="powershell" data-title="powershell"><pre><code><span class="line"><span class="token function">PS</span> C:\Users\testuser&gt; <span class="token function">Get-WmiObject</span> <span class="token operator">-</span><span class="token keyword">class</span> Win32_Product <span class="token punctuation">|</span><span class="token function">Select-Object</span> <span class="token operator">-</span>Property name<span class="token punctuation">,</span>version</span>
<span class="line"></span>
<span class="line">name                                                        version</span>
<span class="line"><span class="token operator">--</span><span class="token operator">--</span>                                                        <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span></span>
<span class="line">Microsoft Visual C+<span class="token operator">+</span> 2019 X86 Minimum Runtime <span class="token operator">-</span> 14<span class="token punctuation">.</span>20<span class="token punctuation">.</span>27508 14<span class="token punctuation">.</span>20<span class="token punctuation">.</span>27508</span>
<span class="line">Microsoft Visual C+<span class="token operator">+</span> 2019 X64 Minimum Runtime <span class="token operator">-</span> 14<span class="token punctuation">.</span>20<span class="token punctuation">.</span>27508 14<span class="token punctuation">.</span>20<span class="token punctuation">.</span>27508</span>
<span class="line">Microsoft Visual C+<span class="token operator">+</span> 2019 X86 Additional Runtime <span class="token operator">-</span> 14<span class="token punctuation">.</span>20<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 14<span class="token punctuation">.</span>20<span class="token punctuation">.</span>27508</span>
<span class="line">Microsoft Visual C+<span class="token operator">+</span> 2019 X64 Additional Runtime <span class="token operator">-</span> 14<span class="token punctuation">.</span>20<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> 14<span class="token punctuation">.</span>20<span class="token punctuation">.</span>27508</span>
<span class="line">VMware Tools                                                11<span class="token punctuation">.</span>0<span class="token punctuation">.</span>6<span class="token punctuation">.</span>15940789</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查询本机访问信息</strong>：<code>wmic service list brief</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\testuser&gt;wmic service list brief</span>
<span class="line">ExitCode  Name                            ProcessId  StartMode  State    Status</span>
<span class="line"></span>
<span class="line">0         AeLookupSvc                     808        Manual     Running  OK</span>
<span class="line"></span>
<span class="line">1077      ALG                             0          Manual     Stopped  OK</span>
<span class="line"></span>
<span class="line">1077      AppIDSvc                        0          Manual     Stopped  OK</span>
<span class="line"></span>
<span class="line">1077      Appinfo                         0          Manual     Stopped  OK</span>
<span class="line"></span>
<span class="line">1077      AppMgmt                         0          Manual     Stopped  OK</span>
<span class="line">......</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>进查询程信息</strong></p><p>查询进程列表：<code>tasklist</code></p><p>查看进程信息：<code>wmic process list brief</code></p><p>常见杀软进程</p><table><thead><tr><th>软件</th><th>进程</th><th>服务</th></tr></thead><tbody><tr><td>金山毒霸</td><td>kxescore.exe、kupdata.exe、kxetray.exe、kwsprotect64.exe</td><td></td></tr><tr><td>360</td><td>360sd.exe、360tray.exe、360rp.exe、LiveUpdate360.exe、zhudongfangyu.exe、360Safe.exe、360Tray.exe、LiveUpdate360.exe、ZhuDongFangYu.exe、360skylarsvc.exe</td><td>ZhuDongFangYu、360 Skylar Service</td></tr><tr><td>腾讯电脑管家</td><td>QQPCRTP.exe、QQPCTray.exe、QQPCNetFlow.exe、QQPCRealTimeSpeedup.exe</td><td>QQPCRTP</td></tr><tr><td>火绒</td><td>HipsDaemon.exe、HipsTray.exe、HipsLog.exe、HipsMain.exe、usysdiag.exe、wsctrl.exe</td><td>HipsDaemon</td></tr><tr><td>AVG</td><td>avg.exe、avgwdsvc.exe</td><td></td></tr><tr><td>Avast</td><td>AvastUI.exe、ashDisp.exe</td><td></td></tr><tr><td>McAfee</td><td>Tbmon.exe、shstat.exe、McTray.exe、mfeann.exe、mfevtps.exe、UdaterUI.exe、naPrdMgr.exe、VsTskMgr.exe、McShield.exe、EngineServer.exe、FrameworkService.exe</td><td>McTaskManager、McShield、mfevtp、McAfeeEngineService、McAfeeFramework</td></tr><tr><td>卡巴斯基企业版/服务器版</td><td>avp.exe、kavfs.exe（Kaspersky Anti-Virus Service）、klnagent.exe（Kaspersky Administraton Kit Network Agent）、kavtray.exe（Kaspersky Anti-Virus tray app“主进程”）、kavfswp.exe（Kaspersky Anti-Virus worker process）</td><td>AVP</td></tr><tr><td>MS Defender</td><td>MsMpEng.exe、NisSrv.exe、MsSense.exe、msseces.exe、MpCmdRun.exe、MSASCui.exe、MSASCuiL.exe、SecurityHealthService.exe</td><td>WinDefend、MsMpSvc</td></tr></tbody></table><p>参考链接：</p><p><a href="https://github.com/gh0stkey/avList" target="_blank" rel="noopener noreferrer">gh0stkey/avList: avList - 杀软进程对应杀软名称 (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://github.com/3had0w/Antivirus-detection" target="_blank" rel="noopener noreferrer">3had0w/Antivirus-detection: Show AV Processes list (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://github.com/r00tSe7en/get_AV" target="_blank" rel="noopener noreferrer">r00tSe7en/get_AV: Windows杀软在线对比辅助 (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://github.com/uknowsec/SharpAVKB" target="_blank" rel="noopener noreferrer">uknowsec/SharpAVKB: Windows杀软对比和补丁号对比 (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><a href="https://github.com/ars3n11/Aggressor-Scripts" target="_blank" rel="noopener noreferrer">ars3n11/Aggressor-Scripts: Cobalt Strike aggressor scripts (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><strong>查看自启动程序信息</strong>：<code>wmic startup get command, caption</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\testuser&gt;wmic startup get command, caption</span>
<span class="line">Caption                     Command</span>
<span class="line"></span>
<span class="line">VMware VM3DService Process  &quot;C:\Windows\system32\vm3dservice.exe&quot; -u</span>
<span class="line"></span>
<span class="line">VMware User Process         &quot;C:\Program Files\VMware\VMware Tools\vmtoolsd.exe&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查看计划任务</strong>：<code>schtasks /query /fo LIST /v</code></p><p><strong>查看主机开机时间</strong>：<code>net statistics workstation</code></p><p><strong>查询用户信息</strong></p><p>查询用户列表：<code>net user</code></p><p>通过分析用户列表，可找出内网机器的命名规则。个人机器的名称可以用来推测整个域的用户命名方式</p><p>获取本地管理员(包含域用户)信息：<code>net localgroup administrators</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Microsoft Windows [版本 6.1.7601]</span>
<span class="line">版权所有 (c) 2009 Microsoft Corporation。保留所有权利。</span>
<span class="line"></span>
<span class="line">C:\Users\testuser&gt;net view /domain:hacke</span>
<span class="line">服务器名称            注解</span>
<span class="line"></span>
<span class="line">-------------------------------------------------------------------------------</span>
<span class="line">\\DC</span>
<span class="line">\\WS08-X64-TEST</span>
<span class="line">命令成功完成。</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">C:\Users\testuser&gt;net localgroup administrators</span>
<span class="line">别名     administrators</span>
<span class="line">注释     管理员对计算机/域有不受限制的完全访问权</span>
<span class="line"></span>
<span class="line">成员</span>
<span class="line"></span>
<span class="line">-------------------------------------------------------------------------------</span>
<span class="line">Administrator</span>
<span class="line">HACKE\Domain Admins</span>
<span class="line">命令成功完成。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看当前用户：<code>whoami</code></p><p>查看当前在线用户：<code>query user || qwinsta</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\testuser&gt;query user || qwinsta</span>
<span class="line"> 用户名                会话名             ID  状态    空闲时间   登录时间</span>
<span class="line">&gt;testuser              console             1  运行中      无     2022/7/13 16:38</span>
<span class="line"></span>
<span class="line"> 会话名            用户名                   ID  状态    类型        设备</span>
<span class="line"> services                                    0  断开</span>
<span class="line">&gt;console           testuser                  1  运行中</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>列出或断开本地计算机域所连接的客户端之间的会话</strong>：<code>net session</code></p><p><strong>查询端口列表</strong>：<code>netstat -ano</code></p><p><strong>查看补丁列表</strong>：<code>systeminfo</code> 或 <code>wmic qfe get Caption,Description,HotFixID,InstalledOn</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\testuser&gt;wmic qfe get Caption,Description,HotFixID,InstalledOn</span>
<span class="line">Caption                                     Description  HotFixID   InstalledOn</span>
<span class="line"></span>
<span class="line">http://support.microsoft.com/?kbid=2999226  Update       KB2999226  7/2/2022</span>
<span class="line"></span>
<span class="line">http://support.microsoft.com/?kbid=976902   Update       KB976902   11/21/2010</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查询本机共享列表</strong>：<code>net share</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\testuser&gt;net share</span>
<span class="line"></span>
<span class="line">共享名       资源                            注解</span>
<span class="line"></span>
<span class="line">-------------------------------------------------------------------------------</span>
<span class="line">C$           C:\                             默认共享</span>
<span class="line">IPC$                                         远程 IPC</span>
<span class="line">ADMIN$       C:\Windows                      远程管理</span>
<span class="line">命令成功完成。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>利用wmic命令查找共享列表：<code>wmic share get name,path,status</code></p><p><strong>查询路由表及所有可用接口的ARP缓存表</strong>：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">route print</span>
<span class="line">arp -a</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>防火墙相关</strong></p><p>关闭防火墙 ：</p><p>Server 2003- ：<code>netsh firewall set opmode disable</code></p><p>Server 2008+ ：<code>netsh firewall set allprofiles state off</code></p><p>查看防火墙配置：<code>netsh firewall show config</code></p><p>修改防火墙配置：</p><p>Server2003-</p><p>​ 允许指定该程序全部连接：<code>netsh firewalld add allowedprogram c:\nc.exe &quot;allow nc&quot; enable</code></p><p>Server2008+</p><p>​ 允许指定程序进入：<code>netsh advfirewall firewall add rule name=&quot;pass nc&quot; dir=in action=allow</code></p><p>​ 允许指定程序退出：<code>netsh advfirewall firewall add rule name=&quot;Allow nc&quot; dir=not action=allow program=&quot;C:\nc.exe&quot;</code></p><p>​ 允许3389端口放行：<code>netsh advfirewall firewall add rule name=&quot;Remote Desktop&quot; protocal=TCP dir=in localport=3389 action=allow</code></p><p>​ 自定义防火墙日志的存储位置：<code>netsh advfirewall set current profile logging filename &quot;C:\Windows\temp\fw.log&quot;</code></p><p><strong>查看代理配置情况</strong>：<code>reg query &quot;HKEY_CURRENT_USER\Software\Microsoft \Windows\CurrentVersion\Internet Settings&quot;</code></p><p><strong>查询并开启远程连接服务</strong>：</p><p>查看远程连接端口：</p><p>在命令行环境中执行注册表查询语句，命令如下。连接的端口为0xd3d，转换后为3389。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">REG QUERY&quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp&quot;/V PortNumber</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在Windows Server 2003中开启3389端口</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">wmic path win32 terminalservicesetting where(CLASS!=&quot;&quot;) call setallowtsconnections 1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在Windows Server 2008和Windows Server2012中开启3389端口</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">wmic/namespace:\\root\cimv2\terminalservices path win32 terminalservicesetting where(CLASS!=&quot;&quot;) call setallowtsconnections 1</span>
<span class="line"></span>
<span class="line">wmic/namespace:\\root\cimv2\terminalservices path win32 tsgeneralsetting where(TerminalName=&#39;RDP-Tcp&#39;) call setuserauthenticationrequired 1</span>
<span class="line"></span>
<span class="line">reg add&quot;HKLM\SYSTEM\CURRENT\CONTROLSET\CONTROL\TERMINAL SERVER&quot; /v  fSingleSessionPerUser/t REG DWORD/d 0/f</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="自动收集信息" tabindex="-1"><a class="header-anchor" href="#自动收集信息"><span>自动收集信息</span></a></h3><p>为了简化操作，可以创建一个脚本，在目标机器上完成流程、服务、用户账号、用户组、网络接口、硬盘信息、网络共享信息、操作系统、安装的补丁、安装的软件、启动时运行的程序、时区等信息的查询工作。</p><p>如，使用WMIC脚本实现*，执行该脚本后，会将所有结果写入一个HTML文件</p><p>*：http://www.fuzzysecurity.com/scripts/files/wmic_info.rar</p><p>*：OneDrive - Business\Documents\NUIT\内网安全攻防\wmic_info.bat</p><h3 id="empire下的主机信息收集-待补充" tabindex="-1"><a class="header-anchor" href="#empire下的主机信息收集-待补充"><span>Empire下的主机信息收集 （待补充）</span></a></h3><p>Empire提供了用于收集主机信息的模块。输入命令 <code>usemodule situational_awareness/host/winenum</code> ，即可查看本机用户、域组成员、密码设置时间、剪贴板内容、系统基本信息、网络适配器信息、共享信息等。</p><p>参考链接：<a href="https://github.com/BC-SECURITY/Empire" target="_blank" rel="noopener noreferrer">BC-SECURITY/Empire: Empire is a PowerShell and Python 3.x post-exploitation framework. (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="查询当前权限" tabindex="-1"><a class="header-anchor" href="#查询当前权限"><span>查询当前权限</span></a></h2><p><strong>查看当前权限</strong>：<code>whoami</code></p><p>一般有三种情况：</p><p><img src="/blog/assets/image-20220713193615080-Ci52U7JA.png" alt="image-20220713193615080"></p><p>如果当前内网中存在域，那么本地普通用户只能查询本机相关信息，不能查询域内信息，而本地管理员用户和域内用户可以查询域内信息。</p><p>其原理是：域内的所有查询都是通过域控制器实现的（基于LDAP协议），而这个查询需要经过权限认证，所以，只有域用户才拥有这个权限；当域用户执行查询命令时，会自动使用 Kerberos 协议进行认证，无须额外输入账号和密码。</p><p>本地管理员Administrator 权限可以直接提升为Ntauthority或System权限，因此，在域中，除普通用户外，所有的机器都有一个机器用户（用户名是机器名加上“$”）。在本质上，机器的system用户对应的就是域里面的机器用户。所以，使用System权限可以运行域内的查询命令。</p><p><strong>获取域 SID</strong>：<code>whoami /all</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Administrator&gt;whoami /all</span>
<span class="line"></span>
<span class="line">用户信息</span>
<span class="line">----------------</span>
<span class="line"></span>
<span class="line">用户名              SID</span>
<span class="line">=================== =============================================</span>
<span class="line">hacke\administrator S-1-5-21-4114729402-1436421223-1667956922-500</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查询指定用户的详细信息</strong>：<code>net user [user] /domain</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Administrator&gt;net user testuser /domain</span>
<span class="line">用户名                 testuser</span>
<span class="line">全名                   test</span>
<span class="line">注释</span>
<span class="line">用户的注释</span>
<span class="line">国家/地区代码          000 (系统默认值)</span>
<span class="line">帐户启用               Yes</span>
<span class="line">帐户到期               从不</span>
<span class="line"></span>
<span class="line">上次设置密码           2022/7/11 16:31:15</span>
<span class="line">密码到期               2022/8/22 16:31:15</span>
<span class="line">密码可更改             2022/7/12 16:31:15</span>
<span class="line">需要密码               No</span>
<span class="line">用户可以更改密码       Yes</span>
<span class="line"></span>
<span class="line">允许的工作站           All</span>
<span class="line">登录脚本</span>
<span class="line">用户配置文件</span>
<span class="line">主目录</span>
<span class="line">上次登录               2022/7/13 19:33:27</span>
<span class="line"></span>
<span class="line">可允许的登录小时数     All</span>
<span class="line"></span>
<span class="line">本地组成员</span>
<span class="line">全局组成员             *Domain Users</span>
<span class="line">命令成功完成。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="判断是否存在域" tabindex="-1"><a class="header-anchor" href="#判断是否存在域"><span>判断是否存在域</span></a></h2><ol><li><strong>使用 <code>ipconfig</code> 命令</strong></li></ol><p>执行如下命令，可以查看<strong>网关</strong>IP地址、<strong>DNS</strong>的<strong>IP</strong>地址、<strong>域名</strong>、<strong>本机</strong>是否和DNS服务器处于<strong>同一网段</strong>等信息。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\testuser&gt;ipconfig /all</span>
<span class="line"></span>
<span class="line">Windows IP 配置</span>
<span class="line"></span>
<span class="line">   主机名  . . . . . . . . . . . . . : WS08-X64-test</span>
<span class="line">   主 DNS 后缀 . . . . . . . . . . . : hacke.testlab</span>
<span class="line">   节点类型  . . . . . . . . . . . . : 混合</span>
<span class="line">   IP 路由已启用 . . . . . . . . . . : 否</span>
<span class="line">   WINS 代理已启用 . . . . . . . . . : 否</span>
<span class="line">   DNS 后缀搜索列表  . . . . . . . . : hacke.testlab</span>
<span class="line"></span>
<span class="line">以太网适配器 本地连接:</span>
<span class="line"></span>
<span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span>
<span class="line">   描述. . . . . . . . . . . . . . . : Intel(R) PRO/1000 MT Network Connection</span>
<span class="line">   物理地址. . . . . . . . . . . . . : 00-0C-29-B2-7E-6E</span>
<span class="line">   DHCP 已启用 . . . . . . . . . . . : 否</span>
<span class="line">   自动配置已启用. . . . . . . . . . : 是</span>
<span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::ec50:c18:6e02:c641%11(首选)</span>
<span class="line">   IPv4 地址 . . . . . . . . . . . . : 192.168.1.2(首选)</span>
<span class="line">   子网掩码  . . . . . . . . . . . . : 255.255.255.0</span>
<span class="line">   默认网关. . . . . . . . . . . . . :</span>
<span class="line">   DHCPv6 IAID . . . . . . . . . . . : 234884137</span>
<span class="line">   DHCPv6 客户端 DUID  . . . . . . . : 00-01-00-01-2A-51-D6-81-00-0C-29-8B-6E-2F</span>
<span class="line"></span>
<span class="line">   DNS 服务器  . . . . . . . . . . . : 192.168.1.1</span>
<span class="line">   TCPIP 上的 NetBIOS  . . . . . . . : 已启用</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后使用 <code>nslookup</code> 来解析域名的IP地址，用解析得到的IP地址进行对比，判断域控制器和DNS服务器是否在同一台服务器上。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\testuser&gt;nslookup hacke.testlab</span>
<span class="line">DNS request timed out.</span>
<span class="line">    timeout was 2 seconds.</span>
<span class="line">服务器:  UnKnown</span>
<span class="line">Address:  192.168.1.1</span>
<span class="line"></span>
<span class="line">名称:    hacke.testlab</span>
<span class="line">Address:  192.168.1.1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li><strong>查看系统详细信息</strong></li></ol><p>“域”即域名（当前域名为hacke.testlab），“登录服务器”为域控制器。如果“域”为“WORKGROUP”，表示当前服务器不在域内。</p><p><img src="/blog/assets/image-20220713202247081-pgC3MX_C.png" alt="image-20220713202247081"></p><p><img src="/blog/assets/image-20220713202308594-Yod4BCDK.png" alt="image-20220713202308594"></p><ol start="3"><li><strong>查询当前登录域及登录用户信息</strong></li></ol><p>执行如下命令，如图2-34所示，“工作站域DNS名称”为域名（如果为“WORKGROUP”，表示当前为非域环境），“登录域”用于表示当前登录的用户是域用户还是本地用户，此处表示当前登录的用户是域用户。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net config workstation</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/blog/assets/image-20220713202523252-DWZWqw-M.png" alt="image-20220713202523252"></p><ol start="4"><li><strong>判断主域</strong>：<code>net time /domain</code></li></ol><p>通常有三种情况</p><p><img src="/blog/assets/image-20220713202929269-B5NAigbo.png" alt="image-20220713202929269"></p><h2 id="探测域内主机" tabindex="-1"><a class="header-anchor" href="#探测域内主机"><span>探测域内主机</span></a></h2><h3 id="_2-5-1-利用netbios快速探测内网" tabindex="-1"><a class="header-anchor" href="#_2-5-1-利用netbios快速探测内网"><span>2.5.1 利用NetBIOS快速探测内网</span></a></h3><p>NetBIOS是局域网程序使用的一种应用程序编程接口（API），为程序提供了请求低级别服务的统一的命令集，为局域网提供了网络及其他特殊功能。几乎所有的局域网都是在NetBIOS协议的基础上工作的。NetBIOS也是计算机的标识名，主要用于局域网中计算机的互访。</p><p>官网：<a href="http://www.unixwiz.net/tools/nbtscan.html#download" target="_blank" rel="noopener noreferrer">nbtscan - NETBIOS nameserver scanner (unixwiz.net)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>帮助列表：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Perry&gt;nbtscan-1.0.35.exe</span>
<span class="line">nbtscan 1.0.35 - 2008-04-08 - http://www.unixwiz.net/tools/</span>
<span class="line"></span>
<span class="line">usage: nbtscan-1.0.35.exe [options] target [targets...]</span>
<span class="line"></span>
<span class="line">   Targets are lists of IP addresses, DNS names, or address</span>
<span class="line">   ranges. Ranges can be in /nbits notation (&quot;192.168.12.0/24&quot;)</span>
<span class="line">   or with a range in the last octet (&quot;192.168.12.64-97&quot;)</span>
<span class="line"></span>
<span class="line">   -V        show Version information</span>
<span class="line">   -f        show Full NBT resource record responses (recommended)</span>
<span class="line">   -H        generate HTTP headers</span>
<span class="line">   -v        turn on more Verbose debugging</span>
<span class="line">   -n        No looking up inverse names of IP addresses responding</span>
<span class="line">   -p &lt;n&gt;    bind to UDP Port &lt;n&gt; (default=0)</span>
<span class="line">   -m        include MAC address in response (implied by &#39;-f&#39;)</span>
<span class="line">   -T &lt;n&gt;    Timeout the no-responses in &lt;n&gt; seconds (default=2 secs)</span>
<span class="line">   -w &lt;n&gt;    Wait &lt;n&gt; msecs after each write (default=10 ms)</span>
<span class="line">   -t &lt;n&gt;    Try each address &lt;n&gt; tries (default=1)</span>
<span class="line">   -1        Use Winsock 1 only</span>
<span class="line">   -P        generate results in perl hashref format</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用方法：直接输入IP地址范围即可</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Perry&gt;nbtscan-1.0.35.exe 192.168.1.0/20</span>
<span class="line">192.168.1.1     HACKE\DC                        SHARING DC</span>
<span class="line">192.168.1.2     HACKE\WS08-X64-TEST             SHARING</span>
<span class="line">192.168.1.3     HACKE\WIN7-X64-TEST             SHARING</span>
<span class="line">^C</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参数含义</p><table><thead><tr><th>Token</th><th>Meaning</th></tr></thead><tbody><tr><td>SHARING</td><td>存在正在运行的文件和打印共享服务，但不一定有内容共享</td></tr><tr><td>DC</td><td>可能是域控制器</td></tr><tr><td>U=<em>user</em></td><td>有登录名为User的用户（不太准确）</td></tr><tr><td>IIS</td><td>可能安装了IIS服务器</td></tr><tr><td>EXCHANGE</td><td>可能安装了Exchange</td></tr><tr><td>NOTES</td><td>可能安装了Lotus Notes电子邮件客户端</td></tr><tr><td>?</td><td>没有识别出该机器的NetBIOS资源（可以使用 -F 选项再次扫描）</td></tr></tbody></table><h3 id="_2-5-2-利用icmp协议快速探测内网" tabindex="-1"><a class="header-anchor" href="#_2-5-2-利用icmp协议快速探测内网"><span>2.5.2 利用ICMP协议快速探测内网</span></a></h3><p>依次对内网中的每个IP地址执行ping命令：<code>for /L %I in (1,1,254) Do @ ping -w1-n 1 192.168.1.%I | findstr &quot;</code></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Perry&gt;for /L %I in (1,1,254) Do @ ping -w1-n 1 192.168.1.%I | findstr &quot;</span>
<span class="line">TTL=&quot;</span>
<span class="line">来自 192.168.1.1 的回复: 字节=32 时间=2ms TTL=128</span>
<span class="line">来自 192.168.1.1 的回复: 字节=32 时间&lt;1ms TTL=128</span>
<span class="line">来自 192.168.1.1 的回复: 字节=32 时间=6ms TTL=128</span>
<span class="line">来自 192.168.1.1 的回复: 字节=32 时间&lt;1ms TTL=128</span>
<span class="line">来自 192.168.1.2 的回复: 字节=32 时间=2ms TTL=128</span>
<span class="line">来自 192.168.1.2 的回复: 字节=32 时间&lt;1ms TTL=128</span>
<span class="line">来自 192.168.1.2 的回复: 字节=32 时间&lt;1ms TTL=128</span>
<span class="line">来自 192.168.1.2 的回复: 字节=32 时间&lt;1ms TTL=128</span>
<span class="line">来自 192.168.1.3 的回复: 字节=32 时间&lt;1ms TTL=128</span>
<span class="line">来自 192.168.1.3 的回复: 字节=32 时间&lt;1ms TTL=128</span>
<span class="line">来自 192.168.1.3 的回复: 字节=32 时间&lt;1ms TTL=128</span>
<span class="line">来自 192.168.1.3 的回复: 字节=32 时间&lt;1ms TTL=128</span>
<span class="line">^C</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>vbs脚本：</p><div class="language-vb line-numbers-mode" data-highlighter="prismjs" data-ext="vb" data-title="vb"><pre><code><span class="line">strSubNet <span class="token operator">=</span> <span class="token string">&quot;192.168.1.&quot;</span></span>
<span class="line"><span class="token keyword">Set</span> objFSO<span class="token operator">=</span> CreateObject<span class="token punctuation">(</span><span class="token string">&quot;Scripting.FileSystemObject&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">Set</span> objTS <span class="token operator">=</span> objfso<span class="token punctuation">.</span>CreateTextFile<span class="token punctuation">(</span><span class="token string">&quot;C:\PingResult.txt&quot;</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">For</span> i <span class="token operator">=</span> <span class="token number">1</span> <span class="token keyword">To</span> <span class="token number">254</span></span>
<span class="line">strComputer <span class="token operator">=</span> strSubNet <span class="token operator">&amp;</span> i</span>
<span class="line">blnResult <span class="token operator">=</span> Ping<span class="token punctuation">(</span>strComputer<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">If</span> blnResult <span class="token operator">=</span> <span class="token boolean">True</span> <span class="token keyword">Then</span></span>
<span class="line">objTS<span class="token punctuation">.</span>WriteLine <span class="token string">&quot;Ping &quot;</span> <span class="token operator">&amp;</span> strComputer <span class="token operator">&amp;</span> <span class="token string">&quot; success!&quot;</span></span>
<span class="line"><span class="token keyword">End</span> <span class="token keyword">If</span></span>
<span class="line"><span class="token keyword">Next</span></span>
<span class="line"></span>
<span class="line">objTS<span class="token punctuation">.</span>Close</span>
<span class="line">WScript<span class="token punctuation">.</span>Echo <span class="token string">&quot;Done!&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">Function</span> Ping<span class="token punctuation">(</span>strComputer<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">Set</span> objWMIService <span class="token operator">=</span> GetObject<span class="token punctuation">(</span><span class="token string">&quot;winmgmts:\\.\root\cimv2&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">Set</span> colItems <span class="token operator">=</span> objWMIService<span class="token punctuation">.</span>ExecQuery<span class="token punctuation">(</span><span class="token string">&quot;Select * From Win32_PingStatus Where Address=&#39;&quot;</span> <span class="token operator">&amp;</span> strComputer <span class="token operator">&amp;</span> <span class="token string">&quot;&#39;&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">For</span> <span class="token keyword">Each</span> objItem <span class="token keyword">In</span> colItems</span>
<span class="line"><span class="token keyword">Select</span> <span class="token keyword">case</span> objItem<span class="token punctuation">.</span>StatusCode</span>
<span class="line"><span class="token keyword">Case</span> <span class="token number">0</span></span>
<span class="line">Ping <span class="token operator">=</span> <span class="token boolean">True</span></span>
<span class="line"><span class="token keyword">Case</span> <span class="token keyword">Else</span></span>
<span class="line">Ping <span class="token operator">=</span> <span class="token boolean">False</span></span>
<span class="line"><span class="token keyword">End</span> <span class="token keyword">select</span></span>
<span class="line"><span class="token keyword">Exit</span> <span class="token keyword">For</span></span>
<span class="line"><span class="token keyword">Next</span></span>
<span class="line"><span class="token keyword">End</span> <span class="token keyword">Function</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="/blog/assets/image-20220714175401285-DNYhR5va.png" alt="image-20220714175401285"></p><h3 id="_2-5-3-通过arp扫描探测内网" tabindex="-1"><a class="header-anchor" href="#_2-5-3-通过arp扫描探测内网"><span>2.5.3 通过ARP扫描探测内网</span></a></h3><ol><li>arp-scan工具</li></ol><p>直接把 arp.exe 上传到目标机器中并运行，可以自定义掩码、指定扫描范围等，命令如下</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Perry&gt;arp-scan.exe -t 192.168.1.0/20</span>
<span class="line">Reply that 00:0C:29:75:33:21 is 192.168.1.1 in 15.845100</span>
<span class="line">Reply that 00:0C:29:B2:7E:6E is 192.168.1.2 in 14.348600</span>
<span class="line">Reply that 00:0C:29:78:B1:53 is 192.168.1.3 in 0.088400</span>
<span class="line">Reply that 00:0C:29:78:B1:53 is 192.168.1.255 in 0.112500</span>
<span class="line">Enter Ctrl-C to Abort. Please waiting...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>*：<a href="https://github.com/QbsuranAlang/arp-scan-windows-" target="_blank" rel="noopener noreferrer">QbsuranAlang/arp-scan-windows-: send arp request to whole specific LAN (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>*：OneDrive - Business\Documents\NUIT\内网安全攻防\arp-scan.exe</p><ol start="2"><li><p>Empire中的arpscan模块（待补充） PDF65</p></li><li><p>Nishang中的Invoke-ARPScan.ps1脚本（待补充）PDF66</p></li></ol><p>使用Nishang中的Invoke-ARPScan.ps1脚本，可以将脚本上传到目标主机中运行，也可以直接远程加载脚本、自定义掩码和扫描范围，命令如下。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">powershell.exe -exec bypass -Command &quot;&amp; {Import-Module C:\windows\temp\Invoke-ARPScan.ps1; Invoke-ARPScan -CIDR 192.168.1.0/20}&quot; &gt;&gt; C:\windows\temp\log.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-5-4-通过常规tcp-udp端口扫描探测内网" tabindex="-1"><a class="header-anchor" href="#_2-5-4-通过常规tcp-udp端口扫描探测内网"><span>2.5.4 通过常规TCP/UDP端口扫描探测内网</span></a></h3><p>ScanLine 是一款经典的端口扫描工具，可以在所有版本的Windows操作系统中使用，体积小，仅使用单个文件，同时支持TCP/UDP端口扫描，命令如下</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">ScanLine.exe -h -t 22,80-89,110,389,445,3389,1099,1433,2049,6379,7001,8080,1521,3306,3389,5432-u53,161,137,139 -O c:\windows\temp\log.txt -p 192.168.1.1-254 /b</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Perry\Hacke&gt;ScanLine.exe -h -t 22,80-89,110,389,445,3389,1099,1433,2049,6379,7001,8080,1521,3306,3389,5432-u53,161,137,139 -O c:\windows\temp\log.txt -p 192.168.1.1-254 /b</span>
<span class="line">ScanLine (TM) 1.01</span>
<span class="line">Copyright (c) Foundstone, Inc. 2002</span>
<span class="line">http://www.foundstone.com</span>
<span class="line"></span>
<span class="line">Scan of 254 IPs started at Thu Jul 14 20:50:24 2022</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-6-扫描域内端口" tabindex="-1"><a class="header-anchor" href="#_2-6-扫描域内端口"><span>2.6 扫描域内端口</span></a></h2><h3 id="_2-6-1-telnet扫描" tabindex="-1"><a class="header-anchor" href="#_2-6-1-telnet扫描"><span>2.6.1 Telnet扫描</span></a></h3><p>PS: 需要启用 Telnet 功能</p><p><img src="/blog/assets/image-20220718160014604-CNBoO-zm.png" alt="image-20220718160014604"></p><p>语法：<code>telnet [PC Name] [Port]</code></p><p>实例：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">telnet DC 22</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">telnet DC 1443</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-6-2-s扫描器-略" tabindex="-1"><a class="header-anchor" href="#_2-6-2-s扫描器-略"><span>2.6.2 S扫描器 (略)</span></a></h3><h3 id="_2-6-3-metasploit端口扫描-略" tabindex="-1"><a class="header-anchor" href="#_2-6-3-metasploit端口扫描-略"><span>2.6.3 Metasploit端口扫描 (略)</span></a></h3><h3 id="_2-6-4-powersploit-的-invoke-portscan-ps1-脚本-略" tabindex="-1"><a class="header-anchor" href="#_2-6-4-powersploit-的-invoke-portscan-ps1-脚本-略"><span>2.6.4 PowerSploit 的 Invoke-portscan.ps1 脚本 (略)</span></a></h3><h3 id="_2-6-5-nishang的invoke-portscan模块-略" tabindex="-1"><a class="header-anchor" href="#_2-6-5-nishang的invoke-portscan模块-略"><span>2.6.5 Nishang的Invoke-PortScan模块 (略)</span></a></h3><h3 id="_2-6-6-端口banner信息" tabindex="-1"><a class="header-anchor" href="#_2-6-6-端口banner信息"><span>2.6.6 端口Banner信息</span></a></h3><h4 id="文件共享" tabindex="-1"><a class="header-anchor" href="#文件共享"><span>文件共享</span></a></h4><table><thead><tr><th>端口</th><th>说明</th><th>利用</th></tr></thead><tbody><tr><td>21、22、69</td><td>FTP/TFTP</td><td>允许匿名上传、下载、爆破、嗅探</td></tr><tr><td>2049</td><td>NFS</td><td>配置不当</td></tr><tr><td>139</td><td>SAMBA</td><td>爆破、未授权访问、远程代码执行</td></tr><tr><td>389</td><td>LDAP目录访问协议</td><td>注入、允许匿名访问、弱口令</td></tr></tbody></table><h4 id="远程连接" tabindex="-1"><a class="header-anchor" href="#远程连接"><span>远程连接</span></a></h4><table><thead><tr><th>端口</th><th>说明</th><th>利用</th></tr></thead><tbody><tr><td>22</td><td>SSH</td><td>爆破、SSH隧道及内网代理转发、文件传输</td></tr><tr><td>23</td><td>Telnet</td><td>爆破、嗅探、弱口令</td></tr><tr><td>3389</td><td>RDP</td><td>Shift后门(Win Server 2003-)、爆破</td></tr><tr><td>5900</td><td>VNC</td><td>弱口令爆破</td></tr><tr><td>5632</td><td>PcAnyWhere服务</td><td>抓取密码、代码执行</td></tr></tbody></table><h4 id="web应用" tabindex="-1"><a class="header-anchor" href="#web应用"><span>Web应用</span></a></h4><table><thead><tr><th>端口</th><th>说明</th><th>利用</th></tr></thead><tbody><tr><td>80、443、8080</td><td>常见Web服务端口</td><td>Web攻击、爆破、对应服务器版本漏洞</td></tr><tr><td>7001、7002</td><td>WebLogic控制台</td><td>Java反序列化、弱口令</td></tr><tr><td>8080、8089</td><td>JBoss/Resin/Jetty/Jenkins</td><td>反序列化、控制台弱口令</td></tr><tr><td>9090</td><td>WebSphere控制</td><td>Java反序列化、弱口令</td></tr><tr><td>4848</td><td>GlassFish控制台</td><td>弱口令</td></tr><tr><td>1352</td><td>Lotus Domino邮件服务</td><td>弱口令、信息泄露、爆破</td></tr><tr><td>10000</td><td>webmin控制面板</td><td>弱口令</td></tr></tbody></table><h4 id="数据库服务" tabindex="-1"><a class="header-anchor" href="#数据库服务"><span>数据库服务</span></a></h4><table><thead><tr><th>端口</th><th>说明</th><th>利用</th></tr></thead><tbody><tr><td>3306</td><td>MySQL数据库</td><td>注入、提权、爆破</td></tr><tr><td>1433</td><td>MySQL数据库</td><td>注人、提权、SA弱口令、爆破</td></tr><tr><td>1522</td><td>Pracle数据库</td><td>TNS爆破、注人、反弹Shell</td></tr><tr><td>5432</td><td>PostgreSQL数据库</td><td>爆破、注入、弱口、</td></tr><tr><td>27017、27018</td><td>MongoDB数据库</td><td>爆破、未授权访问</td></tr><tr><td>6379</td><td>Redis数据库</td><td>可尝试未授权访问、弱口令爆破</td></tr><tr><td>5000</td><td>Sysbase/DB2 数据库</td><td>爆破、注人</td></tr></tbody></table><h4 id="邮件服务" tabindex="-1"><a class="header-anchor" href="#邮件服务"><span>邮件服务</span></a></h4><table><thead><tr><th>端口</th><th>说明</th><th>利用</th></tr></thead><tbody><tr><td>25</td><td>SMTP</td><td>邮件伪造</td></tr><tr><td>110</td><td>POP3</td><td>爆破、嗅探</td></tr><tr><td>143</td><td>IMAP</td><td>爆破</td></tr></tbody></table><h4 id="网络协议" tabindex="-1"><a class="header-anchor" href="#网络协议"><span>网络协议</span></a></h4><table><thead><tr><th>端口</th><th>说明</th><th>利用</th></tr></thead><tbody><tr><td>53</td><td>DNS</td><td>允许区域传送、DNS劫持、缓存投毒、欺骗</td></tr><tr><td>67、68</td><td>DHCP</td><td>劫持、欺骗</td></tr><tr><td>161</td><td>SNMP</td><td>爆破、收集目标内网信息</td></tr></tbody></table><h4 id="特殊服务" tabindex="-1"><a class="header-anchor" href="#特殊服务"><span>特殊服务</span></a></h4><table><thead><tr><th>端口</th><th>说明</th><th>利用</th></tr></thead><tbody><tr><td>2181</td><td>ZooKeeper服务</td><td>未授权访问</td></tr><tr><td>8069</td><td>Zabbix服务</td><td>远程执行、SQL注入</td></tr><tr><td>9200、9300</td><td>Elasticsearch服务</td><td>远程执行</td></tr><tr><td>11211</td><td>Memcached服务</td><td>未授权访问</td></tr><tr><td>521、513、514</td><td>Linux rexec服务</td><td>爆破、远程登陆</td></tr><tr><td>873</td><td>rsync服务</td><td>匿名访问、文件上传</td></tr><tr><td>3690</td><td>SVN访问</td><td>SVN泄露、未授权访问</td></tr><tr><td>50000</td><td>SAP Management Console</td><td>远程执行</td></tr></tbody></table><h2 id="_2-7-收集域内信息" tabindex="-1"><a class="header-anchor" href="#_2-7-收集域内信息"><span>2.7 收集域内信息</span></a></h2><p><strong>查询域</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net view /domain</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>查询域内所有计算机</strong></p><p>若查询时出现：</p><p>​ dev 可能是开发服务器</p><p>​ web, app 可能是Web服务器</p><p>​ NAS 可能是存储服务器</p><p>​ fileserver 可能是文件服务器</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net view /domain:HACKE</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>查询域内所有用户组列表</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net group /domain</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Administrator&gt;net group /domain</span>
<span class="line"></span>
<span class="line">\\DC 的组帐户</span>
<span class="line"></span>
<span class="line">-------------------------------------------------------------------------------</span>
<span class="line">*Cloneable Domain Controllers</span>
<span class="line">*DnsUpdateProxy</span>
<span class="line">*Domain Admins			# 域管理员</span>
<span class="line">*Domain Computers		# 域内机器</span>
<span class="line">*Domain Controllers		# 域控制器</span>
<span class="line">*Domain Guests			# 域访客（权限低）</span>
<span class="line">*Domain Users			# 域用户</span>
<span class="line">*Enterprise Admins		# 企业系统管理员</span>
<span class="line">*Enterprise Read-only Domain Controllers</span>
<span class="line">*Group Policy Creator Owners</span>
<span class="line">*Protected Users</span>
<span class="line">*Read-only Domain Controllers</span>
<span class="line">*Schema Admins</span>
<span class="line">命令成功完成。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在默认情况下，Domain Admins和Enterprise Admins对域内所有域控制器有完全控制权限。</p><p><strong>查询所有域成员计算机列表</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net group &quot;domain computers&quot; /domain</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Administrator&gt;net group &quot;domain computers&quot; /domain</span>
<span class="line">组名     Domain Computers</span>
<span class="line">注释     加入到域中的所有工作站和服务器</span>
<span class="line"></span>
<span class="line">成员</span>
<span class="line"></span>
<span class="line">-------------------------------------------------------------------------------</span>
<span class="line">WIN7-X64-TEST$           WS08-X64-TEST$</span>
<span class="line">命令成功完成。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>获取域密码信息</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net accounts /domain</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Administrator&gt;net accounts /domain</span>
<span class="line">强制用户在时间到期之后多久必须注销?:     从不</span>
<span class="line">密码最短使用期限(天):                    1</span>
<span class="line">密码最长使用期限(天):                    42</span>
<span class="line">密码长度最小值:                          7</span>
<span class="line">保持的密码历史记录长度:                  24</span>
<span class="line">锁定阈值:                                从不</span>
<span class="line">锁定持续时间(分):                        30</span>
<span class="line">锁定观测窗口(分):                        30</span>
<span class="line">计算机角色:                              PRIMARY</span>
<span class="line">命令成功完成。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>获取域信任信息</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">nltest /domain_trusts</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Administrator&gt;nltest /domain_trusts</span>
<span class="line">域信任的列表:</span>
<span class="line">    0: HACKE hacke.testlab (NT 5) (Forest Tree Root) (Primary Domain) (Native)</span>
<span class="line">此命令成功完成</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-8-查找域控制器" tabindex="-1"><a class="header-anchor" href="#_2-8-查找域控制器"><span>2.8 查找域控制器</span></a></h2><p><strong>查看域控制器的机器名</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">nltest /DCLIST:hacke</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Administrator&gt;nltest /DCLIST:hacke</span>
<span class="line">获得域“hacke”中 DC 的列表(从“\\DC”中)。</span>
<span class="line">    DC.hacke.testlab [PDC]  [DS] 站点: Default-First-Site-Name</span>
<span class="line">此命令成功完成</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，域控制器的机器名为“DC”。</p><p><strong>查看域控制器主机名</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Nslookup -type=SRV _ldap._tcp</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Windows\system32&gt;Nslookup -type=SRV _ldap._tcp</span>
<span class="line">DNS request timed out.</span>
<span class="line">    timeout was 2 seconds.</span>
<span class="line">服务器:  UnKnown</span>
<span class="line">Address:  192.168.1.1</span>
<span class="line"></span>
<span class="line">_ldap._tcp.hacke.testlab        SRV service location:</span>
<span class="line">          priority       = 0</span>
<span class="line">          weight         = 100</span>
<span class="line">          port           = 389</span>
<span class="line">          svr hostname   = dc.hacke.testlab</span>
<span class="line">dc.hacke.testlab        internet address = 192.168.1.1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可见，主机名为&quot;dc&quot;</p><p><strong>查看当前时间</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net time /domain</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\testuser&gt;net time /domain</span>
<span class="line">\\DC.hacke.testlab 的当前时间是 2022/7/23 15:38:15</span>
<span class="line"></span>
<span class="line">命令成功完成。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通常，时间服务器为主域控制器，即上述中的&quot;DC&quot;</p><p><strong>查看域控制器组</strong></p><p>在实际网络中，一个域内一般存在两台或两台以上的域控制器；</p><p>目的：一旦主域控制器发生故障，备用的域控制器可以保证域内的服务和验证工作正常进行。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net group &quot;Domain Controllers&quot; /domain</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\testuser&gt;net group &quot;Domain Controllers&quot; /domain</span>
<span class="line">这项请求将在域 hacke.testlab 的域控制器处理。</span>
<span class="line"></span>
<span class="line">组名     Domain Controllers</span>
<span class="line">注释     域中所有域控制器</span>
<span class="line"></span>
<span class="line">成员</span>
<span class="line"></span>
<span class="line">-------------------------------------------------------------------------------</span>
<span class="line">DC$</span>
<span class="line">命令成功完成。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看域控制器组，有一台机器名为“DC”的域控制器。</p><h2 id="_2-9-获取域内用户和管理员信息" tabindex="-1"><a class="header-anchor" href="#_2-9-获取域内用户和管理员信息"><span>2.9 获取域内用户和管理员信息</span></a></h2><h3 id="_2-9-1-查询所有域用户列表" tabindex="-1"><a class="header-anchor" href="#_2-9-1-查询所有域用户列表"><span>2.9.1 查询所有域用户列表</span></a></h3><p><strong>向域控制器进行查询</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\testuser&gt;net user /domain</span>
<span class="line">这项请求将在域 hacke.testlab 的域控制器处理。</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">\\DC.hacke.testlab 的用户帐户</span>
<span class="line"></span>
<span class="line">-------------------------------------------------------------------------------</span>
<span class="line">Administrator            Guest                    krbtgt</span>
<span class="line">testuser</span>
<span class="line">命令成功完成。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>获取域内用户的详细信息</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">wmic useraccount get /all</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/blog/assets/image-20220723160008674-CidZtqBR.png" alt="image-20220723160008674"></p><p><strong>查看存在的用户</strong></p><p>*：Windows 2012+</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">dsquery user</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Administrator&gt;dsquery user</span>
<span class="line">&quot;CN=Administrator,CN=Users,DC=hacke,DC=testlab&quot;</span>
<span class="line">&quot;CN=Guest,CN=Users,DC=hacke,DC=testlab&quot;</span>
<span class="line">&quot;CN=krbtgt,CN=Users,DC=hacke,DC=testlab&quot;</span>
<span class="line">&quot;CN=test,CN=Users,DC=hacke,DC=testlab&quot;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查询本地管理员组用户</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net localgroup administrators</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Domain Admins组中的用户默认为域内机器的本地管理员用户。在实际应用中，为了方便管理，会有域用户被设置为域机器的本地管理员用户。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Administrator&gt;net localgroup administrators</span>
<span class="line">别名     administrators</span>
<span class="line">注释     管理员对计算机/域有不受限制的完全访问权</span>
<span class="line"></span>
<span class="line">成员</span>
<span class="line"></span>
<span class="line">-------------------------------------------------------------------------------</span>
<span class="line">Administrator</span>
<span class="line">Domain Admins</span>
<span class="line">Enterprise Admins</span>
<span class="line">命令成功完成。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-9-2-查询域管理员用户组" tabindex="-1"><a class="header-anchor" href="#_2-9-2-查询域管理员用户组"><span>2.9.2 查询域管理员用户组</span></a></h3><p><strong>查询域管理员用户</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net group &quot;domain admins&quot; /domain</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Administrator&gt;net group &quot;domain admins&quot; /domain</span>
<span class="line">组名     Domain Admins</span>
<span class="line">注释     指定的域管理员</span>
<span class="line"></span>
<span class="line">成员</span>
<span class="line"></span>
<span class="line">-------------------------------------------------------------------------------</span>
<span class="line">Administrator</span>
<span class="line">命令成功完成。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>查询管理员用户组</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net group &quot;Enterprise Admins&quot; /domain</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Administrator&gt;net group &quot;Enterprise Admins&quot; /domain</span>
<span class="line">组名     Enterprise Admins</span>
<span class="line">注释     企业的指定系统管理员</span>
<span class="line"></span>
<span class="line">成员</span>
<span class="line"></span>
<span class="line">-------------------------------------------------------------------------------</span>
<span class="line">Administrator</span>
<span class="line">命令成功完成。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-10-定位域管理员" tabindex="-1"><a class="header-anchor" href="#_2-10-定位域管理员"><span>2.10 定位域管理员</span></a></h2><p>假设已经在Windows域中取得了普通用户权限，希望在域内横向移动，需要知道域内用户登录的位置、他是否是任何系统的本地管理员、他所属的组、他是否有权访问文件共享等。枚举主机、用户和组，有助于更好地了解域的布局。</p><h3 id="_2-10-2-常用域管理员定位工具" tabindex="-1"><a class="header-anchor" href="#_2-10-2-常用域管理员定位工具"><span>2.10.2 常用域管理员定位工具</span></a></h3><p>常用的域管理员定位工具有psloggedon.exe、PVEFindADUser.exe、netsess.exe、以及hunter、NetView等。在PowerShell 中，常用的工具是PowerView。</p><p><strong>psloggedon.exe</strong></p><p>在Windows平台上，可以执行命令&quot;<code>net session</code>”来查看谁使用了本机资源，但是没有命令可以用来查看谁在使用远程计算机资源、谁登录了本地或远程计算机。</p><p>使用psloggedon.exe，可以查看本地登录的用户和通过本地计算机或远程计算机的资源登录的用户。如果指定的是用户名而不是计算机名，psloggedon.exe会搜索网上邻居中的计算机，并显示该用户当前是否已经登录。其原理是通过检查注册表HKEY_USERS项的key值来查询谁登录过（需要调用NetSessionEnum API），但某些功能需要管理员权限才能使用。</p><p>语法：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">psloggedon [-] [-l] [-x] [\\computername | username]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>说明：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">-：显示支持的选项和用于输出值的单位。</span>
<span class="line">-l：仅显示本地登录，不显示本地和网络资源登录。</span>
<span class="line">-x：不显示登录时间。</span>
<span class="line">\\computername：指定要列出登录信息的计算机的名称。</span>
<span class="line">username：指定用户名，在网络中搜索该用户登录的计算机。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实例：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\testuser\Downloads\2&gt;PsLoggedon.exe \\DC</span>
<span class="line"></span>
<span class="line">PsLoggedon v1.35 - See who&#39;s logged on</span>
<span class="line">Copyright (C) 2000-2016 Mark Russinovich</span>
<span class="line">Sysinternals - www.sysinternals.com</span>
<span class="line"></span>
<span class="line">Users logged on locally:</span>
<span class="line">     &lt;unknown time&gt;             HACKE\Administrator</span>
<span class="line"></span>
<span class="line">Users logged on via resource shares:</span>
<span class="line">     2022/7/23 20:36:01         HACKE\testuser</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>PVEFindADUser.exe</strong></p><p>PVEFindADUser.exe可用于查找活动目录用户登录的位置、枚举域用户，以及查找在特定计算机上登录的用户，包括本地用户、通过RDP登录的用户、用于运行服务和计划任务的用户。运行该工具的计算机需要配置.NET Framework 2.0环境，并且需要具有管理员权限。</p><p>语法：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">PVEFindADUser.exe &lt;参数&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>说明：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">-h：显示帮助信息。</span>
<span class="line">-u：检查程序是否有新版本。</span>
<span class="line">-current[&quot;username&quot;]：如果仅指定了-current参数，将获取目标计算机上当前登录的所有用户。如果指定了用户名（DomainUsername），则显示该用户登录的计算机。</span>
<span class="line">-last[&quot;username&quot;]：如果仅指定了-last参数，将获取目标计算机的最后一个登录用户。如果指定了用户名（DomainUsername），则显示此用户上次登录的计算机。根据网络的安全策略，可能会隐藏最后一个登录用户的用户名，此时使用该工具可能无法得到该用户名。</span>
<span class="line">-noping：阻止该工具在尝试获取用户登录信息之前对目标计算机执行ping命令。</span>
<span class="line">-target：可选参数，用于指定要查询的主机。如果未指定此参数，将查询当前域中的所有主机。如果指定了此参数，则后跟一个由逗号分隔的主机名列表。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>若直接运行“pveadfinduser.exe-current”命令，则可显示域中所有计算机（计算机、服务器、域控制器等）上当前登录的所有用户。查询结果将被输出到report.csv文件中。</p><p>实例：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\testuser\Downloads\2&gt;PVEFindADUser.exe -current</span>
<span class="line"> -----------------------------------------</span>
<span class="line">  PVE Find AD Users</span>
<span class="line">  Peter Van Eeckhoutte</span>
<span class="line">  (c) 2009 - http://www.corelan.be:8800</span>
<span class="line">  Version : 1.0.0.12</span>
<span class="line"> -----------------------------------------</span>
<span class="line"> [+] Finding currently logged on users ? true</span>
<span class="line"> [+] Finding last logged on users ? false</span>
<span class="line"></span>
<span class="line"> [+] Enumerating all computers...</span>
<span class="line"> [+] Number of computers found : 3</span>
<span class="line"> [+] Launching queries</span>
<span class="line">     [+] Processing host : DC.hacke.testlab (Windows Server 2012 R2 Standard)</span>
<span class="line">         - Logged on user : hacke\administrator</span>
<span class="line">     [+] Processing host : WIN7-X64-TEST.hacke.testlab (Windows 7 专业版;Service Pack 1)</span>
<span class="line">     [+] Processing host : WS08-X64-TEST.hacke.testlab (Windows Server 2008 R2 Standard;Service Pack 1)</span>
<span class="line">         - Logged on user : hacke\testuser</span>
<span class="line"> [+] Report written to report.csv</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>netview.exe</strong></p><p>netview.exe是一个枚举工具，使用WinAPI枚举系统，利用NetSessionEnum找寻登录会话，利用NetShareEnum找寻共享，利用NetWkstaUserEnum枚举登录的用户。同时，netview.exe能够查询共享人口和有价值的用户。（绝大部分功能不需要管理员权限就可以使用）</p><p>语法：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">netview.exe &lt;参数&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>说明：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">-h：显示帮助信息。</span>
<span class="line">-f filename.txt：指定要提取主机列表的文件。-e filename.txt：指定要排除的主机名的文件。</span>
<span class="line">-o filename.txt：将所有输出重定向到指定的文件。</span>
<span class="line">-d domain：指定要提取主机列表的域。如果没有指定，则从当前域中提取主机列表。</span>
<span class="line">-g group：指定搜索的组名。如果没有指定，则在Domain Admins组中搜索。</span>
<span class="line">-c：对已找到的共享目录/文件的访问权限进行检查。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Nmap 的NSE 脚本</strong></p><p><a href="https://nmap.org/nsedoc/scripts/smb-enum-sessions.html" target="_blank" rel="noopener noreferrer">smb-enum-sessions NSE script — Nmap Scripting Engine documentation<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>如果存在域账户或者本地账户，就可以使用Nmap的smb-enum-sessions.nse引擎获取远程机器的登录会话（不需要管理员权限）。</p><p><img src="/blog/assets/image-20220723205216553-CVMr_otL.png" alt="image-20220723205216553"></p><p>说明：</p><p>smb-enum-domains.nse：对域控制器进行信息收集，可以获取主机信息、用户、可使用密码策略的用户等。 smb-enum-users.nse：在进行域渗透测试时，如果获得了域内某台主机的权限，但是权限有限，无法获取更多的域用户信息，就可以借助这个脚本对域控制器进行扫描。</p><p>smb-enum-shares.nse：遍历远程主机的共享目录。 smb-enum-processes.nse：对主机的系统进程进行遍历。通过这些信息，可以知道目标主机上正在运行哪些软件。 smb-enum-sessions.nse：获取域内主机的用户登录会话，查看当前是否有用户登录。 smb-os-discovery.nse：收集目标主机的操作系统、计算机名、域名、域林名称、NetBIOS机器名、NetBIOS域名、工作组、系统时间等信息。</p><p><strong>PowerView 脚本</strong></p><p><a href="https://github.com/PowerShellEmpire/PowerTools/tree/master/PowerView" target="_blank" rel="noopener noreferrer">PowerTools/PowerView at master · PowerShellEmpire/PowerTools (github.com)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>PowerView是一款PowerShell脚本，提供了辅助定位关键用户的功能。</p><p>说明：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Invoke-StealthUserHunter：只需要进行一次查询，就可以获取域里面的所有用户。使用方法为，从user.HomeDirectories中提取所有用户，并对每台服务器进行Get-NetSessions获取。</span>
<span class="line">因为不需要使用Invoke-UserHunter对每台机器进行操作，所以这个方法的隐蔽性相对较高</span>
<span class="line">（但涉及的机器不一定全面）。PowerView默认使用Invoke-StealthUserHunter，如果找不到需要的信息，就使用Invoke-UserHunter Invoke-UserHunter：找到域内特定的用户群，接收用户名、用户列表和域组查询，接收一个主机列表或查询可用的主机域名。它可以使用Get-NetSessions和Get-NetLoggedon（调用NetSessionEnum 和 NetWkstaUserEnum API）扫描每台服务器并对扫描结果进行比较，从而找出目标用户集，在使用时不需要管理员权限。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>实例：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Administrator\Downloads&gt;powershell.exe -exec bypass -Command &quot;&amp; {Import-Module C:\PowerView.ps1; Invoke-UserHunter}&quot;</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">UserDomain   : HACKE</span>
<span class="line">UserName     : Administrator</span>
<span class="line">ComputerName : DC.hacke.testlab</span>
<span class="line">IP           : 192.168.1.1</span>
<span class="line">SessionFrom  :</span>
<span class="line">LocalAdmin   :</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Empire user_hunter 模块</strong></p><p>在Empire中也有类似Invoke-UserHunter的模块--user_hunter。这个模块用于查找域管理员登录的机器。</p><p>使用 usemodule situational_awareness/network/powerview/user_hunter 模块，可以清楚地看到哪个用户登录了哪台主机。在本实验中，域管理员曾经登录机器名为WIN7-64.shuteer.testlab、IP地址为192.168.31.251的主机。</p><p><img src="/blog/assets/image-20220723210531405-Cq_o5ioO.png" alt="image-20220723210531405"></p><h2 id="_2-11-查找域管理进程" tabindex="-1"><a class="header-anchor" href="#_2-11-查找域管理进程"><span>2.11 查找域管理进程</span></a></h2><h3 id="_2-11-1-获取域管理员列表" tabindex="-1"><a class="header-anchor" href="#_2-11-1-获取域管理员列表"><span>2.11.1 获取域管理员列表</span></a></h3><p><strong>获取域管理员列表</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net group &quot;Domain Admins&quot; /domain</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>实例：</p><p>先到域管理中将testuser添加为Domain Admins，以便后续查询</p><p><img src="/blog/assets/image-20220724230538459-BxuWj-0f.png" alt="image-20220724230538459"></p><p>执行命令：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">C:\Users\Administrator\Downloads&gt;net group &quot;Domain Admins&quot; /domain</span>
<span class="line">组名     Domain Admins</span>
<span class="line">注释     指定的域管理员</span>
<span class="line"></span>
<span class="line">成员</span>
<span class="line"></span>
<span class="line">-------------------------------------------------------------------------------</span>
<span class="line">Administrator            testuser</span>
<span class="line">命令成功完成。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>列出本机所有进程及进程用户</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">tasklist /v</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="/blog/assets/image-20220724233636029-S-yCdiV8.png" alt="image-20220724233636029"></p><p><img src="/blog/assets/image-20220724233651512-BkBQPiSg.png" alt="image-20220724233651512"></p><p><strong>寻找进程所有者为域管理员的进程</strong></p><p>通过上述操作可以看出，当前存在域管理员进程。</p><p>使用以上方法，如果能顺便找到域管理员进程是最好的。（但现实中一般找不到）</p><h3 id="_2-11-2-查询域控制器的域用户会话" tabindex="-1"><a class="header-anchor" href="#_2-11-2-查询域控制器的域用户会话"><span>2.11.2 查询域控制器的域用户会话</span></a></h3><p><strong>查询域控制器列表</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net group &quot;Domain Controllers&quot; /domain</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>收集域管理员列表</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net gtoup &quot;Domain Admins&quot; /domain</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>收集所有活动域的会话列表</strong></p><p><a href="https://www.joeware.net/freetools/tools/netsess/index.htm" target="_blank" rel="noopener noreferrer">NetSess (joeware.net)<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>使用 netsess.exe 查询每个域控制器，收集所有活动域会话列表。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">NetSess -h</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>交叉引用域管理员列表域活动会话列表</strong></p><p>对域管理员列表和活动会话列表进行交叉引用，可以确定哪些IP地址有活动域令牌。</p><p>将域控制器列表添加到dcs.txt中，将域管理员列表添加到admins.txt中，并与netsess.exe放在同一目录下。运行以下脚本，会在当前目录下生成一个文本文件sessions.txt。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">FOR /F %i in (dcs.txt) do @echo [+] Querying DC %i &amp;&amp; @netsecc -h %i 2&gt;nul &gt;sessions.txt &amp;&amp; FOR /F %a in (admins.txt) Do @type sessions.txt| @findstr /I %a</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>网上也有类似的脚本。例如，Get Domain Admins（GDA）批处理脚本，可以自动完成整个过程。</p><p>*：https://raw.githubusercontent.com/nullbind/Other-Projects/master/GDA/GDA.bat</p><h3 id="_2-11-3-查询远程系统中运行的任务" tabindex="-1"><a class="header-anchor" href="#_2-11-3-查询远程系统中运行的任务"><span>2.11.3 查询远程系统中运行的任务</span></a></h3><p>首先，从Domain Admins组中收集域管理员列表</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">net group &quot;Domain Admins&quot; /domain</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>然后，运行脚本，将目标域系统列表添加到ips.txt文件中，将收集的域管理员列表添加到names.txt文件中</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">FOR /F %i in &lt;ips. txt&gt; DO @echo [+] %i &amp;&amp; @tasklist /V /S %i /U user /P pass word 2&gt;NUL &gt; output.txt &amp;&amp; FOR /F %n in (names.txt) DO @type output.txt findstr %n &gt; NUL &amp;&amp; echo [!] %n was found running a process on %i &amp;&amp; pause</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_2-11-4-扫描远程系统的netbios信息" tabindex="-1"><a class="header-anchor" href="#_2-11-4-扫描远程系统的netbios信息"><span>2.11.4 扫描远程系统的NetBIOS信息</span></a></h3><p>*：非所有Windows版本可用</p><p>收集域管理员列表，运行如下脚本，将目标域系统列表添加到ips.txt文件中，将收集的域管理员列表添加到admins.txt文件中，并置于同一目录下。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">for /F %i in (ips.txt) do @echo [+] Checking %i &amp;&amp; nbtstat -A %i 2&gt;NUL &gt;nbsessions.txt &amp;&amp; FOR /F %n in (admins.txt) DO @type nbsessions.txt | findstr /I %n &gt; NUL &amp;&amp; echo [!] %n was found logged into %i</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在本实验中也可以使用nbtscan工具。收集域管理员列表，运行如下脚本，将目标域系统列表添加到ips.txt文件中，将收集的域管理员列表添加到admins.txt文件中，和nbtscan工具置于同一目录下。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">for /F %i in (ips. txt) do @ echo [+] Checking %i &amp;&amp; nbtscan -f %i 2&gt;NUL &gt;nbsessions.txt &amp;&amp; FOR /F %n in (admins. txt) DO @type nbsessions.txt | findstr /I %n &gt; NUL &amp;&amp; echo [!] %n was found logged into %i</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_2-12-域管理员模拟方法简介" tabindex="-1"><a class="header-anchor" href="#_2-12-域管理员模拟方法简介"><span>2.12 域管理员模拟方法简介</span></a></h2><p>在渗透测试中，如果已经拥有一个meterpreter会话，就可以使用Incognito来模拟域管理员或者添加一个域管理员，通过尝试遍历系统中所有可用的授权令牌来添加新的管理员。具体操作方法将在第4章详细讲解。</p><h2 id="_2-13-利用powershell收集信息" tabindex="-1"><a class="header-anchor" href="#_2-13-利用powershell收集信息"><span>2.13 利用PowerShell收集信息</span></a></h2><p><strong>PowerShell 的四种执行权限</strong></p><p><strong>查看当前执行权限</strong>：<code>Get-ExecutionPolicy</code></p><p><strong>更改执行权限</strong>：<code>Set-ExecutionPolicy [arguments]</code></p><p>参数说明：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Restricted： 默认设置，不允许执行任何脚本。</span>
<span class="line">Allsigned： 只能运行经过证书验证的脚本。</span>
<span class="line">Unrestricted： 权限最高，可以执行任意脚本。</span>
<span class="line">RemoteSigned： 对本地脚本不进行限制；对来自网络的脚本必须验证其签名。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>PowerView.ps1</strong></p><p>https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1</p><p>PowerView是一款依赖PowerShell 和WMI对内网进行查询的常用渗透测试脚本，它集成在PowerSploit 工具包中。</p><p>将PowerView导入PowerShell：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Import-Module .\powerview.ps1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>常用命令：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Get-NetDomain：获取当前用户所在域的名称。</span>
<span class="line">Get-NetUser：获取所有用户的详细信息。</span>
<span class="line">Get-NetDomainController：获取所有域控制器的信息。</span>
<span class="line">Get-NetComputer：获取域内所有机器的详细信息。</span>
<span class="line">Get-NetOU：获取域中的OU信息。</span>
<span class="line">Get-NetGroup：获取所有域内组和组成员的信息。</span>
<span class="line">Get-NetFileServer：根据SPN获取当前域使用的文件服务器信息。</span>
<span class="line">Get-NetShare：获取当前域内所有的网络共享信息。</span>
<span class="line">Get-NetSession：获取指定服务器的会话。</span>
<span class="line">Get-NetRDPSession：获取指定服务器的远程连接。</span>
<span class="line">Get-NetProcess：获取远程主机的进程。</span>
<span class="line">Get-UserEvent：获取指定用户的日志。</span>
<span class="line">Get-ADObject：获取活动目录的对象。</span>
<span class="line">Get-NetGPO：获取域内所有的组策略对象。</span>
<span class="line">Get-DomainPolicy：获取域默认策略或域控制器策略。</span>
<span class="line">Invoke-UserHunter：获取域用户登录的计算机信息及该用户是否有本地管理员权限。</span>
<span class="line">Invoke-ProcessHunter：通过查询域内所有的机器进程找到特定用户。</span>
<span class="line">Invoke-UserEventHunter：根据用户日志查询某域用户登录过哪些域机器。</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-14-域分析工具-bloodhound" tabindex="-1"><a class="header-anchor" href="#_2-14-域分析工具-bloodhound"><span>2.14 域分析工具 BloodHound</span></a></h2><p>BloodHound通过图与线的形式，将域内用户、计算机、组、会话、ACL，以及域内所有的相关用户、组、计算机、登录信息、访问控制策略之间的关系，直观地展现在Red Team成员面前，为他们更便捷地分析域内情况、更快速地在域内提升权限提供条件。</p><p>BloodHound可以帮助Blue Team成员更好地对己方网络系统进行安全检查，以及保证域的安全性。</p><p>BloodHound使用图形理论，在活动目录环境中自动理清大部分人员之间的关系和细节。</p><p>使用BloodHound，可以快速、深入地了解活动目录中用户之间的关系，获取哪些用户具有管理员权限、哪些用户对所有的计算机都具有管理员权限、哪些用户是有效的用户组成员等信息</p><p>详情：PDF 89-100</p></div></div><footer class="page-meta"><div class="meta-item edit-link"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M2 26h28v2H2z" fill="currentColor"></path><path d="M25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10l3.6 3.6l-10 10H6z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Edit this page<!--]--></span></span></div><div class="meta-item last-updated"><span class="xicon-container left meta-item-label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 32 32" class="xicon-icon" style="width:20px;height:20px;font-size:20px;color:;"><path d="M26 4h-4V2h-2v2h-8V2h-2v2H6c-1.1 0-2 .9-2 2v20c0 1.1.9 2 2 2h20c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 22H6V12h20v14zm0-16H6V6h4v2h2V6h8v2h2V6h4v4z" fill="currentColor"></path></svg><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Last Updated 2025/12/28 21:31:13<!--]--></span></span></div></footer><!----><!----></div><div class="page-catalog-container"><h5 class="tip">ON THIS PAGE</h5><ul><!--[--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#收集本机信息" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="收集本机信息"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->收集本机信息<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#手动收集信息" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="手动收集信息"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->手动收集信息<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#自动收集信息" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="自动收集信息"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->自动收集信息<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#empire下的主机信息收集-待补充" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="Empire下的主机信息收集 （待补充）"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->Empire下的主机信息收集 （待补充）<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#查询当前权限" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="查询当前权限"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->查询当前权限<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#判断是否存在域" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="判断是否存在域"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->判断是否存在域<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#探测域内主机" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="探测域内主机"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->探测域内主机<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-5-1-利用netbios快速探测内网" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.5.1 利用NetBIOS快速探测内网"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.5.1 利用NetBIOS快速探测内网<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-5-2-利用icmp协议快速探测内网" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.5.2 利用ICMP协议快速探测内网"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.5.2 利用ICMP协议快速探测内网<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-5-3-通过arp扫描探测内网" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.5.3 通过ARP扫描探测内网"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.5.3 通过ARP扫描探测内网<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-5-4-通过常规tcp-udp端口扫描探测内网" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.5.4 通过常规TCP/UDP端口扫描探测内网"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.5.4 通过常规TCP/UDP端口扫描探测内网<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-6-扫描域内端口" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.6 扫描域内端口"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.6 扫描域内端口<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-6-1-telnet扫描" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.6.1 Telnet扫描"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.6.1 Telnet扫描<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-6-2-s扫描器-略" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.6.2 S扫描器 (略)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.6.2 S扫描器 (略)<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-6-3-metasploit端口扫描-略" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.6.3 Metasploit端口扫描 (略)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.6.3 Metasploit端口扫描 (略)<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-6-4-powersploit-的-invoke-portscan-ps1-脚本-略" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.6.4 PowerSploit 的 Invoke-portscan.ps1 脚本 (略)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.6.4 PowerSploit 的 Invoke-portscan.ps1 脚本 (略)<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-6-5-nishang的invoke-portscan模块-略" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.6.5 Nishang的Invoke-PortScan模块 (略)"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.6.5 Nishang的Invoke-PortScan模块 (略)<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-6-6-端口banner信息" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.6.6 端口Banner信息"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.6.6 端口Banner信息<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-7-收集域内信息" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.7 收集域内信息"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.7 收集域内信息<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-8-查找域控制器" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.8 查找域控制器"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.8 查找域控制器<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-9-获取域内用户和管理员信息" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.9 获取域内用户和管理员信息"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.9 获取域内用户和管理员信息<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-9-1-查询所有域用户列表" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.9.1 查询所有域用户列表"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.9.1 查询所有域用户列表<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-9-2-查询域管理员用户组" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.9.2 查询域管理员用户组"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.9.2 查询域管理员用户组<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-10-定位域管理员" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.10 定位域管理员"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.10 定位域管理员<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-10-2-常用域管理员定位工具" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.10.2 常用域管理员定位工具"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.10.2 常用域管理员定位工具<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-11-查找域管理进程" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.11 查找域管理进程"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.11 查找域管理进程<!--]--></span></span><!--[--><!--]--></a></li><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-11-1-获取域管理员列表" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.11.1 获取域管理员列表"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.11.1 获取域管理员列表<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-11-2-查询域控制器的域用户会话" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.11.2 查询域控制器的域用户会话"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.11.2 查询域控制器的域用户会话<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-11-3-查询远程系统中运行的任务" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.11.3 查询远程系统中运行的任务"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.11.3 查询远程系统中运行的任务<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_3"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-11-4-扫描远程系统的netbios信息" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.11.4 扫描远程系统的NetBIOS信息"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.11.4 扫描远程系统的NetBIOS信息<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-12-域管理员模拟方法简介" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.12 域管理员模拟方法简介"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.12 域管理员模拟方法简介<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-13-利用powershell收集信息" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.13 利用PowerShell收集信息"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.13 利用PowerShell收集信息<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--[--><li class="page-catalog-menu-depth_2"><a aria-current="page" href="/blog/blogs/tech/security/net/02_Internal_Network_Information_Collection.html#_2-14-域分析工具-bloodhound" class="router-link-active router-link-exact-active link page-catalog-item page-catalog-item" aria-label="2.14 域分析工具 BloodHound"><!--[--><!--]--><span class="xicon-container left"><!--[--><!----><!--]--><span class="xicon-content" style="color:;font-size:14px;"><!--[-->2.14 域分析工具 BloodHound<!--]--></span></span><!--[--><!--]--></a></li><!--]--><!--]--></ul></div></main><!--]--></div></div><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/blog/assets/app-CUDFWA7u.js" defer></script>
  </body>
</html>
