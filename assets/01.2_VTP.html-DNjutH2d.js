import{_ as i,c as s,b as n,o as a}from"./app-CUDFWA7u.js";const t="/blog/assets/image-20220325150145461-t0xbJwUw.png",l="/blog/assets/image-20220325150453589-BJHmtHJF.png",d="/blog/assets/image-20220325151049770-BHRGTTZ7.png",r={};function c(p,e){return a(),s("div",null,e[0]||(e[0]=[n('<p>VTP</p><p>全称：VLAN Trunking Protocol （VLAN Trunk 协议）</p><p>VTP(VLAN 中继协议)利用第 2 层中继帧，在一组交换机之间进行 VLAN 通信．VTP 从一个中心控制点开始，维护整个交换网上 VLAN 的添加和重命名工作，确保配置的一致性。</p><p>作用：</p><ol><li>VTP 维护整个管理域 VLAN 信息的一致性</li><li>VTP 仅在 Trunk 端口上发送通告</li><li>同步最新的 VLAN 信息</li></ol><p>VTP三种模式</p><ol><li>服务器模式 (Server 缺省)：VTP 服务器控制着它们所在域中 VALN 的生成和修改．所有的 VTP 信息都被通告在本域中的其他交换机，而且，所有这些 VTP 信息都是被其他交换机同步接收的．</li><li>客户机模式 (Client)：VTP 客户机不允许管理员创建、修改或删除 VLAN。它们监听本域中其他交换机的VTP 通告，并相应修改它们的 VTP 配置情况．</li><li>透明模式 (Transparent)：VTP 透明模式中的交换机不参与 VTP．当交换机处于透明模式时，它不通告其VLAN 配置信息．而且，它的 VLAN 数据库更新与收到的通告也不保持同步．但它可以创建和删除本地的VLAN，不过，这些 VLAN 的变更不会传播到其他任何交换机上。</li></ol><p><img src="'+t+'" alt="image-20220325150145461"></p><p>工作过程</p><ul><li>VTP 通告以组播帧发送</li><li>VTP Server 和 Client 同步到最新的配置版本号</li><li>VTP 通告在变化时，或者每 5 分钟发送</li></ul><p><img src="'+l+`" alt="image-20220325150453589"></p><p>配置VTP</p><ul><li>配置 Trunk 接口</li><li>配置 VTP 域名</li><li>指定 VTP 模式，默认是 Server 模式</li><li>配置 VTP 密码</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config)#vtp domain TEST		// 配置域名</span>
<span class="line">Changing VTP domain name from NULL to TEST</span>
<span class="line">Switch(config)#vtp mode server		// 配置运行模式</span>
<span class="line">Device mode already VTP SERVER.</span>
<span class="line">Switch(config)#vtp password cisco	// 配置密码</span>
<span class="line">Setting device VLAN database password to cisco</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>验证VTP配置</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch#show vtp status </span>
<span class="line">VTP Version                     : 2</span>
<span class="line">Configuration Revision          : 0</span>
<span class="line">Maximum VLANs supported locally : 1005</span>
<span class="line">Number of existing VLANs        : 7</span>
<span class="line">VTP Operating Mode              : Server</span>
<span class="line">VTP Domain Name                 : TEST</span>
<span class="line">VTP Pruning Mode                : Disabled</span>
<span class="line">VTP V2 Mode                     : Disabled</span>
<span class="line">VTP Traps Generation            : Disabled</span>
<span class="line">MD5 digest                      : 0x73 0x72 0xD0 0x06 0xA2 0x90 0x1D 0xFA </span>
<span class="line">Configuration last modified by 0.0.0.0 at 3-1-93 00:05:08</span>
<span class="line">Local updater ID is 0.0.0.0 (no valid interface found)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>VTP Pruning</p><ul><li>引入 VTP 修剪功能的出发点是为了限制对于邻居交换机来说没有意义的广播、组播和未知单播流量在中继链路上传输，以节省中继链路的带宽，因为交换机上根本没有在这些 VLAN 中的设备，所以最终这些没有意义的泛洪流量也会在邻居交换机上被丢弃。</li><li>VTP 修剪功能会自动计算哪些链路应该修剪哪些 VLAN 的包，管理员只需要启用该功能即可。</li></ul><p><img src="`+d+`" alt="image-20220325151049770"></p><p>VLAN、TRUNK、EtherChannel和VTP 配置命令</p><ul><li>创建 VLAN：</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config)#vlan vlan-id</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>删除 VLAN：</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config)#no vlan vlan-id</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>配置 VLAN状态： active 表示活跃状态，这是创建 VLAN 后的默认状态；suspend 表示挂起状态。</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-vlan)#state [ active | suspend]</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>配置 VLAN 的 MTU：</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-vlan)#mtu size</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>关闭 VLAN：</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-vlan)#shutdown</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>配置 VLAN 名字：注意：VLAN 1的名字不能更改。</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-vlan)#name name</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>配置交换机端口为访问(access)模式：</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-if)#switchport mode access</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>将端口划分到指定VLAN：</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-if)#switchport access vlan vlan-id</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>默认情况下，交换机所有端口都被划分到VLAN 1，VLAN 1是不能删除的。</li></ul><p>查看VLAN信息</p><ul><li>查看VLAN的信息：</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch#show vlan</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查看VLAN的信息摘要：</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch#show vlan brief</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查看VLAN的汇总信息：</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch#show vlan summary</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ul><li>查看接口做为交换端口的有关信息：</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch#show interfaces interfaces switchport</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Trunk 配置命令</p><p>(1) 配置Trunk链路的封装类型</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-if)#switchport trunk encanpsulation   { negotiate | dot1q  |  isl }	</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(2)把接口模式配置为trunk</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-if)#switch mode trunk	</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(3)配置接口的Trunk动态协商模式</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-if)#switch mode dynamic { desirable | auto }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(4)Trunk链路上关闭自动DTP协商</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-if)#switchport nonegotiate</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(5)配置Trunk链路上可以通过的VLAN流量</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-if)#switchport trunk allowed vlan { add | except | all | remove } vlan-id_list</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(6)指定Trunk链路上的本征VLAN</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-if)#switchport trunk native vlan vlan-id</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(7)查看Trunk信息：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch#show interfaces trunk</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>EtherChannel 配置命令</p><p>(1) 创建以太通道</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config)#interface port-channel number	</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(2)把接口加入到以太网通道中，并指明以太通道模式</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-if)#channel-group number mode on</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(3)配置EtherChannel的负载平衡方式</p><p>​ 负载平衡的方式有：dst-ip、dst-mac、src-dst-ip、src-dst-mac、src-ip、src-mac。</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config)#port-channel load-balance type	</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(4)配置协商EtherChannel的协议类型</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-if)#channel-protocol { pagp | lacp }	</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(5)把接口加入到以太网通道中，并指明以太通道模式</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config-if)#channel-group number mode ｛desirable | auto | active | passive｝</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查看 EtherChannel 信息</p><p>① 查看 Etherchannel 的简要信息</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch#show etherchannel summary		</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>② 查看指定的 EtherChannel 包含的接口</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch#show etherchannel port-channel	</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>③ 查看协商 EtherChannel 的协议</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch#show etherchannel protocol	</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>④查看 Etherchannel 的负载平衡方式</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch#show etherchannel load-balance</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>VTP 配置命令</p><p>(1)配置 VTP 域名：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config)#vtp domain domain_name</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(2)配置交换机为 VTP 模式：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config)#vtp mode { server | client | transparent }	</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(3)配置 VTP 的密码：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config)#vtp password password_string </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(4)启用 VTP 修剪：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config)#vtp pruning</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(5)启用 VTP 版本：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch(config)#vtp version { 1 | 2 }</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>(6)查看 VTP 运行情况</p><p>① 查看 VTP 的密码：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch#show vtp password	</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>② 查看 VTP 的状态：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch#show vtp status</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>③ 查看 VLAN 信息同步情况：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Switch#show vlan brief</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,100)]))}const o=i(r,[["render",c]]),m=JSON.parse('{"path":"/blogs/tech/networking/others/01.2_VTP.html","title":"VIP","lang":"en-US","frontmatter":{"title":"VIP","date":"2022-03-03T00:00:00.000Z","tags":["Networking"],"categories":["tech"]},"headers":[],"git":{"createdTime":1766826955000,"updatedTime":1766890838000,"contributors":[{"name":"PPPerryPan","email":"perrypan0123@outlook.com","commits":2}]},"filePathRelative":"blogs/tech/networking/others/01.2_VTP.md"}');export{o as comp,m as data};
