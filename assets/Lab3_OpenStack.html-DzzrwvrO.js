import{_ as a,c as n,b as e,o as t}from"./app-CUDFWA7u.js";const i="/blog/assets/image-20220504110839194-DTOKa8JG.png",l="/blog/assets/image-20220504214332232-CkaiQ8r9.png",p="/blog/assets/image-20220505151408392-BqIIfz8L.png",r="/blog/assets/image-20220505151421454-9JuoX0qy.png",o="/blog/assets/image-20220505151509711-BvqncXTt.png",c="/blog/assets/image-20220505151519714-BaqNC66-.png",d="/blog/assets/image-20220505151541624-zwL2DRnE.png",u="/blog/assets/image-20220505151621230-30EIyCQU.png",m="/blog/assets/image-20220505151626099-DezziZ34.png",g="/blog/assets/image-20220505151731394-DaKRZmMN.png",v="/blog/assets/image-20220505151708146-DDjp7gJz.png",b="/blog/assets/image-20220505151757055-_f-KNZcv.png",k="/blog/assets/image-20220504112308615-Bq_V6i8j.png",h="/blog/assets/image-20220504112708069-DjaABe-z.png",_="/blog/assets/image-20220504131737423-wyzpS-Wg.png",x={};function f(y,s){return t(),n("div",null,s[0]||(s[0]=[e(`<h1 id="openstack" tabindex="-1"><a class="header-anchor" href="#openstack"><span>OpenStack</span></a></h1><h2 id="前期部署" tabindex="-1"><a class="header-anchor" href="#前期部署"><span>前期部署</span></a></h2><p><strong>最小化安装 CentOS 7</strong></p><p>略</p><p><strong>更改设备名</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">vi</span> /etc/hostname</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>将内容改为 openstack</p><p><strong>防火墙配置</strong></p><p>取消防火墙自启，并停止其服务</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">systemctl disable firewalld </span>
<span class="line">systemctl stop firewalld</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>取消 NetworkManager 开机启动，停止服务</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">systemctl disable NetworkManager </span>
<span class="line">systemctl stop NetworkManager</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>关闭 SeLinux 开机启动</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">vi</span> /etc/sysconfig/selinux</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+i+`" alt="image-20220504110839194"></p><p><strong>重启系统</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">reboot</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="使用-packstack-一键部署-openstack" tabindex="-1"><a class="header-anchor" href="#使用-packstack-一键部署-openstack"><span>使用 packstack 一键部署 OpenStack</span></a></h2><p><strong>更新yum仓库</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">yum -y update</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>安装wget</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">yum -y install wget</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>换源</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token builtin class-name">cd</span> /etc/yum.repos.d</span>
<span class="line">$ <span class="token function">sudo</span> <span class="token function">wget</span> <span class="token parameter variable">-nc</span> http://mirrors.aliyun.com/repo/Centos-7.repo</span>
<span class="line">$ <span class="token function">sudo</span> <span class="token function">mv</span> Centos-7.repo CentOS-Base.repo</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>更新</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">yum update</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>本项目选择安装 queens 版本OpenStack</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">yum install -y centos-release-openstack-queens</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>安装 packstack 软件包</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">yum install -y openstack-packstack</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>部署OpenStack</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">packstack --allinone</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>OpenStack 部署完成之后，Linux 虚拟网桥 br-ex 中的 IP 地址是临时的，需要生成配置文件。</p><p>需要先将 ens33 网卡的配置文件拷贝一份，执行如下命令。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">[</span>root@openstack ~<span class="token punctuation">]</span><span class="token comment"># cd /etc/sysconfig/network-scripts/ </span></span>
<span class="line"><span class="token punctuation">[</span>root@openstack network-scripts<span class="token punctuation">]</span><span class="token comment"># cp ifcfg-ens33 ifcfg-br-ex</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>通过 vi 命令，编辑 ifcfg-br-ex 文件</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token assign-left variable">TYPE</span><span class="token operator">=</span><span class="token string">&quot;Ethernet&quot;</span></span>
<span class="line"><span class="token assign-left variable">PROXY_METHOD</span><span class="token operator">=</span><span class="token string">&quot;none&quot;</span></span>
<span class="line"><span class="token assign-left variable">BROWSER_ONLY</span><span class="token operator">=</span><span class="token string">&quot;no&quot;</span></span>
<span class="line"><span class="token assign-left variable">BOOTPROTO</span><span class="token operator">=</span><span class="token string">&quot;none&quot;</span></span>
<span class="line"><span class="token assign-left variable">DEFROUTE</span><span class="token operator">=</span><span class="token string">&quot;yes&quot;</span></span>
<span class="line"><span class="token assign-left variable">IPV4_FAILURE_FATAL</span><span class="token operator">=</span><span class="token string">&quot;no&quot;</span></span>
<span class="line"><span class="token assign-left variable">IPV6INIT</span><span class="token operator">=</span><span class="token string">&quot;yes&quot;</span></span>
<span class="line"><span class="token assign-left variable">IPV6_AUTOCONF</span><span class="token operator">=</span><span class="token string">&quot;yes&quot;</span></span>
<span class="line"><span class="token assign-left variable">IPV6_DEFROUTE</span><span class="token operator">=</span><span class="token string">&quot;yes&quot;</span></span>
<span class="line"><span class="token assign-left variable">IPV6_FAILURE_FATAL</span><span class="token operator">=</span><span class="token string">&quot;no&quot;</span></span>
<span class="line"><span class="token assign-left variable">IPV6_ADDR_GEN_MODE</span><span class="token operator">=</span><span class="token string">&quot;stable-privacy&quot;</span></span>
<span class="line"><span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">&quot;br-ex&quot;</span></span>
<span class="line"><span class="token assign-left variable">UUID</span><span class="token operator">=</span><span class="token string">&quot;684e7321-ad5b-424b-bfcb-e1daf6801ec9&quot;</span></span>
<span class="line"><span class="token assign-left variable">DEVICE</span><span class="token operator">=</span><span class="token string">&quot;br-ex&quot;</span></span>
<span class="line"><span class="token assign-left variable">ONBOOT</span><span class="token operator">=</span><span class="token string">&quot;yes&quot;</span></span>
<span class="line"><span class="token assign-left variable">IPADDR</span><span class="token operator">=</span><span class="token string">&quot;172.24.4.1&quot;</span></span>
<span class="line"><span class="token assign-left variable">PREFIX</span><span class="token operator">=</span><span class="token string">&quot;24&quot;</span></span>
<span class="line"><span class="token assign-left variable">GATEWAY</span><span class="token operator">=</span><span class="token string">&quot;172.24.4.2&quot;</span></span>
<span class="line"><span class="token assign-left variable">DNS1</span><span class="token operator">=</span><span class="token string">&quot;114.114.114.114&quot;</span></span>
<span class="line"><span class="token assign-left variable">IPV6_PRIVACY</span><span class="token operator">=</span><span class="token string">&quot;no&quot;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>至此，已经完成 OpenStack 的部署。控制台消息的最后部分提示了环境变量文件和日志 文件的位置，以及登录 Dashboard 的方法。根据提示，在浏览器中输入 http://主机 IP 地址/dashboard,可以登录 OpenStack 的 Horizon Web 界面。</p><p>安装 OpenStack 后，在 root 用户的 Home 目录下会生成一个 keystone_admin 文件。该 文件记录有 keystone（OpenStack 认证组件）认证环境变量，包括用户名和登录密码。 注意：不同服务器生成的默认密码是不同的，如下所示。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">[</span>root@openstack ~<span class="token punctuation">]</span><span class="token comment"># cat keystonerc_admin </span></span>
<span class="line"><span class="token builtin class-name">unset</span> OS_SERVICE_TOKEN</span>
<span class="line"> <span class="token builtin class-name">export</span> <span class="token assign-left variable">OS_USERNAME</span><span class="token operator">=</span>admin</span>
<span class="line"> <span class="token builtin class-name">export</span> <span class="token assign-left variable">OS_PASSWORD</span><span class="token operator">=</span><span class="token string">&#39;bc6fd682491a4b2a&#39;</span></span>
<span class="line"> <span class="token builtin class-name">export</span> <span class="token assign-left variable">OS_REGION_NAME</span><span class="token operator">=</span>RegionOne</span>
<span class="line"> <span class="token builtin class-name">export</span> <span class="token assign-left variable">OS_AUTH_URL</span><span class="token operator">=</span>http://192.168.158.200:5000/v3</span>
<span class="line"> <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PS1</span></span><span class="token operator">=</span><span class="token string">&#39;[\\u@\\h \\W(keystone_admin)]\\$ &#39;</span> </span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">OS_PROJECT_NAME</span><span class="token operator">=</span>admin</span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">OS_USER_DOMAIN_NAME</span><span class="token operator">=</span>Default</span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">OS_PROJECT_DOMAIN_NAME</span><span class="token operator">=</span>Default</span>
<span class="line"><span class="token builtin class-name">export</span> <span class="token assign-left variable">OS_IDENTITY_API_VERSION</span><span class="token operator">=</span><span class="token number">3</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>部署成功截图</p><p><img src="`+l+'" alt="image-20220504214332232"></p><h2 id="创建云主机" tabindex="-1"><a class="header-anchor" href="#创建云主机"><span>创建云主机</span></a></h2><p><strong>创建网络</strong></p><p><img src="'+p+'" alt="image-20220505151408392"></p><p><img src="'+r+'" alt="image-20220505151421454"></p><p><img src="'+o+'" alt="image-20220505151509711"></p><p><img src="'+c+'" alt="image-20220505151519714"></p><p><img src="'+d+'" alt="image-20220505151541624"></p><p><strong>创建路由</strong></p><p><img src="'+u+'" alt="image-20220505151621230"></p><p><img src="'+m+'" alt="image-20220505151626099"></p><p><strong>网络拓扑</strong></p><p><img src="'+g+'" alt="image-20220505151731394"></p><p><img src="'+v+'" alt="image-20220505151708146"></p><p><strong>创建实例</strong></p><p><img src="'+b+`" alt="image-20220505151757055"></p><h3 id="附录" tabindex="-1"><a class="header-anchor" href="#附录"><span>附录</span></a></h3><p><strong>部署前序要装wegt，安装wegt时遇到</strong></p><p>Could not retrieve mirrorlist http://mirrorlist.centos.org/?release=7&amp;arch=x86_64&amp;repo=os&amp;infra=stock32 error was 14: curl#6 - &quot;Could not resolve host: mirrorlist.centos.org; Unknown error&quot;</p><p>解决方案：</p><p>修改dns</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-ens33</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+k+`" alt="image-20220504112308615"></p><p>重启网络服务</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">service network restart</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果 <code>ping baidu.com</code> 依旧不通，可手动配置dns</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">vi /etc/resolv.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+h+'" alt="image-20220504112708069"></p><p>yum中没有openstack</p><p><img src="'+_+'" alt="image-20220504131737423"></p>',71)]))}const q=a(x,[["render",f]]),S=JSON.parse('{"path":"/blogs/tech/cloud/Lab3_OpenStack.html","title":"Lan-OpenStack","lang":"en-US","frontmatter":{"title":"Lan-OpenStack","date":"2022-05-04T00:00:00.000Z","tags":["Cloud"],"categories":["tech"]},"headers":[{"level":2,"title":"前期部署","slug":"前期部署","link":"#前期部署","children":[]},{"level":2,"title":"使用 packstack 一键部署 OpenStack","slug":"使用-packstack-一键部署-openstack","link":"#使用-packstack-一键部署-openstack","children":[]},{"level":2,"title":"创建云主机","slug":"创建云主机","link":"#创建云主机","children":[{"level":3,"title":"附录","slug":"附录","link":"#附录","children":[]}]}],"git":{"createdTime":1766826955000,"updatedTime":1766826955000,"contributors":[{"name":"PPPerryPan","email":"perrypan0123@outlook.com","commits":1}]},"filePathRelative":"blogs/tech/cloud/Lab3_OpenStack.md"}');export{q as comp,S as data};
