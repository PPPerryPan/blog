import{_ as p,c as t,b as l,a as n,d as o,e as i,r as c,o as r}from"./app-CUDFWA7u.js";const u="/blog/assets/image-20220926173448754-yvsWsYfR.png",k="/blog/assets/image-20220926173556908-Dm0zEbiR.png",d="/blog/assets/image-20220926173743786-DkRaa6gO.png",a="/blog/assets/image-20220926193317719-CXPhpFwt.png",g="/blog/assets/image-20220926193434763-CGfr-a-E.png",m="/blog/assets/image-20220926193519822-CeGHLuwX.png",v="/blog/assets/image-20220926200843629-CK8pjEGq.png",b="/blog/assets/image-20220926200104579-CCuPaxN_.png",h="/blog/assets/image-20220926200258621-U54GlWJv.png",_="/blog/assets/image-20220926201557097-C1Lc6v2y.png",f="/blog/assets/image-20220926201749836-BqSyKe4L.png",q="/blog/assets/image-20220926202043338-AvooS8RD.png",y="/blog/assets/image-20220926202257882-CaCTXaL9.png",$="/blog/assets/image-20220926202341590-Bt2ZL3MU.png",w="/blog/assets/image-20220926202936592-BbH4DBSK.png",x="/blog/assets/image-20220926203059837-SPr3RjZV.png",P="/blog/assets/image-20220926203133352-daeJTbGW.png",S="/blog/assets/image-20220926203423700-BwsldJq0.png",B="/blog/assets/image-20220926203645110-BaTU05L8.png",C="/blog/assets/image-20220926203845349-B_wA7Y7Q.png",L="/blog/assets/image-20220926203950742-B730YQXU.png",T={},O={href:"https://portswigger.net/burp/documentation/desktop/tools/intruder/attack-types",target:"_blank",rel:"noopener noreferrer"};function E(N,s){const e=c("ExternalLinkIcon");return r(),t("div",null,[s[1]||(s[1]=l('<h2 id="基于表单的暴力破解" tabindex="-1"><a class="header-anchor" href="#基于表单的暴力破解"><span>基于表单的暴力破解</span></a></h2><h3 id="分析" tabindex="-1"><a class="header-anchor" href="#分析"><span>分析</span></a></h3><p>随便输点东西抓包看看</p><p><img src="'+u+'" alt="image-20220926173448754"></p><p>没什么特殊的防护，直接爆破即可</p><h3 id="利用" tabindex="-1"><a class="header-anchor" href="#利用"><span>利用</span></a></h3><p>发送到 Intruder</p><p><img src="'+k+'" alt="image-20220926173556908"></p><p>设置两个变量，并适用组合爆破</p><p><img src="'+d+'" alt="image-20220926173743786"></p><p>设置好 Payload 和字典，开始攻击。</p><p><img src="'+a+'" alt="image-20220926193317719"></p><p>发现两条返回 Length 不一致的 条目，即为账号密码</p><p><img src="'+g+'" alt="image-20220926193434763"></p><p>成功登录，查看提示，也确实是有这两个用户存在。</p><p><img src="'+m+`" alt="image-20220926193519822"></p><h2 id="验证码绕过-on-server" tabindex="-1"><a class="header-anchor" href="#验证码绕过-on-server"><span>验证码绕过(on server)</span></a></h2><p>在以上基础上新增了验证码</p><h3 id="源代码" tabindex="-1"><a class="header-anchor" href="#源代码"><span>源代码</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;vcode&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token variable">$html</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;p class=&#39;notice&#39;&gt;验证码不能为空哦！&lt;/p&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token comment">//              验证验证码是否正确</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;vcode&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;vcode&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token variable">$html</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;&lt;p class=&#39;notice&#39;&gt;验证码输入错误哦！&lt;/p&gt;&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token comment">//应该在验证完成后,销毁该$_SESSION[&#39;vcode&#39;]</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line"></span>
<span class="line">        <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;username&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;password&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$vcode</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;vcode&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;select * from users where username=? and password=md5(?)&quot;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token variable">$line_pre</span> <span class="token operator">=</span> <span class="token variable">$link</span><span class="token operator">-&gt;</span><span class="token function">prepare</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token variable">$line_pre</span><span class="token operator">-&gt;</span><span class="token function">bind_param</span><span class="token punctuation">(</span><span class="token string single-quoted-string">&#39;ss&#39;</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$line_pre</span><span class="token operator">-&gt;</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token variable">$line_pre</span><span class="token operator">-&gt;</span><span class="token function">store_result</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token comment">//虽然前面做了为空判断,但最后,却没有验证验证码!!!</span></span>
<span class="line">            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$line_pre</span><span class="token operator">-&gt;</span><span class="token function">num_rows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token variable">$html</span><span class="token operator">.=</span><span class="token string single-quoted-string">&#39;&lt;p&gt; login success&lt;/p&gt;&#39;</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">                <span class="token variable">$html</span><span class="token operator">.=</span> <span class="token string single-quoted-string">&#39;&lt;p&gt; username or password is not exists～&lt;/p&gt;&#39;</span><span class="token punctuation">;</span></span>
<span class="line">            <span class="token punctuation">}</span></span>
<span class="line">        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span></span>
<span class="line">            <span class="token variable">$html</span><span class="token operator">.=</span> <span class="token string single-quoted-string">&#39;&lt;p&gt;执行错误:&#39;</span><span class="token operator">.</span><span class="token variable">$line_pre</span><span class="token operator">-&gt;</span><span class="token property">errno</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;错误信息:&#39;</span><span class="token operator">.</span><span class="token variable">$line_pre</span><span class="token operator">-&gt;</span><span class="token property">error</span><span class="token operator">.</span><span class="token string single-quoted-string">&#39;&lt;/p&gt;&#39;</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="分析-1" tabindex="-1"><a class="header-anchor" href="#分析-1"><span>分析</span></a></h3><p>看 Line 7 的提示和上下文，发现验证码在判断完之后不会立刻销毁，看起来是要网页刷新后才会刷新验证码。</p><p>另外，比较有意思的一点是，验证码放在浏览器 Cookie 里存着</p><p><img src="`+v+'" alt="image-20220926200843629"></p><h3 id="利用-1" tabindex="-1"><a class="header-anchor" href="#利用-1"><span>利用</span></a></h3><p>使用 BP 的重放攻击，页面不会刷新，一直用同一个验证码即可。</p><p>随便输入点东西，提交。</p><p>页面刷新后，将刚才的包 Send to Intruder；</p><p>Cluster bomb 攻击模式，两个变量，验证码改成页面当前显示的验证码。</p><p><img src="'+b+'" alt="image-20220926200104579"></p><p>Payload设置跟上面一样，开始攻击。</p><p><img src="'+a+'" alt="image-20220926193317719"></p><p>搞定</p><p><img src="'+h+'" alt="image-20220926200258621"></p><h2 id="验证码绕过-on-client" tabindex="-1"><a class="header-anchor" href="#验证码绕过-on-client"><span>验证码绕过(on client)</span></a></h2><h3 id="分析-2" tabindex="-1"><a class="header-anchor" href="#分析-2"><span>分析</span></a></h3><p>随便输点东西，Login，发现他直接没网络请求，直接提示验证码错误</p><p><img src="'+_+'" alt="image-20220926201557097"></p><p>那就把验证码输对提交试试，有包了</p><p><img src="'+f+'" alt="image-20220926201749836"></p><p>稍加思考，就可以想到大致登录步骤：本地验证验证码是否正确，正确才会把用户名和密码发到后端验证。</p><p>那有没有一种可能，后端不会验证验证码，所以直接发包验证码乱填，就能爆破出来？</p><h3 id="利用-2" tabindex="-1"><a class="header-anchor" href="#利用-2"><span>利用</span></a></h3><p>把刚才的包发到 Intruder，一样的攻击类型，一样的变量，一样的字典</p><blockquote><p>与前面不同的是，验证码是在前端判断的，理论上后端应该也是不会再次验证的，所以他在这里发到后端毫无意义。</p></blockquote><p><img src="'+q+'" alt="image-20220926202043338"></p><p>当然，Payload 设置都一样。</p><p><img src="'+y+'" alt="image-20220926202257882"></p><p>开始攻击，搞定。</p><p><img src="'+$+'" alt="image-20220926202341590"></p><h2 id="token防爆破" tabindex="-1"><a class="header-anchor" href="#token防爆破"><span>token防爆破?</span></a></h2><h3 id="分析-3" tabindex="-1"><a class="header-anchor" href="#分析-3"><span>分析</span></a></h3><p>粗略看了一下，感觉和 DVWA 的一个道理，每次提交 token 都会发生改变</p><h3 id="利用-3" tabindex="-1"><a class="header-anchor" href="#利用-3"><span>利用</span></a></h3><p>攻击类型 Pitchfork ，两个变量</p><blockquote><p>当然，可以把 username 也加上。</p></blockquote><p><img src="'+w+'" alt="image-20220926202936592"></p><p>变量1配置：</p><p><img src="'+x+'" alt="image-20220926203059837"></p><p>变量2配置递归查询：</p><p><img src="'+P+'" alt="image-20220926203133352"></p><p><img src="'+S+'" alt="image-20220926203423700"></p><p>设置最高线程为 1</p><p><img src="'+B+'" alt="image-20220926203645110"></p><p>开始攻击，找返回 Length 不同的条目，其中一个就是密码</p><blockquote><p>如果上面设置变量还有 username 的话 就多一个 Payload。</p><p>这里为了节省时间就不加了</p></blockquote><p><img src="'+C+'" alt="image-20220926203845349"></p><p><img src="'+L+'" alt="image-20220926203950742"></p><h2 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料"><span>参考资料</span></a></h2>',69)),n("p",null,[n("a",O,[s[0]||(s[0]=o("Attack types - PortSwigger")),i(e)])])])}const R=p(T,[["render",E]]),V=JSON.parse('{"path":"/blogs/tech/security/web/Pikachu/01_Brute_Force.html","title":"PiKachu - 基于表单的暴力破解","lang":"en-US","frontmatter":{"title":"PiKachu - 基于表单的暴力破解","date":"2022-09-26T00:00:00.000Z","tags":["Web","security"],"categories":["tech"]},"headers":[{"level":2,"title":"基于表单的暴力破解","slug":"基于表单的暴力破解","link":"#基于表单的暴力破解","children":[{"level":3,"title":"分析","slug":"分析","link":"#分析","children":[]},{"level":3,"title":"利用","slug":"利用","link":"#利用","children":[]}]},{"level":2,"title":"验证码绕过(on server)","slug":"验证码绕过-on-server","link":"#验证码绕过-on-server","children":[{"level":3,"title":"源代码","slug":"源代码","link":"#源代码","children":[]},{"level":3,"title":"分析","slug":"分析-1","link":"#分析-1","children":[]},{"level":3,"title":"利用","slug":"利用-1","link":"#利用-1","children":[]}]},{"level":2,"title":"验证码绕过(on client)","slug":"验证码绕过-on-client","link":"#验证码绕过-on-client","children":[{"level":3,"title":"分析","slug":"分析-2","link":"#分析-2","children":[]},{"level":3,"title":"利用","slug":"利用-2","link":"#利用-2","children":[]}]},{"level":2,"title":"token防爆破?","slug":"token防爆破","link":"#token防爆破","children":[{"level":3,"title":"分析","slug":"分析-3","link":"#分析-3","children":[]},{"level":3,"title":"利用","slug":"利用-3","link":"#利用-3","children":[]}]},{"level":2,"title":"参考资料","slug":"参考资料","link":"#参考资料","children":[]}],"git":{"createdTime":1766928673000,"updatedTime":1766928673000,"contributors":[{"name":"PPPerryPan","email":"perrypan0123@outlook.com","commits":1}]},"filePathRelative":"blogs/tech/security/web/Pikachu/01_Brute_Force.md"}');export{R as comp,V as data};
