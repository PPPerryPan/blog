import{_ as p,c as l,b as a,a as e,d as n,e as i,r as c,o}from"./app-CUDFWA7u.js";const u="/blog/assets/image-20220828221920057-CxJ0R_dG.png",r="/blog/assets/image-20220828221942381-BjVPPRvW.png",d="/blog/assets/image-20220828222008135-BHg0Dwug.png",v="/blog/assets/image-20220828223543277-4V6ajPMG.png",m="/blog/assets/image-20220828223626428-ZrF3oiGm.png",k="/blog/assets/image-20220828224345108-D3IpqL_c.png",b="/blog/assets/image-20220828224026964-ao7XzpOb.png",g="/blog/assets/image-20220828224046299-DTrlu8y5.png",h="/blog/assets/image-20220828224217665-BQJ5sYej.png",q="/blog/assets/image-20220828225356899-CYUjThvI.png",y="/blog/assets/image-20220828231244497-YGTrj-jF.png",f={},S={href:"https://pastebin.com",target:"_blank",rel:"noopener noreferrer"};function w(_,s){const t=c("ExternalLinkIcon");return o(),l("div",null,[s[3]||(s[3]=a(`<h1 id="dvwa-csp-bypass" tabindex="-1"><a class="header-anchor" href="#dvwa-csp-bypass"><span>DVWA: CSP Bypass</span></a></h1><h2 id="low" tabindex="-1"><a class="header-anchor" href="#low"><span>Low</span></a></h2><h3 id="源代码" tabindex="-1"><a class="header-anchor" href="#源代码"><span>源代码</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span class="token variable">$headerCSP</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;Content-Security-Policy: script-src &#39;self&#39; https://pastebin.com hastebin.com www.toptal.com example.com code.jquery.com https://ssl.google-analytics.com ;&quot;</span><span class="token punctuation">;</span> <span class="token comment">// allows js from self, pastebin.com, hastebin.com, jquery and google analytics.</span></span>
<span class="line"></span>
<span class="line"><span class="token function">header</span><span class="token punctuation">(</span><span class="token variable">$headerCSP</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># These might work if you can&#39;t create your own for some reason</span></span>
<span class="line"><span class="token comment"># https://pastebin.com/raw/R570EE00</span></span>
<span class="line"><span class="token comment"># https://www.toptal.com/developers/hastebin/raw/cezaruzeka</span></span>
<span class="line"></span>
<span class="line"><span class="token delimiter important">?&gt;</span></span></span>
<span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;include&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token variable">$page</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">&#39;body&#39;</span> <span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;</span>
<span class="line">    &lt;script src=&#39;&quot;</span> <span class="token operator">.</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;include&#39;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;&#39;&gt;&lt;/script&gt;</span>
<span class="line">&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token variable">$page</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">&#39;body&#39;</span> <span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">&#39;</span>
<span class="line">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span>
<span class="line">    &lt;p&gt;You can include scripts from external sources, examine the Content Security Policy and enter a URL to include here:&lt;/p&gt;</span>
<span class="line">    &lt;input size=&quot;50&quot; type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot; id=&quot;include&quot; /&gt;</span>
<span class="line">    &lt;input type=&quot;submit&quot; value=&quot;Include&quot; /&gt;</span>
<span class="line">&lt;/form&gt;</span>
<span class="line">&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="代码分析" tabindex="-1"><a class="header-anchor" href="#代码分析"><span>代码分析</span></a></h3><p>对 HTTP 头定义了 CSP 标签，从而定义了可以接受外部 JavaScript 资源的白名单</p><blockquote><p>https://pastebin.com</p><p>hastebin.com</p><p>www.toptal.com</p><p>example.com</p><p>code.jquery.com</p><p>https://ssl.google-analytics.com</p></blockquote><h3 id="漏洞利用" tabindex="-1"><a class="header-anchor" href="#漏洞利用"><span>漏洞利用</span></a></h3>`,8)),e("p",null,[s[1]||(s[1]=n("打开 ")),e("a",S,[s[0]||(s[0]=n("Pastebin")),i(t)]),s[2]||(s[2]=n(" 看看，发现是个分享文本内容的网站；"))]),s[4]||(s[4]=a('<p>尝试在文本内容中嵌入一段 JS 代码</p><p><img src="'+u+'" alt="image-20220828221920057"></p><p><img src="'+r+'" alt="image-20220828221942381"></p><p><img src="'+d+'" alt="image-20220828222008135"></p><p>返回DVWA 粘贴并包含，即可弹窗</p><p><img src="'+v+'" alt="image-20220828223543277"></p><p>注：可见其返回200，但是他不弹窗啊！！</p><p><img src="'+m+'" alt="image-20220828223626428"></p><p>看了下机场的航班发送日志，他上了飞往 HK 的航班，但一样不弹。<s>（不会吧不会吧 有人连某些地方说的网络环境问题都信）</s></p><p>然后去看了眼 Console，</p><p>有意思 JS 被拒绝了！</p><p><img src="'+k+'" alt="image-20220828224345108"></p><p>那直接换个网站吧。。</p><p>来白名单里的另一个 <a href="hastebin.com">网站</a> 创一个，然后保存，切换到仅文本</p><blockquote><p>PS：各位检票员请记得让他上飞机。</p></blockquote><p><img src="'+b+'" alt="image-20220828224026964"></p><p>拿链接：https://hastebin.com/raw/uxuritazur</p><p><img src="'+g+'" alt="image-20220828224046299"></p><p>粘贴到 DVWA 并 include，搞定</p><blockquote><p>PS：各位检票员请记得让他上飞机。</p></blockquote><p><img src="'+h+`" alt="image-20220828224217665"></p><h2 id="medium" tabindex="-1"><a class="header-anchor" href="#medium"><span>Medium</span></a></h2><h3 id="源代码-1" tabindex="-1"><a class="header-anchor" href="#源代码-1"><span>源代码</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span class="token variable">$headerCSP</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;Content-Security-Policy: script-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;nonce-TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=&#39;;&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">header</span><span class="token punctuation">(</span><span class="token variable">$headerCSP</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// Disable XSS protections so that inline alert boxes will work</span></span>
<span class="line"><span class="token function">header</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;X-XSS-Protection: 0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="alert-1" tabindex="-1"><a class="header-anchor" href="#alert-1"><span></span></a></h1><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"></span>
<span class="line">?&gt;</span>
<span class="line">&lt;?php</span>
<span class="line">if (isset ($_POST[&#39;include&#39;])) {</span>
<span class="line">$page[ &#39;body&#39; ] .= &quot;</span>
<span class="line">    &quot; . $_POST[&#39;include&#39;] . &quot;</span>
<span class="line">&quot;;</span>
<span class="line">}</span>
<span class="line">$page[ &#39;body&#39; ] .= &#39;</span>
<span class="line">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span>
<span class="line">    &lt;p&gt;Whatever you enter here gets dropped directly into the page, see if you can get an alert box to pop up.&lt;/p&gt;</span>
<span class="line">    &lt;input size=&quot;50&quot; type=&quot;text&quot; name=&quot;include&quot; value=&quot;&quot; id=&quot;include&quot; /&gt;</span>
<span class="line">    &lt;input type=&quot;submit&quot; value=&quot;Include&quot; /&gt;</span>
<span class="line">&lt;/form&gt;</span>
<span class="line">&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="代码分析-1" tabindex="-1"><a class="header-anchor" href="#代码分析-1"><span>代码分析</span></a></h3><p>源码中nonce参数无任何过滤，注入时直接令 nonce 为设定好的值即可。</p><h3 id="漏洞利用-1" tabindex="-1"><a class="header-anchor" href="#漏洞利用-1"><span>漏洞利用</span></a></h3><p>源码里注释居然就有一个，试一下，成功：</p><p><img src="`+q+`" alt="image-20220828225356899"></p><p>试一下改改内容，成功</p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html" data-title="html"><pre><code><span class="line"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">nonce</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>TmV2ZXIgZ29pbmcgdG8gZ2l2ZSB5b3UgdXA=<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#39;TEST&#39;</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line"></span>
<span class="line">![image-20220828225525593](Lab10_CSP_Bypass.assets/image-20220828225525593.png)</span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line">## High</span>
<span class="line"></span>
<span class="line">### 源代码</span>
<span class="line"></span>
<span class="line">\`\`\`php</span>
<span class="line">&lt;?php</span>
<span class="line">$headerCSP = &quot;Content-Security-Policy: script-src &#39;self&#39;;&quot;;</span>
<span class="line"></span>
<span class="line">header($headerCSP);</span>
<span class="line"></span>
<span class="line">?&gt;</span>
<span class="line">&lt;?php</span>
<span class="line">if (isset ($_POST[&#39;include&#39;])) {</span>
<span class="line">$page[ &#39;body&#39; ] .= &quot;</span>
<span class="line">    &quot; . $_POST[&#39;include&#39;] . &quot;</span>
<span class="line">&quot;;</span>
<span class="line">}</span>
<span class="line">$page[ &#39;body&#39; ] .= &#39;</span>
<span class="line">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span>
<span class="line">    &lt;p&gt;The page makes a call to &#39; . DVWA_WEB_PAGE_TO_ROOT . &#39;/vulnerabilities/csp/source/jsonp.php to load some code. Modify that page to run your own code.&lt;/p&gt;</span>
<span class="line">    &lt;p&gt;1+2+3+4+5=&lt;span id=&quot;answer&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span>
<span class="line">    &lt;input type=&quot;button&quot; id=&quot;solve&quot; value=&quot;Solve the sum&quot; /&gt;</span>
<span class="line">&lt;/form&gt;</span>
<span class="line"></span>
<span class="line">&lt;script src=&quot;source/high.js&quot;&gt;&lt;/script&gt;</span>
<span class="line">&#39;;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line"><span class="token comment">// high.js</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">clickButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> s <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    s<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;source/jsonp.php?callback=solveSum&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">solveSum</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;answer&quot;</span> <span class="token keyword">in</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;answer&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token string">&#39;answer&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> solve_button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span> <span class="token punctuation">(</span><span class="token string">&quot;solve&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>solve_button<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">	solve_button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">		<span class="token function">clickButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="代码分析-2" tabindex="-1"><a class="header-anchor" href="#代码分析-2"><span>代码分析</span></a></h3><p>这个级别没有输入框了。</p><p>先看一下 CSP 头, 发现只有 <code>script-src &#39;self&#39;;</code>，只允许本界面加载的 javascript 执行。</p><p>然后研究了一下这个点击显示答案的逻辑 (逻辑在 <code>source/high.js</code>里），</p><p>大致如下:</p><ol><li>点击按钮</li><li>js 生成一个 script 标签 (src 指向 source/jsonp.php?callback=solveNum) , 并把它加入到 DOM 中</li><li>js 中定义了一个 solveNum 的函数</li><li>script 标签会把远程加载的 <code>solveSum({&quot;answer&quot;:&quot;15&quot;})</code> 当作 js 代码执行</li></ol><h3 id="漏洞利用-2" tabindex="-1"><a class="header-anchor" href="#漏洞利用-2"><span>漏洞利用</span></a></h3><p>看着好像 除了改JS没什么头绪，那看看jsonp.php那？好像没有任何过滤，试试用 HackBar include 一下，成了</p><div class="language-html line-numbers-mode" data-highlighter="prismjs" data-ext="html" data-title="html"><pre><code><span class="line">include=<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>source/jsonp.php?callback=alert(&#39;TEST&#39;);<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+y+`" alt="image-20220828231244497"></p><h2 id="impossible" tabindex="-1"><a class="header-anchor" href="#impossible"><span>Impossible</span></a></h2><h3 id="源代码-2" tabindex="-1"><a class="header-anchor" href="#源代码-2"><span>源代码</span></a></h3><div class="language-php line-numbers-mode" data-highlighter="prismjs" data-ext="php" data-title="php"><pre><code><span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"></span>
<span class="line"><span class="token variable">$headerCSP</span> <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;Content-Security-Policy: script-src &#39;self&#39;;&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token function">header</span><span class="token punctuation">(</span><span class="token variable">$headerCSP</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token delimiter important">?&gt;</span></span></span>
<span class="line"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;include&#39;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token variable">$page</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">&#39;body&#39;</span> <span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token string double-quoted-string">&quot;</span>
<span class="line">    &quot;</span> <span class="token operator">.</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;include&#39;</span><span class="token punctuation">]</span> <span class="token operator">.</span> <span class="token string double-quoted-string">&quot;</span>
<span class="line">&quot;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"><span class="token variable">$page</span><span class="token punctuation">[</span> <span class="token string single-quoted-string">&#39;body&#39;</span> <span class="token punctuation">]</span> <span class="token operator">.=</span> <span class="token string single-quoted-string">&#39;</span>
<span class="line">&lt;form name=&quot;csp&quot; method=&quot;POST&quot;&gt;</span>
<span class="line">    &lt;p&gt;Unlike the high level, this does a JSONP call but does not use a callback, instead it hardcodes the function to call.&lt;/p&gt;&lt;p&gt;The CSP settings only allow external JavaScript on the local server and no inline code.&lt;/p&gt;</span>
<span class="line">    &lt;p&gt;1+2+3+4+5=&lt;span id=&quot;answer&quot;&gt;&lt;/span&gt;&lt;/p&gt;</span>
<span class="line">    &lt;input type=&quot;button&quot; id=&quot;solve&quot; value=&quot;Solve the sum&quot; /&gt;</span>
<span class="line">&lt;/form&gt;</span>
<span class="line"></span>
<span class="line">&lt;script src=&quot;source/impossible.js&quot;&gt;&lt;/script&gt;</span>
<span class="line">&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">vulnerabilities<span class="token operator">/</span>csp<span class="token operator">/</span>source<span class="token operator">/</span>impossible<span class="token operator">.</span>js</span>
<span class="line"><span class="token keyword">function</span> <span class="token function-definition function">clickButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">var</span> s <span class="token operator">=</span> document<span class="token operator">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;script&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    s<span class="token operator">.</span>src <span class="token operator">=</span> <span class="token string double-quoted-string">&quot;source/jsonp_impossible.php&quot;</span><span class="token punctuation">;</span></span>
<span class="line">    document<span class="token operator">.</span>body<span class="token operator">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">function</span> <span class="token function-definition function">solveSum</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;answer&quot;</span> in obj<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        document<span class="token operator">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;answer&quot;</span><span class="token punctuation">)</span><span class="token operator">.</span>innerHTML <span class="token operator">=</span> obj<span class="token punctuation">[</span><span class="token string single-quoted-string">&#39;answer&#39;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">var</span> solve_button <span class="token operator">=</span> document<span class="token operator">.</span><span class="token function">getElementById</span> <span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;solve&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> <span class="token punctuation">(</span>solve_button<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    solve_button<span class="token operator">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string double-quoted-string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">        <span class="token function">clickButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="代码分析-3" tabindex="-1"><a class="header-anchor" href="#代码分析-3"><span>代码分析</span></a></h3><p>修复了 callback 参数可被控制问题，从根源杜绝了Bug。</p><p>对比：</p><blockquote><p>high level：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">s<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;source/jsonp.php?callback=solveSum&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>impossible level：</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js" data-title="js"><pre><code><span class="line">s<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">&quot;source/jsonp_impossible.php&quot;</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></blockquote>`,52))])}const P=p(f,[["render",w]]),x=JSON.parse('{"path":"/blogs/tech/security/web/DVWA/Lab10_CSP Bypass.html","title":"DVWA - CSP Bypass","lang":"en-US","frontmatter":{"title":"DVWA - CSP Bypass","date":"2022-08-28T00:00:00.000Z","tags":["Web","security"],"categories":["tech"]},"headers":[{"level":2,"title":"Low","slug":"low","link":"#low","children":[{"level":3,"title":"源代码","slug":"源代码","link":"#源代码","children":[]},{"level":3,"title":"代码分析","slug":"代码分析","link":"#代码分析","children":[]},{"level":3,"title":"漏洞利用","slug":"漏洞利用","link":"#漏洞利用","children":[]}]},{"level":2,"title":"Medium","slug":"medium","link":"#medium","children":[{"level":3,"title":"源代码","slug":"源代码-1","link":"#源代码-1","children":[]},{"level":3,"title":"代码分析","slug":"代码分析-1","link":"#代码分析-1","children":[]},{"level":3,"title":"漏洞利用","slug":"漏洞利用-1","link":"#漏洞利用-1","children":[]},{"level":3,"title":"代码分析","slug":"代码分析-2","link":"#代码分析-2","children":[]},{"level":3,"title":"漏洞利用","slug":"漏洞利用-2","link":"#漏洞利用-2","children":[]}]},{"level":2,"title":"Impossible","slug":"impossible","link":"#impossible","children":[{"level":3,"title":"源代码","slug":"源代码-2","link":"#源代码-2","children":[]},{"level":3,"title":"代码分析","slug":"代码分析-3","link":"#代码分析-3","children":[]}]}],"git":{"createdTime":1766928673000,"updatedTime":1766928673000,"contributors":[{"name":"PPPerryPan","email":"perrypan0123@outlook.com","commits":1}]},"filePathRelative":"blogs/tech/security/web/DVWA/Lab10_CSP Bypass.md"}');export{P as comp,x as data};
