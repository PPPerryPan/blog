import{_ as a,c as n,b as e,o as i}from"./app-CUDFWA7u.js";const l={};function t(p,s){return i(),n("div",null,s[0]||(s[0]=[e(`<h2 id="挂载-smb-目录" tabindex="-1"><a class="header-anchor" href="#挂载-smb-目录"><span>挂载 SMB 目录</span></a></h2><p>要在Ubntu 20.04中挂载一个SMB（Server Message Block）共享目录，你需要使用<code>mount</code>命令，并且通常需要安装<code>smbclient</code>和<code>cifs-utils</code>包来支持SMB协议。以下是操作步骤：</p><ol><li><p><strong>安装必要的包</strong>： 打开终端并输入以下命令来安装<code>smbclient</code>和<code>cifs-utils</code>：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> update</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> smbclient cifs-utils</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>创建本地挂载点</strong>： 创建一个目录，用作远程SMB共享的挂载点。例如：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">mkdir</span> /mnt/smbshare</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>你可以将<code>/mnt/smbshare</code>替换为你想要的任何目录路径。</p></li><li><p><strong>挂载SMB共享</strong>： 使用以下命令挂载SMB共享：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">mount</span> <span class="token parameter variable">-t</span> cifs //192.168.1.3/shared_folder /mnt/smbshare <span class="token parameter variable">-o</span> <span class="token assign-left variable">username</span><span class="token operator">=</span>your_username,password<span class="token operator">=</span>your_password</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>将<code>//192.168.10.3/shared_folder</code>替换为SMB服务器的IP地址和共享名称，<code>/mnt/smbshare</code>替换为你创建的本地挂载点，<code>your_username</code>和<code>your_password</code>替换为访问SMB共享所需的用户名和密码。</p><p>如果你不希望在命令中包含密码，你可以省略<code>password=your_password</code>部分，系统会提示你输入密码。</p></li><li><p><strong>自动挂载SMB共享</strong>（可选）： 如果你希望在每次启动时自动挂载SMB共享，可以编辑<code>/etc/fstab</code>文件来实现。</p><p>首先，为了安全起见，最好创建一个凭据文件来存储用户名和密码：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/smbcredentials</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在文件中添加以下内容：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">username=your_username</span>
<span class="line">password=your_password</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>保存并关闭文件，然后更改文件权限：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">600</span> /etc/smbcredentials</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>接着，用文本编辑器打开<code>/etc/fstab</code>文件：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/fstab</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在文件的末尾添加以下行：</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">//192.168.1.3/shared_folder /mnt/smbshare cifs credentials=/etc/smbcredentials,iocharset=utf8 0 0</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>再次保存并关闭文件，然后你可以通过运行以下命令来测试挂载：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">mount</span> <span class="token parameter variable">-a</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>如果没有错误，这意味着挂载成功，并且在下次启动时SMB共享将自动挂载。</p></li></ol><p>请记住，如果SMB共享需要不同的权限或其他挂载选项，你可能需要根据你的具体情况调整上述命令中的<code>-o</code>选项。</p><h2 id="开放-smb-共享" tabindex="-1"><a class="header-anchor" href="#开放-smb-共享"><span>开放 SMB 共享</span></a></h2><p>在Ubuntu 20.04上设置SMB共享通常涉及安装和配置Samba服务。以下是设置SMB共享的基本步骤：</p><ol><li><p><strong>安装Samba</strong>： 打开终端，并使用以下命令安装Samba：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> update</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> samba</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>配置共享</strong>： 编辑Samba配置文件 <code>/etc/samba/smb.conf</code>，在文件的末尾添加你的共享配置。你可以使用 <code>nano</code> 或你喜欢的任何文本编辑器：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">nano</span> /etc/samba/smb.conf</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>注意修改权限配置，否则连接时可能不会出现凭据输入窗口：</p><blockquote><p>约 100 行处</p></blockquote><div class="language-ini line-numbers-mode" data-highlighter="prismjs" data-ext="ini" data-title="ini"><pre><code><span class="line"><span class="token comment"># This option controls how unsuccessful authentication attempts are mapped</span></span>
<span class="line"><span class="token comment"># to anonymous connections</span></span>
<span class="line">   <span class="token key attr-name">security</span> <span class="token punctuation">=</span> <span class="token value attr-value">user</span></span>
<span class="line">   <span class="token key attr-name">map to guest</span> <span class="token punctuation">=</span> <span class="token value attr-value">never</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在文件的末尾添加类似于以下内容的配置：</p><div class="language-ini line-numbers-mode" data-highlighter="prismjs" data-ext="ini" data-title="ini"><pre><code><span class="line"><span class="token section"><span class="token punctuation">[</span><span class="token section-name selector">ShareName</span><span class="token punctuation">]</span></span>		# SMB 共享上显示的文件夹名</span>
<span class="line"><span class="token key attr-name">path</span> <span class="token punctuation">=</span> <span class="token value attr-value">/SMB_Share</span></span>
<span class="line"><span class="token key attr-name">read only</span> <span class="token punctuation">=</span> <span class="token value attr-value">no</span></span>
<span class="line"><span class="token key attr-name">browsable</span> <span class="token punctuation">=</span> <span class="token value attr-value">yes</span></span>
<span class="line"><span class="token key attr-name">guest ok</span> <span class="token punctuation">=</span> <span class="token value attr-value">no</span></span>
<span class="line"><span class="token key attr-name">create mask</span> <span class="token punctuation">=</span> <span class="token value attr-value">0755</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>ShareName</code> 是你想要在网络上显示的共享名称。</li><li><code>path</code> 是你想要共享的目录的路径。</li><li><code>read only = no</code> 允许用户写入共享。</li><li><code>browsable = yes</code> 允许用户在网络上浏览此共享。</li><li><code>guest ok = yes</code> 允许没有账户的用户访问共享。</li><li><code>create mask</code> 设置新创建文件的权限。</li></ul><p>保存并关闭文件。</p></li><li><p><strong>创建共享目录</strong>： 如果还没有创建你想要共享的目录，使用以下命令创建它，并设置适当的权限：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /SMB_Share</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token parameter variable">-R</span> 0755 /SMB_Share</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">chown</span> <span class="token parameter variable">-R</span> nobody:nogroup /SMB_Share</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>添加Samba用户</strong>（如果需要）：</p></li><li><p>如果你不想允许匿名访问，你需要为每个用户创建一个Samba账户：</p><blockquote><p>创建前，请确认用户存在，若不存在，请创建：<code>sudo adduser viewuser</code></p></blockquote><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> smbpasswd <span class="token parameter variable">-a</span> username</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>替换 <code>username</code> 为实际的系统用户名，并在提示时输入密码。然后，你需要在 <code>/etc/samba/smb.conf</code> 中的共享配置中将 <code>guest ok = yes</code> 改为 <code>no</code>。</p></li><li><p><strong>重启Samba服务</strong>： 重启Samba服务以应用更改：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> systemctl restart smbd</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>测试配置</strong>： 测试Samba配置是否没有错误：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> testparm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li><li><p><strong>访问共享</strong>： 在本地网络中的其他设备上，你应该现在能够看到共享并访问它。在Windows上，你可以在文件资源管理器的地址栏输入 <code>\\\\your-ubuntu-ip\\ShareName</code> 来访问共享。在Mac或Linux上，你可以在相应的网络位置查找共享。</p></li></ol><p>请确保防火墙设置允许通过SMB协议的端口（通常是139和445）。如果你在Ubuntu上使用UFW防火墙，你可以允许Samba流量：</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> ufw allow samba</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>现在你的Ubuntu 20.04系统应该能够通过SMB协议提供文件共享服务。</p>`,10)]))}const d=a(l,[["render",t]]),o=JSON.parse('{"path":"/blogs/tech/linux/04_Linux_SMB.html","title":"Linux 挂载 SMB","lang":"en-US","frontmatter":{"title":"Linux 挂载 SMB","date":"2024-02-16T00:00:00.000Z","tags":["Linux"],"categories":["tech"]},"headers":[{"level":2,"title":"挂载 SMB 目录","slug":"挂载-smb-目录","link":"#挂载-smb-目录","children":[]},{"level":2,"title":"开放 SMB 共享","slug":"开放-smb-共享","link":"#开放-smb-共享","children":[]}],"git":{"createdTime":1766826955000,"updatedTime":1766826955000,"contributors":[{"name":"PPPerryPan","email":"perrypan0123@outlook.com","commits":1}]},"filePathRelative":"blogs/tech/linux/04_Linux_SMB.md"}');export{d as comp,o as data};
