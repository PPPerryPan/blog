import{_ as n,c as a,b as e,o as l}from"./app-CUDFWA7u.js";const i="/blog/assets/2022-04-18-15-55-49-CTAC7PxW.png",p="/blog/assets/image-20220418161539793-Cf6DQbye.png",t="/blog/assets/2022-04-18-09-06-58-CBlf293s.png",c="/blog/assets/image-20220418093124655-Cba2Pcnr.png",r="/blog/assets/image-20220418093455651-M6yKTYwh.png",o="/blog/assets/image-20220418102726145-CsvFLoT4.png",u="/blog/assets/image-20220418102902925-C9xvyfvw.png",d="/blog/assets/image-20220418103058304-awlUkj0H.png",m="/blog/assets/image-20220418103233851-BcYM8vhJ.png",v="/blog/assets/2022-04-18-15-44-25-BFAkTm8G.png",b="/blog/assets/image-20220418155552669-DngZ1nEq.png",k="/blog/assets/image-20220420110607129-AQpx4Bwc.png",g="/blog/assets/image-20220420111403887-CgX58OFa.png",h="/blog/assets/image-20220420111455637-CQjbvGfT.png",f="/blog/assets/image-20220420111253797-G4_ys-Xw.png",_="/blog/assets/image-20220420111723582-DiKnltkF.png",y="/blog/assets/image-20220420112132984-AhFMDGZY.png",x={};function M(q,s){return l(),a("div",null,s[0]||(s[0]=[e(`<h1 id="虚拟化实验" tabindex="-1"><a class="header-anchor" href="#虚拟化实验"><span>虚拟化实验</span></a></h1><h2 id="qemu-kvm虚拟机镜像制作" tabindex="-1"><a class="header-anchor" href="#qemu-kvm虚拟机镜像制作"><span><strong>QEMU-KVM虚拟机镜像制作</strong></span></a></h2><ul><li>关闭防火墙和selinux</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">[</span>root@cMaster perry<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld</span></span>
<span class="line"><span class="token punctuation">[</span>root@cMaster perry<span class="token punctuation">]</span><span class="token comment"># setenforce 0</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>安装kvm并重启系统</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment">## 1.安装kvm</span></span>
<span class="line">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> qemu-kvm libvirt virt-install bridge-utils</span>
<span class="line"><span class="token comment">## 2.重启系统</span></span>
<span class="line">init <span class="token number">6</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>验证kvm安装情况</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre><code><span class="line">[root@cMaster perry]# virsh -c qemu:///system list</span>
<span class="line"> Id    Name                           State</span>
<span class="line">----------------------------------------------------</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>加载并检测kvm模块是否工作正常</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment">## 加载kvm模块</span></span>
<span class="line">modprobe kvm</span>
<span class="line"></span>
<span class="line"><span class="token comment">## 检查模块是否加载成功，执行如下命令</span></span>
<span class="line">lsmod <span class="token operator">|</span><span class="token function">grep</span> kvm</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>启动kvm服务</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment">## 1.启动libvirtd守护进程</span></span>
<span class="line">systemctl start libvirtd</span>
<span class="line"><span class="token comment">## 2.查看是否启动成功 下方显示“Active: active (running)”，则表示启动成功。</span></span>
<span class="line">systemctl status libvirtd</span>
<span class="line">● libvirtd.service - Virtualization daemon</span>
<span class="line">   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/libvirtd.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: enabled<span class="token punctuation">)</span></span>
<span class="line">   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Sun <span class="token number">2022</span>-04-17 <span class="token number">18</span>:22:21 PDT<span class="token punctuation">;</span> 2min 28s ago</span>
<span class="line">     Docs: man:libvirtd<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span></span>
<span class="line">           https://libvirt.org</span>
<span class="line"> Main PID: <span class="token number">1014</span> <span class="token punctuation">(</span>libvirtd<span class="token punctuation">)</span></span>
<span class="line">    Tasks: <span class="token number">19</span> <span class="token punctuation">(</span>limit: <span class="token number">32768</span><span class="token punctuation">)</span></span>
<span class="line">   CGroup: /system.slice/libvirtd.service</span>
<span class="line">           ├─1014 /usr/sbin/libvirtd</span>
<span class="line">           ├─1343 /usr/sbin/dnsmasq --conf-file<span class="token operator">=</span>/var/lib/libvirt/dnsmasq/defa<span class="token punctuation">..</span>.</span>
<span class="line">           └─1346 /usr/sbin/dnsmasq --conf-file<span class="token operator">=</span>/var/lib/libvirt/dnsmasq/defa<span class="token punctuation">..</span>.</span>
<span class="line"></span>
<span class="line">Apr <span class="token number">17</span> <span class="token number">18</span>:22:23 cMaster dnsmasq<span class="token punctuation">[</span><span class="token number">1330</span><span class="token punctuation">]</span>: listening on virbr0<span class="token punctuation">(</span><span class="token comment">#3): 192.168.122.1</span></span>
<span class="line">Apr <span class="token number">17</span> <span class="token number">18</span>:22:23 cMaster dnsmasq<span class="token punctuation">[</span><span class="token number">1343</span><span class="token punctuation">]</span>: started, version <span class="token number">2.76</span> cachesize <span class="token number">150</span></span>
<span class="line">Apr <span class="token number">17</span> <span class="token number">18</span>:22:23 cMaster dnsmasq<span class="token punctuation">[</span><span class="token number">1343</span><span class="token punctuation">]</span>: compile <span class="token function">time</span> options: IPv6 GNU-getop<span class="token punctuation">..</span>.fy</span>
<span class="line">Apr <span class="token number">17</span> <span class="token number">18</span>:22:23 cMaster dnsmasq-dhcp<span class="token punctuation">[</span><span class="token number">1343</span><span class="token punctuation">]</span>: DHCP, IP range <span class="token number">192.168</span>.122.2 -- <span class="token punctuation">..</span>.h</span>
<span class="line">Apr <span class="token number">17</span> <span class="token number">18</span>:22:23 cMaster dnsmasq-dhcp<span class="token punctuation">[</span><span class="token number">1343</span><span class="token punctuation">]</span>: DHCP, sockets bound exclusively <span class="token punctuation">..</span>.0</span>
<span class="line">Apr <span class="token number">17</span> <span class="token number">18</span>:22:23 cMaster dnsmasq<span class="token punctuation">[</span><span class="token number">1343</span><span class="token punctuation">]</span>: reading /etc/resolv.conf</span>
<span class="line">Apr <span class="token number">17</span> <span class="token number">18</span>:22:23 cMaster dnsmasq<span class="token punctuation">[</span><span class="token number">1343</span><span class="token punctuation">]</span>: using nameserver <span class="token number">192.168</span>.208.2<span class="token comment">#53</span></span>
<span class="line">Apr <span class="token number">17</span> <span class="token number">18</span>:22:23 cMaster dnsmasq<span class="token punctuation">[</span><span class="token number">1343</span><span class="token punctuation">]</span>: <span class="token builtin class-name">read</span> /etc/hosts - <span class="token number">5</span> addresses</span>
<span class="line">Apr <span class="token number">17</span> <span class="token number">18</span>:22:23 cMaster dnsmasq<span class="token punctuation">[</span><span class="token number">1343</span><span class="token punctuation">]</span>: <span class="token builtin class-name">read</span> /var/lib/libvirt/dnsmasq/defaul<span class="token punctuation">..</span>.es</span>
<span class="line">Apr <span class="token number">17</span> <span class="token number">18</span>:22:23 cMaster dnsmasq-dhcp<span class="token punctuation">[</span><span class="token number">1343</span><span class="token punctuation">]</span>: <span class="token builtin class-name">read</span> /var/lib/libvirt/dnsmasq/de<span class="token punctuation">..</span>.e</span>
<span class="line">Hint: Some lines were ellipsized, use <span class="token parameter variable">-l</span> to show <span class="token keyword">in</span> full.</span>
<span class="line"></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>系统安装过程：略</p></li><li><p>检查KVM状态</p></li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">virsh</span> list</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><img src="`+i+`" alt="CentOS 7 64 位-2022-04-18-15-55-49"></p><ul><li>配置SSH</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 检查是否安装了ssh服务</span></span>
<span class="line"><span class="token function">apt-cache</span> policy openssh-client openssh-server</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 安装openssh</span></span>
<span class="line"><span class="token function">apt-get</span> <span class="token function">install</span> openssh-server</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 检查运行状态</span></span>
<span class="line"><span class="token function">ps</span> -e<span class="token operator">|</span><span class="token function">grep</span> <span class="token function">ssh</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 启用ssh服务</span></span>
<span class="line"><span class="token function">sudo</span> /etc/init.d/ssh start</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>检查状态</p><p><img src="`+p+`" alt="image-20220418161539793"></p><ul><li><s>配置KVM中的Linux（此处为Ubuntu 18.04）</s></li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">[</span>root@cMaster perry<span class="token punctuation">]</span><span class="token comment"># sudo apt update</span></span>
<span class="line"><span class="token punctuation">[</span>root@cMaster perry<span class="token punctuation">]</span><span class="token comment"># sudo apt upgrade</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 安装Xfce桌面环境</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> xfce4 xfce4-goodies</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 安装TightVNC服务器</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> tightvncserver</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 设置安全密码并创建初始配置文件</span></span>
<span class="line">vncserver</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="以上-·-可能会遇到的问题" tabindex="-1"><a class="header-anchor" href="#以上-·-可能会遇到的问题"><span>以上 · 可能会遇到的问题</span></a></h2><p><img src="`+t+'" alt="CentOS 7 64 位-2022-04-18-09-06-58"></p><ul><li><p>解决方案：检查网络连接状态，代理服务器状态。</p></li><li><p>磁盘空间不足</p></li></ul><p>添加新磁盘并分区</p><p><img src="'+c+'" alt="image-20220418093124655"></p><p><img src="'+r+'" alt="image-20220418093455651"></p><p>分区后 添加到KVM存储池中</p><p><img src="'+o+'" alt="image-20220418102726145"></p><p>创建虚拟机时选择刚才创建的虚拟磁盘</p><p><img src="'+u+'" alt="image-20220418102902925"></p><ul><li>权限不足问题：</li></ul><p><img src="'+d+`" alt="image-20220418103058304"></p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token punctuation">[</span>root@cMaster perry<span class="token punctuation">]</span><span class="token comment"># vim /etc/libvirt/qemu.conf</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>去除以下两行含&quot;root&quot;字样的注释</p><p><img src="`+m+`" alt="image-20220418103233851"></p><ul><li>可能会使用到的SSH命令：</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment">## 检查安装状态</span></span>
<span class="line"><span class="token function">rpm</span> <span class="token parameter variable">-qa</span> <span class="token operator">|</span><span class="token function">grep</span> <span class="token function">ssh</span> </span>
<span class="line"></span>
<span class="line"><span class="token comment">## 启动SSH服务</span></span>
<span class="line"><span class="token function">service</span> sshd start </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 安装ssh-client命令：</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> openssh-client</span>
<span class="line"><span class="token comment"># 安装ssh-server命令：</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> openssh-server</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>virsh list -all 为空问题</li></ul><p><img src="`+v+'" alt="CentOS 7 64 位-2022-04-18-15-44-25"></p><p>解决方案：su ！！！</p><p><img src="'+b+'" alt="image-20220418155552669"></p><h2 id="vmware-vsphere-esxi安装及网络设置" tabindex="-1"><a class="header-anchor" href="#vmware-vsphere-esxi安装及网络设置"><span>VMware vSphere ESXi安装及网络设置</span></a></h2><ul><li>配置虚拟存储池</li></ul><p><img src="'+k+'" alt="image-20220420110607129"></p><ul><li>虚拟机安装</li></ul><p>过程过于简单，直接从WorkStation中导出OVF，ESXi中导入即可。</p><ul><li>配置网络虚拟化</li></ul><p>在虚拟交换机中添加，并做端口聚合</p><p><img src="'+g+'" alt="image-20220420111403887"></p><p>创建并配置VLAN</p><p><img src="'+h+'" alt="image-20220420111455637"></p><p><img src="'+f+'" alt="image-20220420111253797"></p><ul><li>配置服务器虚拟化</li></ul><p>编辑ESXi内虚拟机选项，配置网卡</p><p><img src="'+_+'" alt="image-20220420111723582"></p><p>虚拟机运行截图</p><p><img src="'+y+'" alt="image-20220420112132984"></p>',59)]))}const A=n(x,[["render",M]]),C=JSON.parse('{"path":"/blogs/tech/cloud/Lab2_Virtual.html","title":"Lab-虚拟化","lang":"en-US","frontmatter":{"title":"Lab-虚拟化","date":"2022-04-30T00:00:00.000Z","tags":["Cloud"],"categories":["tech"]},"headers":[{"level":2,"title":"QEMU-KVM虚拟机镜像制作","slug":"qemu-kvm虚拟机镜像制作","link":"#qemu-kvm虚拟机镜像制作","children":[]},{"level":2,"title":"以上 · 可能会遇到的问题","slug":"以上-·-可能会遇到的问题","link":"#以上-·-可能会遇到的问题","children":[]},{"level":2,"title":"VMware vSphere ESXi安装及网络设置","slug":"vmware-vsphere-esxi安装及网络设置","link":"#vmware-vsphere-esxi安装及网络设置","children":[]}],"git":{"createdTime":1766826955000,"updatedTime":1766842759000,"contributors":[{"name":"PPPerryPan","email":"perrypan0123@outlook.com","commits":2}]},"filePathRelative":"blogs/tech/cloud/Lab2_Virtual.md"}');export{A as comp,C as data};
